#textdomain wesnoth-Ooze_Mini_Campaign

    # ===================================================================================================================== #
    # 4 - SIEGE MULTIPLAYER SCENARIO
    # ===================================================================================================================== #
    # Last revision: 2013-01-28
    # ===================================================================================================================== #

[multiplayer]
    id=4_mp_Pinewood_Siege
    name= _ "Pinewood Siege"
    next_scenario=null
    experience_modifier=100

    allow_new_game=no
    map_data="{~add-ons/Ooze_Mini_Campaign/maps/Fort_Pinewood.map}"
    {SCENARIO_MUSIC "revelation.ogg"}
    {EXTRA_SCENARIO_MUSIC "weight_of_revenge.ogg"}

    turns=-1
    victory_when_enemies_defeated=no

    {DEFAULT_SCHEDULE_FIRST_WATCH}

    # ===================================================================================================================== #
    # SCENARIO UTILS DEFINITIONS
    # ===================================================================================================================== #

    #define F1
        3#enddef

    #define F2
        4#enddef

    #define CREATE_SOLID_LEADER SIDE
        {VARIABLE count {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS count 1}
        [then]
            {VARIABLE ooze_id "Master Ooze"}
        [/then]
        [else]
            {VARIABLE ooze_id "Master Ooze 2"}
        [/else]
        [/if]

        {VARIABLE_OP count sub 1}

        [store_unit]
            [filter]
                id=$ooze_id
            [/filter]
            variable=leader
        [/store_unit]

        [if]
            {VARIABLE_NOT_EQUALS leader.race elf}
        [then]
            {VARIABLE ooze_store[$count].moves ooze_store[$count].max_moves}

            [kill]
                id=$ooze_id
            [/kill]
            [unstore_unit]
                variable=ooze_store[$count]
            [/unstore_unit]
            [object]
                [filter]
                    id=$ooze_id
                [/filter]

                silent=yes
                [effect]
                    apply_to=hitpoints
                    heal_full=yes
                [/effect]
            [/object]
        [/then]
        [/if]

        {CLEAR_VARIABLE ooze_id}
        {CLEAR_VARIABLE count}
        {CLEAR_VARIABLE leader}
    #enddef

    #define SET_SOLID SIDE
        [set_recruit]
            side={SIDE}
            recruit=Peasant,Woodsman,Ruffian
        [/set_recruit]
    #enddef

    #define INITIALIZE_VARIABLES 
        {VARIABLE battle_stage 0}

        [if]
            {VARIABLE_NUMERICAL_EQUALS dryad_friend 1}
        [then]
            {VARIABLE traitor_id "Master Ooze"}
        [/then]
        [else]
            [if]
                {VARIABLE_NUMERICAL_EQUALS dryad_friend 2}
            [then]
                {VARIABLE traitor_id "Master Ooze 2"}
            [/then]
            [/if]
        [/else]
        [/if]
    #enddef

    #define RANDOMIZE_SCENARIO
        {VARIABLE_RANDOM join_to_forces 1..2}
        {VARIABLE_RANDOM sudden_strike 1..2}
        {VARIABLE_RANDOM allies_type 1..5}
    #enddef

    #define SPENT_GOLD VALUE SIDE
        {VARIABLE master_ooze {SIDE}}
        {VARIABLE gpa {VALUE}}

        [sound]
            name=gold.ogg
        [/sound]
        [gold]
            side={SIDE}
            amount=-$gpa
        [/gold]
    #enddef

    #define WEAPON_UPGRADE
        [unit_overlay]
            x=$unit.x
            y=$unit.y
            image=overlays/weapon-upgrade-icon.png
        [/unit_overlay]
    #enddef

    #define SHADY_INTRODUCTION SIDE
        {VARIABLE master_ooze {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE speaker_id "Master Ooze"}
        [/then]
        [else]
            {VARIABLE speaker_id "Master Ooze 2"}
        [/else]
        [/if]

        [if]
            [have_unit]
                id=Shady Character
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (id=Shady Character) ( _ "How would you like to increase the efficiency of your troops?")}
            {SPEAKER_GENERIC (id=$speaker_id) ( _ "Who are you?")}
            {SPEAKER_GENERIC (id=Shady Character) ( _ "My name is unimportant. I'm a black market arms dealer by trade. Under normal circumstances my business would be conducted in a more...clandestine manner, but these are hardly normal times. If the orcs overrun the fort they'll kill us all. So I'm willing to sell my wares to your troops at a significant discount!")}
            {SPEAKER_GENERIC (id=$speaker_id) ( _ "You want to SELL us weapons? You're not just going to give them to us? Because, as you so correctly pointed out, if we lose, you die too.")}
            {SPEAKER_GENERIC (id=Shady Character) ( _ "Sorry, this is a case of my overwhelming greed getting the better of my self preservation instincts.")}
        [/then]
        [else]
            [allow_undo][/allow_undo]
        [/else]
        [/if]

        {CLEAR_VARIABLE master_ooze}
        {CLEAR_VARIABLE speaker_id}
    #enddef

    #define SHADY_TRANSACTIONS SIDE
        [if]
            [have_unit]
                id=Shady Character
            [/have_unit]
        [then]
            [if]
                {VARIABLE_NOT_EQUALS unit.overlays "overlays/weapon-upgrade-icon.png"}
                [and]
                    {VARIABLE_NOT_EQUALS unit.overlays "misc/loyal-icon.png,overlays/weapon-upgrade-icon.png"}
                [/and]
            [then]
                [store_gold] 
                    side={SIDE}
                    variable=gold 
                [/store_gold]

                {SPEAKER_GENERIC (id=Shady Character) ( _ "30 gold will give one of your units poison for their melee attack." )}
                {SPEAKER_GENERIC_IF (id=Shady Character) ( _ "40 gold will give one of your units a one-time permanent upgrade to their melee capabilities. I only have the ability to do this ONCE, so choose who will receive this boon wisely.") {VARIABLE_LESS_THAN upgrade_given 1}}
                {SPEAKER_SPECIAL (speaker=unit) ( _ "(What to buy?)") (
                    {SPEAKER_OPTION ( _ "(Pay 30 gold) Poison my melee weapons!") (
                        [if]
                            {VARIABLE_LESS_THAN gold 30}
                        [then]
                            {SPEAKER_GENERIC_IF (id=Shady Character) ( _ "female^It looks like you don't have that much. Come back when you have more gold.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                            {SPEAKER_GENERIC_IF (id=Shady Character) ( _ "male^It looks like you don't have that much. Come back when you have more gold.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        [/then]
                        [else]
                            [object]
                                silent=yes
                                duration=forever
                                [effect]
                                    apply_to=attack
                                    range=melee
                                    [set_specials]
                                        mode=append
                                        {WEAPON_SPECIAL_POISON}
                                    [/set_specials]
                                [/effect]
                            [/object]

                            {WEAPON_UPGRADE}
                            {SPENT_GOLD 30 {SIDE}}

                            [if]
                                {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                            [then]
                                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^You spent $gpa gold pieces!")}
                            [/then]
                            [else]
                                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^You spent $gpa gold pieces!")}
                            [/else]
                            [/if]
                        [/else]
                        [/if]
                    )}
                    {SPEAKER_OPTION_IF ( _ "(Pay 40 gold) Upgrade my melee weapons!") {VARIABLE_LESS_THAN upgrade_given 1} (
                        [if]
                            {VARIABLE_LESS_THAN gold 40}
                        [then]
                            {SPEAKER_GENERIC_IF (id=Shady Character) ( _ "female^It looks like you don't have that much. Come back when you have more gold.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                            {SPEAKER_GENERIC_IF (id=Shady Character) ( _ "male^It looks like you don't have that much. Come back when you have more gold.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        [/then]
                        [else]
                            [object]
                                silent=yes
                                duration=forever
                                [effect]
                                    apply_to=attack
                                    range=melee
                                    increase_damage=3
                                [/effect]
                            [/object]

                            {WEAPON_UPGRADE}
                            {SPENT_GOLD 40 {SIDE}}
                            {VARIABLE upgrade_given 1}

                            [if]
                                {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                            [then]
                                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^You spent $gpa gold pieces increasing melee damage by 3! Now $unit.name is much more lethal in combat!")}
                            [/then]
                            [else]
                                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^You spent $gpa gold pieces increasing melee damage by 3! Now $unit.name is much more lethal in combat!")}
                            [/else]
                            [/if]
                        [/else]
                        [/if]
                    )}
                    {SPEAKER_OPTION ( _ "(Leave)") (
                        {SPEAKER_GENERIC (id=Shady Character) ( _ "Come back any time (with more gold, preferably)!")}
                    )}
                )}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=Shady Character) ( _ "I've already upgraded your weapon.")}
            [/else]
            [/if]
        [/then]
        [else]
            [allow_undo][/allow_undo]
        [/else]
        [/if]
    #enddef

    #define WILD_ALLIES
        [switch]
            variable=allies_type
            [case]
                value="1"
                {UNIT {F2} "Giant Spider" 10 19 (
                    [modifications]
                        {TRAIT_RESILIENT}
                        {TRAIT_QUICK}
                    [/modifications]
                )}
            [/case]
            [case]
                value="2"
                {UNIT {F2} "Water Serpent" 7 17 (
                    [modifications]
                        {TRAIT_STRONG}
                        {TRAIT_RESILIENT}
                    [/modifications]
                )}
                {UNIT {F2} "Water Serpent" 13 17 (
                    [modifications]
                        {TRAIT_QUICK}
                        {TRAIT_STRONG}
                    [/modifications]
                )}
            [/case]
            [case]
                value="3"
                {UNIT {F2} "Troll Rocklobber" 9 19 (
                    [modifications]
                        {TRAIT_RESILIENT}
                        {TRAIT_FEARLESS}
                    [/modifications]
                )}
                {UNIT {F2} "Troll Rocklobber" 11 19 (
                    [modifications]
                        {TRAIT_QUICK}
                        {TRAIT_RESILIENT}
                    [/modifications]
                )}
            [/case]
            [case]
                value="4"
                {UNIT {F2} "Goblin Spearman" 9 18 (
                    [modifications]
                        {TRAIT_SLOW}
                    [/modifications]
                )}
                {UNIT {F2} "Goblin Rouser" 10 17 (
                    [modifications]
                        {TRAIT_DIM}
                    [/modifications]
                )}
                {UNIT {F2} "Goblin Spearman" 11 18 (
                    [modifications]
                        {TRAIT_SLOW}
                    [/modifications]
                )}
                {UNIT {F2} "Goblin Spearman" 10 18 (
                    [modifications]
                        {TRAIT_SLOW}
                    [/modifications]
                )}
                {UNIT {F2} "Goblin Rouser" 10 19 (
                    [modifications]
                        {TRAIT_WEAK}
                    [/modifications]
                )}
                {UNIT {F2} "Goblin Spearman" 11 19 (
                    [modifications]
                        {TRAIT_DIM}
                    [/modifications]
                )}
            [/case]
            [else]
                {UNIT {F2} "Troll Hero" 9 19 (
                    [modifications]
                        {TRAIT_FEARLESS}
                        {TRAIT_QUICK}
                    [/modifications]
                )}
                {UNIT {F2} "Troll Hero" 11 19 (
                    [modifications]
                        {TRAIT_RESILIENT}
                        {TRAIT_STRONG}
                    [/modifications]
                )}
            [/else]
        [/switch]
    
        {SPEAKER_GENERIC (id=Guthry) ( _ "I found new friends to help me claim what's rightfully mine!")}
    #enddef

    #define GUTHRY_EAGER SIDE
        [if]
            [have_unit]
                side={F2}
                id=Guthry
            [/have_unit]
        [then]
            [if]
                {VARIABLE_NUMERICAL_EQUALS dryad_friend {SIDE}}
            [then]
                {SPEAKER_GENERIC_IF (id=Guthry) ( _ "female^Come out elf and fight! Do not hide before me!") {VARIABLE_NUMERICAL_EQUALS dryad_friend 1}}
                {SPEAKER_GENERIC_IF (id=Guthry) ( _ "male^Come out elf and fight! Do not hide before me!") {VARIABLE_NUMERICAL_EQUALS dryad_friend 2}}
            [/then]
            [/if]
        [/then]
        [/if]
    #enddef

    #define TOWNSFOLK
        {UNIT {F1} Spearman 9 15 (
            id=Stern Guard
            name= _ "Stern Guard"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} Bowman 11 15 (
            id=Bored Guard
            name= _ "Bored Guard"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} "Dwarvish Thunderer" 3 7 (
            id=Ram Aide
            name= _ "Ram Aide"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} "White Mage" 14 8 (
            id=High Priest Jal
            name= _ "High Priest Jal"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} Peasant 14 4 (
            id=Jedd
            name= _ "Jedd"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} "Dark Sorceress" 3 11 (
            id=Corinna
            name= _ "Corinna"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} Sergeant 10 6 (
            id=Sergeant Ryn
            name= _ "Sergeant Ryn"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {P1} "Dwarvish Fighter" 6 8 (
            id=Frist
            name= _ "Frist"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} Longbowman 18 8 (
            id=Valin
            name= _ "Valin"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} "Dwarvish Guardsman" 14 12 (
            id=Brock
            name= _ "Brock"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            profile=portraits/transparent/olddwarf-guard.png
            {IS_LOYAL}
        )}
        {UNIT {P1} "Elvish Ranger" 10 1 (
            id=Kirielle the Realist
            name= _ "Kirielle the Realist"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            gender=female
            {IS_LOYAL}
        )}
        {UNIT {P1} "Elvish Marksman" 11 2 (
            id=Bryony the Idealist
            name= _ "Bryony the Idealist"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            gender=female
            {IS_LOYAL}
        )}
    #enddef

    #define CAPTURE_LEADER FILTER VALUE
        [store_unit]        
            variable=captured_unit
            kill=no
            [filter]
                {FILTER}
            [/filter]
        [/store_unit]
        {VARIABLE captured_unit.side {VALUE}}
        [unstore_unit]
            variable=captured_unit
            find_vacant=no
        [/unstore_unit]
        {CLEAR_VARIABLE captured_unit}
    #enddef

    #define FORM_DEFENDER_FORCES
        [if]
            {VARIABLE_GREATER_THAN leadership_aurelia $leadership_sithras}
        [then]
            {VARIABLE aurelia_forces_overwhelm $leadership_aurelia}
            {VARIABLE_OP aurelia_forces_overwhelm sub $leadership_sithras}
            [if]
                {VARIABLE_GREATER_THAN leaderless_troops 0}
            [then]
                [if]
                    {VARIABLE_NUMERICAL_EQUALS corinna_friend 3}
                [then]
                    {CAPTURE_LEADER id=Corinna {P2}}
                    {VARIABLE_OP leaderless_troops sub 1}
                    {VARIABLE_OP aurelia_forces_overwhelm sub 1}
                    {VARIABLE_OP leadership_sithras add 1}           
                [/then]
                [/if]

                [if]
                    {VARIABLE_NUMERICAL_EQUALS valin_friend 3}
                [then]
                    {CAPTURE_LEADER id=Valin {P2}}
                    {VARIABLE_OP leaderless_troops sub 1}
                    {VARIABLE_OP aurelia_forces_overwhelm sub 1}
                    {VARIABLE_OP leadership_sithras add 1}                
                [/then]
                [/if]

                [if]
                    {VARIABLE_NUMERICAL_EQUALS sergeant_ryn_friend 3}
                [then]
                    {CAPTURE_LEADER id="Sergeant Ryn" {P2}}
                    {VARIABLE_OP leaderless_troops sub 1}
                    {VARIABLE_OP aurelia_forces_overwhelm sub 1}
                    {VARIABLE_OP leadership_sithras add 1}                
                [/then]
                [/if]

                [if]
                    {VARIABLE_NUMERICAL_EQUALS brock_friend 3}
                [then]
                    {CAPTURE_LEADER id=Brock {P2}}
                    {VARIABLE_OP leaderless_troops sub 1}
                    {VARIABLE_OP aurelia_forces_overwhelm sub 1}
                    {VARIABLE_OP leadership_sithras add 1}                
                [/then]
                [/if]

                [if]
                    {VARIABLE_NUMERICAL_EQUALS ram_friend 3}
                [then]
                    {CAPTURE_LEADER id="Ram Aide" {P2}}
                    {VARIABLE_OP leaderless_troops sub 1}
                    {VARIABLE_OP aurelia_forces_overwhelm sub 1}
                    {VARIABLE_OP leadership_sithras add 1}                
                [/then]
                [/if]
            [/then]
            [/if]

            [if]
                {VARIABLE_LESS_THAN aurelia_forces_overwhelm 0}
            [then]
                {VARIABLE imperial_commander {P1}}
                {VARIABLE_OP aurelia_forces_overwhelm add 3}
                {VARIABLE_OP leadership_aurelia add 3} 
            [/then]
            [else]
                [if]
                    {VARIABLE_GREATER_THAN aurelia_forces_overwhelm 0}
                [then]
                    {VARIABLE imperial_commander {P2}} 
                    {VARIABLE_OP aurelia_forces_overwhelm sub 3}
                    {VARIABLE_OP leadership_sithras add 3} 
                [/then]
                [else]
                    {VARIABLE imperial_commander $join_to_forces}
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS join_to_forces 1}
                    [then]
                        {VARIABLE_OP sithras_forces_overwhelm sub 3}
                        {VARIABLE_OP leadership_aurelia add 3} 
                    [/then]
                    [else]
                        {VARIABLE_OP aurelia_forces_overwhelm sub 3}
                        {VARIABLE_OP leadership_sithras add 3} 
                    [/else]
                    [/if]
                [/else]
                [/if]
            [/else]
            [/if]
        [/then]
        [else]
            [if]
                {VARIABLE_LESS_THAN leadership_aurelia $leadership_sithras}
            [then]
                {VARIABLE sithras_forces_overwhelm $leadership_sithras}
                {VARIABLE_OP sithras_forces_overwhelm sub $leadership_aurelia}
                [if]
                    {VARIABLE_GREATER_THAN leaderless_troops 0}
                [then]
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS corinna_friend 3}
                    [then]
                        {CAPTURE_LEADER id=Corinna {P1}}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {VARIABLE_OP sithras_forces_overwhelm sub 1}
                        {VARIABLE_OP leadership_aurelia add 1}                
                    [/then]
                    [/if]

                    [if]
                        {VARIABLE_NUMERICAL_EQUALS valin_friend 3}
                    [then]
                        {CAPTURE_LEADER id=Valin {P1}}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {VARIABLE_OP sithras_forces_overwhelm sub 1}
                        {VARIABLE_OP leadership_aurelia add 1}                
                    [/then]
                    [/if]

                    [if]
                        {VARIABLE_NUMERICAL_EQUALS sergeant_ryn_friend 3}
                    [then]
                        {CAPTURE_LEADER id="Sergeant Ryn" {P1}}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {VARIABLE_OP sithras_forces_overwhelm sub 1}
                        {VARIABLE_OP leadership_aurelia add 1}                
                    [/then]
                    [/if]

                    [if]
                        {VARIABLE_NUMERICAL_EQUALS brock_friend 3}
                    [then]
                        {CAPTURE_LEADER id=Brock {P1}}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {VARIABLE_OP sithras_forces_overwhelm sub 1}
                        {VARIABLE_OP leadership_aurelia add 1}                
                    [/then]
                    [/if]

                    [if]
                        {VARIABLE_NUMERICAL_EQUALS ram_friend 3}
                    [then]
                        {CAPTURE_LEADER id="Ram Aide" {P1}}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {VARIABLE_OP sithras_forces_overwhelm sub 1}
                        {VARIABLE_OP leadership_aurelia add 1}                
                    [/then]
                    [/if]
                [/then]
                [/if]

                [if]
                    {VARIABLE_LESS_THAN sithras_forces_overwhelm 0}
                [then]
                    {VARIABLE imperial_commander {P2}}
                    {VARIABLE_OP sithras_forces_overwhelm add 3}
                    {VARIABLE_OP leadership_sithras add 3} 
                [/then]
                [else]
                    [if]
                        {VARIABLE_GREATER_THAN sithras_forces_overwhelm 0}
                    [then]
                        {VARIABLE imperial_commander {P1}} 
                        {VARIABLE_OP sithras_forces_overwhelm sub 3}
                        {VARIABLE_OP leadership_aurelia add 3} 
                    [/then]
                    [else]
                        {VARIABLE imperial_commander $join_to_forces}

                        [if]
                            {VARIABLE_NUMERICAL_EQUALS join_to_forces 1}
                        [then]
                            {VARIABLE_OP sithras_forces_overwhelm sub 3}
                            {VARIABLE_OP leadership_aurelia add 3} 
                        [/then]
                        [else]
                            {VARIABLE_OP aurelia_forces_overwhelm sub 3}
                            {VARIABLE_OP leadership_sithras add 3} 
                        [/else]
                        [/if]
                    [/else]
                    [/if]
                [/else]
                [/if]
            [/then]
            [else]
                {VARIABLE sithras_forces_overwhelm 0}

                [if]
                    {VARIABLE_GREATER_THAN leaderless_troops 0}
                [then]
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS corinna_friend 3}
                    [then]
                        {CAPTURE_LEADER id=Corinna {P1}}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {VARIABLE_OP sithras_forces_overwhelm sub 1}
                        {VARIABLE_OP leadership_aurelia add 1}                
                    [/then]
                    [/if]

                    [if]
                        {VARIABLE_NUMERICAL_EQUALS valin_friend 3}
                    [then]
                        {CAPTURE_LEADER id=Valin {P1}}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {VARIABLE_OP sithras_forces_overwhelm sub 1}
                        {VARIABLE_OP leadership_aurelia add 1}                
                    [/then]
                    [/if]

                    [if]
                        {VARIABLE_NUMERICAL_EQUALS sergeant_ryn_friend 3}
                    [then]
                        {CAPTURE_LEADER id="Sergeant Ryn" {P1}}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {VARIABLE_OP sithras_forces_overwhelm sub 1}
                        {VARIABLE_OP leadership_aurelia add 1}                
                    [/then]
                    [/if]

                    [if]
                        {VARIABLE_NUMERICAL_EQUALS brock_friend 3}
                    [then]
                        {CAPTURE_LEADER id=Brock {P1}}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {VARIABLE_OP sithras_forces_overwhelm sub 1}
                        {VARIABLE_OP leadership_aurelia add 1}                
                    [/then]
                    [/if]

                    [if]
                        {VARIABLE_NUMERICAL_EQUALS ram_friend 3}
                    [then]
                        {CAPTURE_LEADER id="Ram Aide" {P1}}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {VARIABLE_OP sithras_forces_overwhelm sub 1}
                        {VARIABLE_OP leadership_aurelia add 1}                
                    [/then]
                    [/if]
                [/then]
                [/if]

                [if]
                    {VARIABLE_LESS_THAN sithras_forces_overwhelm 0}
                [then]
                    {VARIABLE imperial_commander {P2}}
                    {VARIABLE_OP sithras_forces_overwhelm add 3}
                    {VARIABLE_OP leadership_sithras add 3} 
                [/then]
                [else]
                    [if]
                        {VARIABLE_GREATER_THAN sithras_forces_overwhelm 0}
                    [then]
                        {VARIABLE imperial_commander {P1}} 
                        {VARIABLE_OP sithras_forces_overwhelm sub 3}
                        {VARIABLE_OP leadership_aurelia add 3} 
                    [/then]
                    [else]
                        {VARIABLE imperial_commander $join_to_forces}
                        [if]
                            {VARIABLE_NUMERICAL_EQUALS join_to_forces 1}
                        [then]
                            {VARIABLE_OP sithras_forces_overwhelm sub 3}
                            {VARIABLE_OP leadership_aurelia add 3} 
                        [/then]
                        [else]
                            {VARIABLE_OP aurelia_forces_overwhelm sub 3}
                            {VARIABLE_OP leadership_sithras add 3} 
                       [/else]
                       [/if]
                   [/else]
                   [/if]
               [/else]
               [/if]
           [/else]
           [/if]
        [/else]
        [/if]

        [if]
            {VARIABLE_LESS_THAN corinna_friend 3}
        [then]
            {CAPTURE_LEADER id=Corinna $corinna_friend}
        [/then]
        [/if]

        [if]
            {VARIABLE_LESS_THAN valin_friend 3}
        [then]
            {CAPTURE_LEADER id=Valin $valin_friend}
        [/then]
        [/if]

        [if]
            {VARIABLE_LESS_THAN sergeant_ryn_friend 3}
        [then]
            {CAPTURE_LEADER id="Sergeant Ryn" $sergeant_ryn_friend}
        [/then]
        [/if]

        [if]
            {VARIABLE_LESS_THAN brock_friend 3}
        [then]
            {CAPTURE_LEADER id=Brock $brock_friend}
        [/then]
        [/if]

        [if]
            {VARIABLE_LESS_THAN ram_friend 3}
        [then]
            {CAPTURE_LEADER id="Ram Aide" $ram_friend}
        [/then]
        [/if]

        {CAPTURE_LEADER id="Bored Guard" $bored_friend}
        {CAPTURE_LEADER id="Stern Guard" $stern_friend} 
    #enddef

    #define FORM_VOLUNTEER_FORCES
        [if]
            {VARIABLE_GREATER_THAN dryden_friend 0}
        [then]
            {UNIT $dryden_friend Paladin 7 13 (
                id=Sir Dryden
                name= _ "Sir Dryden"
                unrenamable=yes
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                {IS_LOYAL}
            )}

            [if]
                {VARIABLE_GREATER_THAN dryden_friend 1}
            [then]
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Sithras, today I will repay my debt to you!")}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Aurelia, today I will repay my debt to you!")}
            [/else]
            [/if]

            {SPEAKER_GENERIC (id=Corinna) ( _ "I don't really care about this fort but... (she fingers the Ring of Opposite Alignment) I guess I do care. (What did I just say?! I haven't been myself lately!)")}
        [/then]
        [else]
            {SPEAKER_GENERIC (id=Corinna) ( _ "What is it with people interrupting my studies?! First that idiot paladin and now an orc horde! Someone will pay for this!")}
        [/else]
        [/if]

        [if]
            {VARIABLE_GREATER_THAN fontaine_friend 0}
        [then]
            {UNIT $fontaine_friend Fencer 16 10 (
                id=Fontaine
                name= _ "Fontaine"
                unrenamable=yes
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_QUICK}
                [/modifications]
                {IS_LOYAL}
            )}

            [if]
                {VARIABLE_GREATER_THAN fontaine_friend 1}
            [then]
                {SPEAKER_GENERIC (id=Fontaine) ( _ "Today my patron will show the orcs the art of war!")}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=Fontaine) ( _ "No foul orc will touch a single golden hair on the head of my beautiful, perfect Muse so long as I draw breath!")}
            [/else]
            [/if]
        [/then]
        [/if]

        [if]
            {VARIABLE_GREATER_THAN jedd_friend 0}
        [then]
            [if]
                {VARIABLE_GREATER_THAN jedd_friend 1}
            [then]
                {SPEAKER_GENERIC (id=Jedd) ( _ "Sithras, you helped me when I had no hope, so now I'll help help you against this orc horde, even if there is no hope of victory.")}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=Jedd) ( _ "Aurelia, you helped me when I had no hope, so now I'll help help you against this orc horde, even if there is no hope of victory.")}
            [/else]
            [/if]
            {CAPTURE_LEADER id=Jedd $jedd_friend}
        [/then]
        [else]
            {SPEAKER_GENERIC (id=Jedd) ( _ "Time for me to go hide in my cellar.")}
            [kill]
                id=Jedd
            [/kill]
        [/else]
        [/if]

        [if]
            {VARIABLE_GREATER_THAN jal_friend 0}
        [then]
            [if]
                {VARIABLE_GREATER_THAN jal_friend 1}
            [then]
                {SPEAKER_GENERIC (id=High Priest Jal) ( _ "Sithras's piety is a beacon of light in this hour of darkness. By sword and prayer we will drive these heathen orcs back to the shadows from whence they came!")}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=High Priest Jal) ( _ "Aurelia's piety is a beacon of light in this hour of darkness. By sword and prayer we will drive these heathen orcs back to the shadows from whence they came!")}
            [/else]
            [/if]

            {CAPTURE_LEADER id="High Priest Jal" $jal_friend}
        [/then]
        [else]
            {SPEAKER_GENERIC (id=High Priest Jal) ( _ "A battlefield is no place for a man of my stature. I'll be in my church...praying to Pelor for our inevitable victory.")}
            [kill]
                id=High Priest Jal
            [/kill]
        [/else]
        [/if]

        [if]
            {VARIABLE_GREATER_THAN alkar_friend 0}
        [then]
            [if]
                {VARIABLE_NUMERICAL_EQUALS alkar_offer 4}
            [then]
                {UNIT $alkar_friend Lancer 6 4 (
                    id=Alkar
                    name= _ "Alkar"
                    unrenamable=yes
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_QUICK}
                    [/modifications]
                    {IS_LOYAL}
                )}
                {SPEAKER_GENERIC (id=Alkar) ( _ "My lord everything I am I owe to you. Command me!")}
            [/then]
            [else]
                {UNIT $alkar_friend Spearman 6 4 (
                    id=Alkar
                    name= _ "Alkar"
                    unrenamable=yes
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_QUICK}
                    [/modifications]
                    {IS_LOYAL}
                )}
                {SPEAKER_GENERIC (id=Alkar) ( _ "My master! Lead!")}
            [/else]
            [/if]
        [/then]
        [else]
            {UNIT {F1} Peasant 6 4 (
                id=Alkar
                name= _ "Alkar"
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_QUICK}
                [/modifications]
                {IS_LOYAL}
        )   }
            {SPEAKER_GENERIC (id=Alkar) ( _ "To victory! Glory for b... (Suddenly you hear a wail of pain. Alkar has tripped in the darkness of night and unfortunately impaled himself on his pitchfork. The young man's militia career has ended before it could even begin.)")}
            [kill]
                id=Alkar
                animate=yes
            [/kill]
            {SPEAKER_GENERIC (id=Frist) ( _ "And thats why ye shouldn't go ta battle without proper training.")}
        [/else]
        [/if]

        [if]
            {VARIABLE_GREATER_THAN livius_friend 0}
        [then]
            {UNIT $livius_friend Mage 16 6 (
                id=Livius
                name= _ "Livius"
                unrenamable=yes
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_INTELLIGENT}
                [/modifications]
                {IS_LOYAL}
            )}
            {SPEAKER_GENERIC (id=Livius) ( _ "(Sigh) Why did it have to be an orc horde? Why couldn't it have been an ooze horde?")}
        [/then]
        [/if]

        [if]
            {VARIABLE_GREATER_THAN guthry_friend 0}
        [then]
            {UNIT $guthry_friend Woodsman 4 3 (
                id=Guthry
                name= _ "Guthry"
                unrenamable=yes
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_STRONG}
                [/modifications]
                {IS_LOYAL}
            )}

            [if]
                {VARIABLE_GREATER_THAN guthry_friend 1}
            [then]
                {SPEAKER_GENERIC (id=Guthry) ( _ "I didn't inherit this land just to lose it to some thieving orc lord! I'm with you, Sithras!")}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=Guthry) ( _ "I didn't inherit this land just to lose it to some thieving orc lord! I'm with you, Aurelia!")}
            [/else]
            [/if]
        [/then]
        [/if]

        [if]
            {VARIABLE_GREATER_THAN dryad_friend 0}
        [then]
            {UNIT $dryad_friend "Elvish Druid" 5 3 (
                id=Dryad
                name= _ "Dryad"
                unrenamable=yes
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_QUICK}
                [/modifications]
                {IS_LOYAL}
            )}

            [if]
                {VARIABLE_GREATER_THAN dryad_friend 1}
            [then]
                {SPEAKER_GENERIC (id=Dryad) ( _ "Sithras, today I repay my debt to you! The orcs will feel Nature's fury!")}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=Dryad) ( _ "Aurelia, today I repay my debt to you! The orcs will feel Nature's fury!")}
            [/else]
            [/if]

            {UNIT {F2} Woodsman 10 20 (
                id=Guthry
                name= _ "Guthry"
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_STRONG}
                [/modifications]
                {IS_LOYAL}
            )}

            {SPEAKER_GENERIC_IF (id=Guthry) ( _ "female^Thieving dryad! Despicable elf! I hope the orcs tear you both limb from limb! In fact, I intend to make sure of it!") {VARIABLE_NUMERICAL_EQUALS dryad_friend 1}}
            {SPEAKER_GENERIC_IF (id=Guthry) ( _ "male^Thieving dryad! Despicable elf! I hope the orcs tear you both limb from limb! In fact, I intend to make sure of it!") {VARIABLE_NUMERICAL_EQUALS dryad_friend 2}}
            {WILD_ALLIES}
        [/then]
        [/if]

        [if]
            {VARIABLE_GREATER_THAN troll_friend 0}
        [then]
            {UNIT $troll_friend "Troll Whelp" 9 2 (
                id=Slave
                name= _ "Slave"
                unrenamable=yes
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_STRONG}
                [/modifications]
                {IS_LOYAL}
            )}

            [if]
                {VARIABLE_GREATER_THAN troll_friend 1}
            [then]
                {VARIABLE speaker_id "Master Ooze 2"}
            [/then]
            [else]
                {VARIABLE speaker_id "Master Ooze"}
            [/else]
            [/if]

            {SPEAKER_GENERIC (id=$speaker_id) ( _ "(Your troll slave is ready for combat!)")}
        [/then]
        [/if]

        [if]
            {VARIABLE_GREATER_THAN slavers_friend 0}
        [then]
            {UNIT $slavers_friend Footpad 9 3 (
                id=Haffuz the Slaver
                name= _ "Haffuz the Slaver"
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_INTELLIGENT}
                [/modifications]
                {IS_LOYAL}
            )}
            {UNIT $slavers_friend Thug 8 2 (
                id=Gorl the Smasher
                name= _ "Gorl the Smasher"
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_STRONG}
                [/modifications]
                {IS_LOYAL}
            )}
            {UNIT $slavers_friend "Troll Whelp" 9 2 (
                id=Slave
                name= _ "Slave"
                unrenamable=yes
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_STRONG}
                [/modifications]
                {IS_LOYAL}
            )}

            [if]
                {VARIABLE_GREATER_THAN slavers_friend 1}
            [then]
                {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "Reporting for duty sir! We even brought the troll slav-- errr...troll mascot with us to help out!")}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "Reporting for duty ma'am! We even brought the troll slav-- errr...troll mascot with us to help out!")}
            [/else]
            [/if]
        [/then]
        [/if]

        [remove_item]
            x,y=3,6
        [/remove_item]

        {SPEAKER_GENERIC (id=Ram Aide) ( _ "Oi what a hangover!")}

        [if]
            {VARIABLE_LESS_THAN ram_friend 3}
        [then]
            {SPEAKER_GENERIC (id=Ram Aide) ( _ "What's this?! Th' entire town is up in arms and orcs are at th' gates? (Pats the gigantic barrel fondly) Baby, I'm gonna miss ya!")}
            [sound]
                name=dragonstick.ogg
            [/sound]
            [sound]
                name=flame-big.ogg
            [/sound]
            [color_adjust]
                red=200
                green=50
                blue=50
            [/color_adjust]
            [delay]
                time=10
            [/delay]
            [color_adjust]
                red=0
                green=0
                blue=0
            [/color_adjust]
            {NARRATOR_DEFAULT "items/oldbarrel.png" ( _ "Ram Aide uses the gigantic barrel of booze to incinerate the bridge into town and a good portion of the nearby road as well!")}
            [terrain]
                x=10
                y=15-16
                terrain=Ww
            [/terrain]
        [/then]
        [else]
            {SPEAKER_GENERIC (id=Ram Aide) ( _ "What's this?! Th' entire town is up in arms and orcs are at th' gates? (Groans) How did I drink that ENTIRE barrel?!")}
        [/else]
        [/if]

        {UNIT {F1} Rogue 17 13 (
            id=Shady Character
            name= _ "Shady Character"
            canrecruit=yes
        )}

        {CLEAR_VARIABLE speaker_id}
    #enddef

    #define IMPERIAL_ARMY_SUPPORT
        {UNIT $imperial_commander Dragoon 10 1 (
            id=Captain Koltz
            name= _ "Captain Koltz"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT $imperial_commander Cavalryman 9 1 (
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT $imperial_commander Cavalryman 11 1 (
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        )}
    
        [music]
            name=loyalists.ogg
            immediate=yes
        [/music]
        [music]
            name=heroes_rite.ogg
            append=yes
        [/music]
    #enddef

    #define IMPERIAL_ARMY_FORCES
        [modify_side]
            side={F2}
            user_team_name= _ "Imperial Army"
        [/modify_side]

        {UNIT {F2} "Great Mage" 10 1 (
            id=Imperial Mage
            name= _ "Master Keiron"
            canrecruit=yes
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} Javelineer 10 2 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} Fencer 7 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Heavy Infantryman" 8 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} Javelineer 9 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} Javelineer 11 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Heavy Infantryman" 12 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} Sergeant 13 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} Bowman 5 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} Spearman 6 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} Mage 14 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} Bowman 15 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
    #enddef

    #define OOZE_INFECTION SIDE X Y
        {VARIABLE ooze_type {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS ooze_type 1}
        [then]
            {VARIABLE ooze_large "Giant Ooze"}
            {VARIABLE master_ooze_id "Master Ooze"}
        [/then]
        [else]
            {VARIABLE ooze_large "Giant Ooze 2"}
            {VARIABLE master_ooze_id "Master Ooze 2"}
        [/else]
        [/if]

        [modify_side]
            side={SIDE}
            team_name=evil
            user_team_name= _ "Oozes"
        [/modify_side]

        [store_unit]
            [filter]
                side={SIDE}
                [not]
                    type=$ooze_large
                [/not]
                [not]
                    id=$master_ooze_id
                [/not]
             [/filter]
             kill=yes
             variable=more_ooze
        [/store_unit]

        [if]
            {VARIABLE_GREATER_THAN more_ooze[0].x 0}
        [then]
            {FOREACH more_ooze i}

            {GENERIC_UNIT {SIDE} $ooze_large $more_ooze[$i].x $more_ooze[$i].y}

            {NEXT i}
        [/then]
        [else]
            {GENERIC_UNIT {SIDE} $large_ooze {X} {Y}}
        [/else]
        [/if]

        {CLEAR_VARIABLE more_ooze}
        {CLEAR_VARIABLE ooze_large}
        {CLEAR_VARIABLE ooze_type}
        {CLEAR_VARIABLE master_ooze_id}
    #enddef

    #define BLACKFANG_ARMY_WAVE_01
        {UNIT {F2} "Orcish Archer" 1 20 (
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Grunt" 3 20 (
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Grunt" 5 20 (
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Wolf Rider" 7 20 (
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Wolf Rider" 9 20 (
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Leader" 11 20 (
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Young Ogre" 13 20 (
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Grunt" 15 20 (
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Young Ogre" 17 20 (
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Archer" 19 20 (
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
            [/modifications]
        )}
    #enddef

    #define BLACKFANG_ARMY_WAVE_02
        {SPEAKER_GENERIC (id=Kirielle the Realist) ( _ "They're using ogres to pile boulders up in the moat, to make it easier for their troops to cross! Blackfang is quite clever for an orc.")}

        [music]
            name=the_city_falls.ogg
            immediate=yes
        [/music]
        [music]
            name=casualties_of_war.ogg
            append=yes
        [/music]
        
        {UNIT {F2} "Young Ogre" 2 17 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Ogre" 19 18 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}

        [terrain]
            x=2,19
            y=16,16-17
            terrain=Wwf
        [/terrain]
    
        [sound]
            name=water-blast.wav
        [/sound]
    
        [redraw]
        [/redraw]
    
        {PLACE_IMAGE terrain/embellishments/stones-small.png 2 16}
        {PLACE_IMAGE terrain/embellishments/stones-small2.png 19 16}
        {PLACE_IMAGE terrain/embellishments/stones-small3.png 19 17}
        
        [terrain]
            x=18,3
            y=16,16-17
            terrain=Wwf
        [/terrain]

        [sound]
            name=water-blast.wav
        [/sound]
    
        [redraw]
        [/redraw]

        {PLACE_IMAGE terrain/embellishments/stones-small4.png 18 16}
        {PLACE_IMAGE terrain/embellishments/stones-small5.png 3 16}
        {PLACE_IMAGE terrain/embellishments/stones-small6.png 3 17}
    #enddef

    #define BLACKFANG_ARMY_WAVE_03
        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "It seems the orcs have hired naga mercenaries. They're trying to flank you!")}

        {UNIT {F2} "Naga Fighter" 1 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Naga Fighter" 1 3 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Naga Fighter" 1 5 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Naga Fighter" 20 1 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Naga Fighter" 20 3 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Naga Fighter" 20 5 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
    #enddef

    #define BLACKFANG_ARMY_WAVE_04
        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "It seems that the earlier attacks were only designed to test your defenses. The vanguard of the orcish army has finally arrived. They march toward the fort, shoulder to shoulder, for as far as the eye can see. You may be in trouble.")}

        {UNIT {F2} "Orcish Assassin" 1 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Grunt" 2 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Assassin" 3 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Archer" 4 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Leader" 5 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Wolf Rider" 6 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Grunt" 7 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Grunt" 8 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Young Ogre" 9 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Assassin" 10 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Wolf Rider" 11 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Leader" 12 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Archer" 13 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Grunt" 14 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Wolf Rider" 15 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Grunt" 16 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Archer" 17 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Young Ogre" 18 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Assassin" 19 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Grunt" 20 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
    #enddef

    #define BLACKFANG_ARMY_WAVE_05
        {UNIT {F2} "Orcish Crossbowman" 1 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Goblin Knight" 2 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Crossbowman" 3 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Warrior" 4 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Ogre" 5 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Slayer" 6 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Warrior" 7 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Goblin Knight" 8 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Crossbowman" 9 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Sovereign" 10 20 (
            id=Blackfang
            name= _ "Blackfang"
            canrecruit=yes
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Warrior" 11 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Ogre" 12 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Slayer" 13 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Warrior" 14 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Crossbowman" 15 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Goblin Knight" 16 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        )}
        {UNIT {F2} "Ogre" 17 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Warrior" 18 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Crossbowman" 19 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Orcish Slayer" 20 20 (
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}

        [music]
            name=northerners.ogg
            immediate=yes
        [/music]
    #enddef

    #define BLACKFANG_ARMY_WAVE_06
        {UNIT {F2} "Orcish Sovereign" 10 19 (
            id=Blackfang
            name= _ "Blackfang"
            canrecruit=yes
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        )}
        {UNIT {F2} "Direwolf Rider" 9 20 (
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_QUICK}
            [/modifications]
        )}
        {UNIT {F2} "Direwolf Rider" 11 20 (
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_QUICK}
            [/modifications]
        )}

        {SPEAKER_GENERIC (id=Blackfang) ( _ "Hah, what a bloodbath! Rally to me, men! We finish them now!")}
    #enddef

    #define SUDDEN_STRIKE
        [if]
            {VARIABLE_NUMERICAL_EQUALS sudden_strike 1}
        [then]
            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Naga mercenaries suddenly emerge from the town well!")}

            {UNIT {F2} "Naga Warrior" 6 6 (
                [modifications]
                    {TRAIT_RESILIENT}
                    {TRAIT_STRONG}
                [/modifications]
            )}
            {UNIT {F2} "Naga Fighter" 6 5 (
                [modifications]
                    {TRAIT_RESILIENT}
                    {TRAIT_STRONG}
                [/modifications]
            )}
            {UNIT {F2} "Naga Fighter" 7 6 (
                [modifications]
                    {TRAIT_RESILIENT}
                    {TRAIT_STRONG}
                [/modifications]
            )}
            {UNIT {F2} "Naga Fighter" 7 7 (
                [modifications]
                    {TRAIT_RESILIENT}
                    {TRAIT_STRONG}
                [/modifications]
            )}
            {UNIT {F2} "Naga Fighter" 6 7 (
                [modifications]
                    {TRAIT_RESILIENT}
                    {TRAIT_STRONG}
                [/modifications]
            )}
            {UNIT {F2} "Naga Fighter" 5 7 (
                [modifications]
                    {TRAIT_RESILIENT}
                    {TRAIT_STRONG}
                [/modifications]
            )}
            {UNIT {F2} "Naga Fighter" 5 6 (
                [modifications]
                    {TRAIT_RESILIENT}
                    {TRAIT_STRONG}
                [/modifications]
            )}
        [/then]
        [else]
            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "A necromancer and his minions suddenly burst out of the town crypt! It seems they, too, are in the pay of the orcs.")}

            {UNIT {F2} "Dark Sorcerer" 14 6 (
                [modifications]
                    {TRAIT_RESILIENT}
                    {TRAIT_STRONG}
                [/modifications]
            )}
            {GENERIC_UNIT {F2} "Walking Corpse" 13 6}
            {GENERIC_UNIT {F2} Ghoul 14 5}
            {GENERIC_UNIT {F2} "Walking Corpse" 15 6}
            {GENERIC_UNIT {F2} "Walking Corpse" 15 7}
            {GENERIC_UNIT {F2} Ghoul 14 7}
            {GENERIC_UNIT {F2} "Walking Corpse" 13 7}
        [/else]
        [/if]
    #enddef

    #define OOZE_DEFEAT ID_DIED ID_DEFEAT
        [event]
            name=last breath

            [filter]
                id={ID_DIED}
            [/filter]

            {SPEAKER_GENERIC (speaker=unit) ( _ "Gurgle!")}

            [if]
                {VARIABLE_LESS_THAN battle_stage 1}
            [then]
                {SPEAKER_GENERIC (id={ID_DEFEAT}) ( _ "(It seems you somehow remain connected to your companion ooze. When your other part dies you die as well...)")}
            [/then]
            [/if]
        [/event]

        [event]
            name=die

            [filter]
                id={ID_DIED}
            [/filter]

            [if]
                {VARIABLE_LESS_THAN battle_stage 1}
            [then]
                [endlevel]
                    result=defeat
                [/endlevel]
            [/then]
            [/if]
        [/event]

        [event]
            name=die

            [filter]
                id={ID_DIED}
            [/filter]
            [filter_second]
                side={F2}
            [/filter_second]

            [if]
                {VARIABLE_GREATER_THAN battle_stage 1}
            [then]
                {SPEAKER_GENERIC (id={ID_DEFEAT}) ( _ "(You have allowed the Imperial Mage to kill your companion ooze. A shockwave ripples through your consciousness, stunning you and handing victory to your hated Creator!")}

                [endlevel]
                    result=defeat
                [/endlevel]
            [/then]
            [/if]
        [/event]
    #enddef

    #define OOZE_VICTORY ID ID_DEFEATED SIDE SIDE_DEFEATED VICTOR DEFEATED
        [event]
            name=die

            [filter]
                id={ID_DEFEATED}
            [/filter]
            [filter_second]
                side={SIDE}
            [/filter_second]

            [if]
                {VARIABLE_GREATER_THAN battle_stage 3}
            [then]
                [if]
                    {VARIABLE_NUMERICAL_EQUALS ooze_alignment[DEFEATED] 1}
                [then]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "After the death of your companion ooze its progeny dissolve into harmless gelatinous puddles.")}
                [/then]
                [else]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "With their leader slain the remaining townsfolk flee the battle!")}
                [/else]
                [/if]

                {VARIABLE main_ooze_id {ID}}
                {VARIABLE victor {VICTOR}}

                [kill]
                    side={SIDE_DEFEATED}
                [/kill]

                [if]
                    {VARIABLE_NUMERICAL_EQUALS imperial_mage_dead 1}
                [then]
                    [fire_event]
                        name=ooze_campaign_epilogue
                    [/fire_event]
                [/then]
                [/if]
            [/then]
            [/if]
        [/event]
    #enddef

    #define SIDE_PROTAGONIST SIDE ID NAME TYPE SAVE_ID
        [side]
            side={SIDE}
            controller=human
            id={ID}
            save_id={SAVE_ID}
            name={NAME}
            unrenamable=yes
            type={TYPE}
            canrecruit=yes
            recruit=Peasant,Woodsman,Ruffian
            team_name=oozes
            user_team_name= _ "Oozes"
            gold=25
        [/side]
    #enddef

    #define SCENARIO_OBJECTIVES SIDE
        [objectives]
            side={SIDE}
            [objective]
                description= _ "Defend the Fort"
                condition=win
            [/objective]
            {DEATH_OOZE}
            {GOLD_CARRYOVER_NONE}
            {IS_LAST_SCENARIO}
        [/objectives]
    #enddef

    #define SCENARIO_OBJECTIVE_WIN
        [objective]
            description= _ "Kill your Creator!"
            condition=win
        [/objective]
    #enddef

    #define SCENARIO_OBJECTIVE_WIN1
        [objective]
            description= _ "Defeat your weak side!"
            condition=win
        [/objective]
    #enddef

    #define SCENARIO_OBJECTIVE_WIN2
        [objective]
            description= _ "Defeat your dark side!"
            condition=win
        [/objective]
    #enddef

    #define SCENARIO_OBJECTIVE_LOSE1
        [objective]
            description= _ "Allow your Creator to kill your weak side"
            condition=lose
        [/objective]
    #enddef

    #define SCENARIO_OBJECTIVE_LOSE2
        [objective]
            description= _ "Allow your Creator to kill your dark side"
            condition=lose
        [/objective]
    #enddef

    #define DEATH_MASTER_OOZE2
        [objective]
            description= _ "Death of the Master Ooze 2"
            condition=lose
        [/objective]
    #enddef

    #define SIEGE_RULES
        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Note: In this scenario you will no longer share gold with your partner.")}
    #enddef

    # ===================================================================================================================== #
    # SCENARIO DEFINITION
    # ===================================================================================================================== #

    {PLACE_IMAGE scenery/leanto.png 3 7}
    {PLACE_IMAGE scenery/signpost.png 11 18}
    {PLACE_IMAGE scenery/temple1.png 14 6}
    {PLACE_IMAGE scenery/tent-fancy-red.png 18 7}
    {PLACE_IMAGE scenery/well.png 6 6}
    {PLACE_IMAGE items/archery-target-right.png 17 9}
    {PLACE_IMAGE items/archery-target-right.png 18 9}
    {PLACE_IMAGE items/scarecrow.png 16 3}
    {PLACE_IMAGE items/oldbarrel.png 3 6}
    #{PLACE_IMAGE items/barrel.png 3 6}
    {PLACE_IMAGE items/gohere.png 17 12}

    {SIDE_PROTAGONIST {P1} "Master Ooze" ( _ "Master Ooze") "Elvish Shaman Ooze" Ooze}
    {SIDE_PROTAGONIST {P2} "Master Ooze 2" ( _ "Master Ooze 2") "Elvish Fighter" Ooze2}
    
    [side]
        side={F1}
        controller=ai
        allow_player=no
        no_leader=yes
        gold=0
        income=-2
        [ai]
            ai_algorithm=idle_ai
        [/ai]
        team_name=oozes
        user_team_name= _ "Oozes"
    [/side]
    
    [side]
        side={F2}
        controller=ai
        allow_player=no
        no_leader=yes
        team_name=enemies
        user_team_name={S_ORCS}
        gold=0
        color=black
        [ai]
            aggression=1.0
            leader_value=2
            village_value=1
            grouping=yes
            caution=0.0
            recruitment_pattern=scout
        [/ai]
    [/side]

    # ===================================================================================================================== #
    # SCENARIO SETUP EVENTS
    # ===================================================================================================================== #

    [event]
        name=preload
        first_time_only=no

        [if]
            [have_unit]
                id=Shady Character
            [/have_unit]
        [then]
            [capture_village] 
                x=17
                y=13
                side={P1}
            [/capture_village]    
        [/then]
        [/if]
    [/event]

    [event]
        name=prestart

        {SCENARIO_OBJECTIVES {P1}}
        {SCENARIO_OBJECTIVES {P2}}

        {CREATE_SOLID_LEADER {P1}}
        {CREATE_SOLID_LEADER {P2}}

        {CLEAR_VARIABLE ooze_store}

        [terrain]
            x=10
            y=19
            terrain=Re
        [/terrain]
        [terrain]
            x=12
            y=18
            terrain=Gg
        [/terrain]

        {TELEPORT_UNIT (id=Master Ooze) 10 10}
        {TELEPORT_UNIT (id=Master Ooze 2) 10 5}
    [/event]
    
    [event]
        name=side {P1} turn 1

        # SIDE RECRUITS

        {SET_SOLID {P1}}
        {SET_SOLID {P2}}

        # VARIABLE INITIALIZATION

        {INITIALIZE_VARIABLES}

        # SET SCENARIO EVENTS

        # Note: All random events are set in one place to avoid possible OOS. Although this might be unneccessery now...

        {RANDOMIZE_SCENARIO}

        # DEFENDER UNITS

        # Note: Defenders will unconditionally TAKE a part in upcoming battle. However who will command them depends on player
        #       choices from previous scenario

        {TOWNSFOLK}
        {FORM_DEFENDER_FORCES}

        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "That night there is a commotion at the Mayor's Manor.")}

        {BLACKFANG_ARMY_WAVE_01}

        {NARRATOR_DEFAULT "units/orcs/assassin.png" ( _ "An orcish assassin has snuck into town and poisoned the Mayor and his bodyguards! Meanwhile a massive horde of orcs surges out of the wilderness and surrounds the fort. They clearly intend to sack the leaderless human town and kill everyone within it.")}
        {SPEAKER_GENERIC (id=Master Ooze) ( _ "(You realize that you have no choice but to try and unite the leaderless Solids and drive back the orcs).")}
        {SPEAKER_GENERIC (id=Jedd) ( _ "Oh we're doomed, doomed! There's hundreds of orcs! There is no hope.")}
        {SPEAKER_GENERIC (id=Master Ooze) ( _ "I will organize the fort's defense if others will follow me.")}
        {SPEAKER_GENERIC (id=Frist) ( _ "Aye lass, I'll follow ye to the Hells and back! Yer the most talented student I ever had!")}
        {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Count me in as well.")}
        {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "Come on citizens of Pinewood, let's give these orcs a lesson they won't forget!")}
        {SPEAKER_GENERIC (id=Brock) ( _ "No damned orc is gonna get his filthy claws on my tavern!")}
        {SPEAKER_GENERIC (id=Valin) ( _ "Let COURAGE be our vanguard and DOUBT our whipping-boy! To GLORY!")}
        {SPEAKER_GENERIC (id=Kirielle the Realist) ( _ "Looks like our quarry has come to us.")}
        {SPEAKER_GENERIC (id=Bryony the Idealist) ( _ "You're sure this is Blackfang's army?")}
        {SPEAKER_GENERIC (id=Kirielle the Realist) ( _ "Yeah, you can tell by their battle standards.")}
        {SPEAKER_GENERIC (id=Bryony the Idealist) ( _ "There sure are a lot of them. I assume you have some sort of plan?")}
        {SPEAKER_GENERIC (id=Kirielle the Realist) ( _ "Just follow the so-called elven sorceress for now.")}
        {SPEAKER_GENERIC (id=Bryony the Idealist) ( _ "What do you mean 'so-called sorceress'?! She is a sorceress!")}
        {SPEAKER_GENERIC (id=Kirielle the Realist) ( _ "Bryony, how many times have I told you that what appears to be true and what is actually true can be two very different things? I was planning to kill the creature but now it may be of use to us.")}
        {SPEAKER_GENERIC (id=Bryony the Idealist) ( _ "What creature? Why do you always have to speak in riddles?")}
        {SPEAKER_GENERIC (id=Kirielle the Realist) ( _ "(Sigh) Just start shooting orcs, all right?")}

        # VOLUNTEER UNITS

        # Note: Volunter units MAY take a part in upcoming battle. However this depends on player actions taken in previous 
        #       scenario

        {FORM_VOLUNTEER_FORCES}

        # CAPTURE VILLAGES

        # Note: This step should be taken unconditionally after placing units on the map since we don't know to whom they
        #       belong to. However villages are already assigned to sides. If we do otherwise we just capture village for owner
        #       of a unit!

        [capture_village]
            x=6,4,16,16,17
            y=8,3,6,10,13
            side={P1}
        [/capture_village]
        [capture_village]
            x=3,6,14,14,14
            y=11,4,4,8,12
            side={P2}
        [/capture_village]

        {SIEGE_RULES}
    [/event]

    [event]
        name=side {P2} turn 1

        {SIEGE_RULES}
    [/event]

    # ===================================================================================================================== #
    # BATTLE
    # ===================================================================================================================== #
    # In this section are described all battle events
    # ===================================================================================================================== #

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P1}
            x=17
            y=12
            [not]
                race=monster
            [/not]
        [/filter]

        {SHADY_INTRODUCTION {P1}}    
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P2}
            x=17
            y=12
            [not]
                race=monster
            [/not]
        [/filter]

        {SHADY_INTRODUCTION {P2}}    
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=17
            y=12
            [not]
                race=monster
            [/not]
        [/filter]

        {SHADY_TRANSACTIONS {P1}}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=17
            y=12
            [not]
                race=monster
            [/not]
        [/filter]

        {SHADY_TRANSACTIONS {P2}}
    [/event]

    [event]
        name=attack

        [filter]
            id=Guthry
        [/filter]

        [filter_second]
            id=$traitor_id
        [/filter_second]

        [if]
            {VARIABLE_GREATER_THAN dryad_friend 0}
        [then]
            {SPEAKER_GENERIC (id=Guthry) ( _ "No one crosses me and gets away with it!")}
        [/then]
        [/if]
    [/event]

    [event]
        name=turn 2

        {BLACKFANG_ARMY_WAVE_02}        
    [/event]

    [event]
        name=turn 5

        {BLACKFANG_ARMY_WAVE_03}
    [/event]

    [event]
        name=side {P1} turn 5

        {GUTHRY_EAGER {P1}}
    [/event]

    [event]
        name=side {P2} turn 5

        {GUTHRY_EAGER {P2}}
    [/event]

    [event]
        name=turn 10

        {BLACKFANG_ARMY_WAVE_04}
    [/event]

    [event]
        name=turn 15

        {SUDDEN_STRIKE}
    [/event]

    [event]
        name=turn 20

        {BLACKFANG_ARMY_WAVE_05}

        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "The ranks of the orc horde part momentarily to make way for the largest orc you have ever seen. His black spiked armor and sword mark him as Blackfang, leader of the Black Horde.")}
        {SPEAKER_GENERIC (id=Blackfang) ( _ "Blackfang IS HERE!!!")}
        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "The orcs cheer and howl in applause, waving tattered banners in homage to their brutal leader.")}
        {SPEAKER_GENERIC (id=Blackfang) ( _ "Already this fort's defenses are wavering, and I haven't even sent in my veterans yet. How pathetic. If I'd known it would be this easy to raze Pinewood, I'd have attacked months ago!")}
        {SPEAKER_GENERIC (id=Blackfang) ( _ "Well troops, you know the drill: Kill everyone. Destroy everything. The orc who brings me their leader's head on a pike gets an immediate promotion!")}
        {SPEAKER_GENERIC (id=Master Ooze) ( _ "This is impossible! There's just too many of them and not enough of us!")}

        {IMPERIAL_ARMY_SUPPORT}

        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Suddenly a small formation of Imperial calvary appears on the horizon! They smash through a platoon of orcish infantry and reach the north side of the fort! The surviving townsfolk are beside themselves with joy.")}
        {SPEAKER_GENERIC (id=Blackfang) ( _ "How annoying! Leave it to the Imperial Army to show up and ruin a perfectly good day.")}
        {SPEAKER_GENERIC (id=Captain Koltz) ( _ "Looks like we arrived just in time! Are you in charge here?")}
        {SPEAKER_GENERIC (id=Master Ooze) ( _ "Yes.")}
        {SPEAKER_GENERIC (id=Captain Koltz) ( _ "I'm Captain Koltz, 5th Imperial Cavalry Troop, at your service. You should know that an Imperial Councilman is also on his way to assist in the defense of the fort. He's bringing his personal bodyguards with him. I'm not sure if he'll arrive by the time the battle is finished though.")}
        {SPEAKER_GENERIC (id=Captain Koltz) ( _ "We cut our way through some of the orcs besieging the fort, but it looks like orcish reinforcements have already closed the gap we made. Looks like we're stuck here with you.")}
        {SPEAKER_GENERIC (id=Master Ooze) ( _ "Yes, I'm afraid it's going to be a fight to the finish.")}
        {SPEAKER_GENERIC (id=Captain Koltz) ( _ "We're outnumbered at least twenty to one, but perhaps if we kill the orcish leader we'll be able to escape the fort in the ensuing chaos.")}
        {SPEAKER_GENERIC (id=Master Ooze) ( _ "There hasn't been an opportunity to strike at Blackfang directly yet.")}
        {SPEAKER_GENERIC (id=Captain Koltz) ( _ "Then we must bide our time and conserve our numbers. If we kill enough orcs, Blackfang might be goaded into personally leading his troops in battle. That will be our time to strike.")}

        [kill]
            id=Blackfang
        [/kill]
    [/event]

    [event]
        name=turn 25

        {BLACKFANG_ARMY_WAVE_06}
    [/event]

    {LAST_BREATH Blackfang (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Hragh! How could I be beaten by someone so pathetic?")}

        [kill]
            id=$unit.id
            animate=yes
        [/kill]
        [kill]
            side={F2}
        [/kill]

        {VARIABLE battle_stage 1}

        [if]
            {VARIABLE_NUMERICAL_EQUALS second_unit.side 1}
        [then]
            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^The orcs, demoralized by the death of their leader, flee the battlefield! You are victorious!")}
            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^The defenders let out a ragged cheer as the last orcs disappear over the horizon. Slain orcs, smoldering fires, and broken weapons lie everywhere. Against impossible odds you saved Fort Pinewood from the Black Horde! Bards will surely sing praises of your heroism for generations to come!")}
        [/then]
        [else]
            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^The orcs, demoralized by the death of their leader, flee the battlefield! You are victorious!")}
            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^The defenders let out a ragged cheer as the last orcs disappear over the horizon. Slain orcs, smoldering fires, and broken weapons lie everywhere. Against impossible odds you saved Fort Pinewood from the Black Horde! Bards will surely sing praises of your heroism for generations to come!")}
        [/else]
        [/if]

        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "The bloodied, weary townsfolk begin to turn to the task of helping the wounded and repairing the extensive damage to the fort. More Imperial reinforcements arrive, too late to affect the outcome of the battle. But you soon realize that these newcomers are not normal Imperial soldiers.")}

        {IMPERIAL_ARMY_FORCES}

        {POSITION_UNITS (10,9,10,11,9,10,11) (5,5,4,5,6,6,6) 16 4}
        {POSITION_UNITS (10,9,10,11,9,10,11) (10,10,9,10,11,11,11) 4 7}
        {TELEPORT_UNIT id="Master Ooze" 10 5}
        {TELEPORT_UNIT id="Master Ooze 2" 10 10}

        {VARIABLE idle_mode 1}
    
        [end_turn]
        [/end_turn]
    )}

    # ===================================================================================================================== #
    # FINAL BATTLE
    # ===================================================================================================================== #
    # In this section are described final story twists. Choices taken by player in this moment have greatest impact at
    # campaign ending.
    # ===================================================================================================================== #

    {IMPERIAL_ARMY_REINFORCEMENTS {F2}}

    [event]
        name=side {P1} turn
        first_time_only=no

        [if]
            {VARIABLE_NUMERICAL_EQUALS battle_stage 1}
            [and]
                {VARIABLE_LESS_THAN imperial_mage_talk 1}
            [/and]
        [then]
            {VARIABLE imperial_mage_talk 1}
            {SPEAKER_GENERIC (id=Imperial Mage) ( _ "(Gazes calmly at the the wrecked fort) Ah Pinewood. I remember when this place was nothing more than a few huts by a trade crossroads. It's good to be back!")}
            {SPEAKER_GENERIC (id=Master Ooze) ( _ "There will be time for nostalgia later, sir! We've got wounded soldiers that need help!")}
            {SPEAKER_GENERIC (id=Imperial Mage) ( _ "(He seems to be talking to himself) It speaks, it speaks! Oh how wonderful! I feel like I've met the child I never knew I had!")}
            {SPEAKER_GENERIC (id=Master Ooze) ( _ "(Is this man crazy?)")}
            {SPEAKER_GENERIC (id=Imperial Mage) ( _ "Yes, yes, it was in my youth that I made you. A harmless pastime, really. To try to create Life itself is...difficult. Impossible perhaps? A thousand failures and finally my one success...you!")}
            {SPEAKER_GENERIC (id=Master Ooze) ( _ "(You have a very odd feeling about this old man. You're certain you've never met him before yet he seems strangely familiar...)")}
            {SPEAKER_GENERIC (id=Imperial Mage) ( _ "It took a bit of my life, my spirit, if you will, to finally do it. To give you life. Alas, urgent business at the Imperial Court called me away from my studies, all those years ago. But I never forgot about you, oh no!")}
            {SPEAKER_GENERIC (id=Master Ooze) ( _ "(Did this man create you? Your memories of those early years in the ruined underground laboratory are hazy and vague...your mind is so much more clear and sharp since you've taken over the elf.)")}
            {SPEAKER_GENERIC (id=Imperial Mage) ( _ "And look how you've grown, evolved! No longer a mere ooze, you've taken solid form! Your lifeforce has increased a hundredfold! You're my project, my baby, the object of so many countless hours of research...come forth and let me see you in your true form!")}
            {SPEAKER_GENERIC (id=Master Ooze) ( _ "(Your Solid form shudders and spasms. Somehow the mage has magically compelled you to come out of your hiding place!)")}
            {GENERIC_UNIT {P1} "Giant Ooze" 9 5}
            {GENERIC_UNIT {P1} "Giant Ooze" 10 4}
            {GENERIC_UNIT {P1} "Giant Ooze" 11 5}
            {GENERIC_UNIT {P1} "Giant Ooze" 9 6}
            {GENERIC_UNIT {P1} "Giant Ooze" 10 6}
            {GENERIC_UNIT {P1} "Giant Ooze" 11 6}
            {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "(Strangely you feel that urge too. You double over and vomit up oozes!)")}
            {GENERIC_UNIT {P2} "Giant Ooze 2" 9 10}
            {GENERIC_UNIT {P2} "Giant Ooze 2" 10 9}
            {GENERIC_UNIT {P2} "Giant Ooze 2" 11 10}
            {GENERIC_UNIT {P2} "Giant Ooze 2" 9 11}
            {GENERIC_UNIT {P2} "Giant Ooze 2" 10 11}
            {GENERIC_UNIT {P2} "Giant Ooze 2" 11 11}
            {SPEAKER_GENERIC (id=Master Ooze) ( _ "(You vomit up great quantities of slimy ooze! The townsfolk, who only moments ago looked upon you as their leader and savior, now look at you with revulsion and horror.)")}
            {SPEAKER_GENERIC (id=Imperial Mage) ( _ "Oh, how beautiful you are... It seems that you even developed a second personality. Amazing! Some kind of sibling, perhaps? That's very interesting...")}
            {SPEAKER_GENERIC (id=Imperial Mage) ( _ "My work on the Imperial Council has kept me busy. However when I heard rumors of a disturbance in the Pinewood territories I somehow knew you were behind it. We are linked, born of one spirit.")}
            {SPEAKER_GENERIC (id=Imperial Mage) ( _ "What a terrible shame I'm going to have to kill you.")}
            [music]
                name=legends_of_the_north.ogg
                immediate=yes
            [/music]
            {SPEAKER_GENERIC (id=Imperial Mage) ( _ "In truth you're a victim of your own success. By eating hundreds of creatures you've greatly increased your size and lifeforce. Now I will take that lifeforce back into myself, becoming the most powerful mage ever! Not even the Emperor will be able to stand against me!")}
            {SPEAKER_SPECIAL (id=Master Ooze) ( _ "(How to respond?)") (
                {SPEAKER_OPTION ( _ "(Evil) If you can absorb my lifeforce then I can absorb yours! I'll devour you all!") (
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Once you've eaten your Creator you will be complete! Your allies from Pinewood will no longer aid you, but it doesn't matter. During your time in Pinewood you've contaminated the local well with tiny pieces of yourself. The townsfolk unwittingly drank the contaminated water, and now the oozes that had lain dormant within them erupt! Cries of shock and agony resonate throughout the fort as you devour the townsfolk from the inside out! Although you can't absorb the allies of your companion ooze it's not important since he is a part of you.")}
                    {OOZE_INFECTION {P1} 11 7}
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Now you've got a lot more oozes with which to eat your Creator!")}
                    [disallow_recruit]
                        side={P1}
                        type=Peasant,Ruffian,Woodsman
                    [/disallow_recruit]
                    {VARIABLE ooze_alignment[0] 1}
                )}
                {SPEAKER_OPTION ( _ "(Good) Citizens of Pinewood, I may be a monster but this mage is the greater evil! He didn't come to Pinewood to save you, only to slay me and plot treason against the Empire!") (
                    {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Treason against the Empire can never be forgiven! The mage dies first, I'll hold judgement on the ooze creature for now.")}
                    {SPEAKER_GENERIC (id=Alkar) ( _ "Whatever you are I owe you much and I will not abondon you.")}

                    [if]
                        {VARIABLE_GREATER_THAN fontaine_friend 1}
                    [then]
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "My Patron... I don't know what you are... but I will continue to fight with you, for now at least.")}
                    [/then]
                    [else]
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "My Muse?! I...don't know what you are anymore...but I will continue to fight with you, for now at least.")}
                    [/else]
                    [/if]

                    {SPEAKER_GENERIC (id=Ram Aide) ( _ "Oi! I've had waaay too many drinks! Now I'm see'n oozes come outta nowhere an' crazy wizards to boot!")}
                    {SPEAKER_GENERIC (id=Shady Character) ( _ "Don't worry, it's business as usual between us. I've sold weapons to far worse monsters than you, no offense.")}
                    {SPEAKER_GENERIC (id=High Priest Jal) ( _ "The shining light of Pelor will rain death and destruction upon those lacking in faith! The Imperial mage reeks of evil, the ooze less so. The mage will be slain first.")}
                    {SPEAKER_GENERIC (id=Corinna) ( _ "Fascinating! I've always wanted to study a magic ooze creature. Oh yes, and after this Imperial mage is dead I'm definitely taking his spellbooks!")}
                    {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Corinna is evil, the Empire is evil, now my elven benefactor is revealed as evil...so much evil in the world...Though I feel some evils may be redeemed, this mage is beyond salvation!")}
                    {SPEAKER_GENERIC (id=Jedd) ( _ "(Spits tobacco) Oh, a chance to kill a corrupt government official! I wouldn't miss this for the world!")}
                    {SPEAKER_GENERIC (id=Livius) ( _ "So this bastard mage thinks he can just waltz in here and 'absorb' my future culinary masterpiece?! Not on my watch!")}
                    {SPEAKER_GENERIC (id=Frist) ( _ "Ach, this is too complicated fer me ta figure out!")}
                    {SPEAKER_GENERIC (id=Valin) ( _ "KEIRON! You sir have lived the life of a COWARD and a TRAITOR! Now learn to die like a SOLDIER!")}
                    {SPEAKER_GENERIC (id=Brock) ( _ "If the ooze is supposed to be the bad guy, I guess that makes this Master Keiron fellow the REALLY bad guy!")}
                    {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "Don't worry, the contract between us is still valid! I make it a point not to let my customers' inherent nastiness get in the way of making a hefty profit!")}
                    {SPEAKER_GENERIC (id=Dryad) ( _ "You're an abomination against Nature, ooze creature! Yet, Pinewood will be far worse off if the power-crazed Imperial traitors win the battle today. I will continue to help you...for now!")}
                    {SPEAKER_GENERIC (id=Kirielle the Realist) ( _ "I swore to the Elven Council that I'd put an end to Blackfang's depredations. Thanks to the ooze creature, Blackfang is no more. We'll continue helping the ooze creature for now.")}
                    {SPEAKER_GENERIC (id=Bryony the Idealist) ( _ "If you say so Kirielle. I just wish things didn't always have to be so complicated.")}
                    {VARIABLE ooze_alignment[0] 2}
                )}
            )}

            {CLEAR_VARIABLE idle_mode}
            [end_turn]
            [/end_turn]
        [/then]
        [/if]
    [/event]

    [event]
        name=side {P2} turn
        first_time_only=no

        [if]
            {VARIABLE_NUMERICAL_EQUALS idle_mode 1}
        [then]
            [end_turn]
            [/end_turn]
        [/then]
        [else]
            [if]
                {VARIABLE_NUMERICAL_EQUALS battle_stage 1}
                [and]
                    {VARIABLE_NUMERICAL_EQUALS imperial_mage_talk 1}
                [/and]
            [then]
                {VARIABLE imperial_mage_talk 2}

                [if]
                    {VARIABLE_NUMERICAL_EQUALS ooze_alignment[0] 1}
                [then]
                    {SPEAKER_SPECIAL (id=Master Ooze 2) ( _ "Your allies stand in shock. It's hard for them to believe what just happened. It's time for your decision...") (
                        {SPEAKER_OPTION ( _ "(Evil) At last we will become one!") (
                            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Once you've eaten your Creator you will be complete! Your allies from Pinewood will no longer aid you, but it doesn't matter. During your time in Pinewood you've contaminated the local well with tiny pieces of yourself. The townsfolk unwittingly drank the contaminated water, and now the oozes that had lain dormant within them erupt!")}
                            {OOZE_INFECTION {P2} 11 9}
                            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Now you've got a lot more oozes with which to eat your Creator!")}
                            [disallow_recruit]
                                side={P2}
                                type=Peasant,Ruffian,Woodsman
                            [/disallow_recruit]
                            {VARIABLE ooze_alignment[1] 1}
                        )}
                        {SPEAKER_OPTION ( _ "(Good) No, I won't do this.") (
                            [store_unit]
                                variable=ally
                                kill=no
                                [filter]
                                    side={P2}
                                    [not]
                                        type=Giant Ooze 2
                                    [/not]
                                    [not]
                                        id=Master Ooze 2
                                    [/not]
                                [/filter]
                            [/store_unit]
                            {SPEAKER_GENERIC (id=Master Ooze) ( _ "You won't do what?")}
                            {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "I won't murder these innocent people. It's not right!")}
                            {SPEAKER_GENERIC (id=Master Ooze) ( _ "(Sighs) I knew it from the beginning. You are everything that was weak in me... That's why your consciousness stayed separate from mine. It's sad because I'd grown rather fond of you. Perhaps it's because our elven hosts were lovers and their memories were imprinted onto our own. Or perhaps it's because you're the only other sentient ooze I've encountered in all my many years of existence. But now I see that I'm better off alone. That which I cannot control cannot be trusted and must be destroyed.")}
                            {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "Citizens, together we can stand against this monstrosity!")}
                            {SPEAKER_GENERIC (id=$ally.id) ( _ "But you are the same! How can we trust you now?!")}
                            {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "(You look deeply into Aurelia's eyes. You look for the part of her that your host loved...But now you see nothing but eternal hunger that can't be appeased...)")}
                            {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "(After a long while you speak) It's not what we are, but what we do that defines us...")}
                            {SPEAKER_GENERIC (id=Imperial Mage) ( _ "How very touching. The star-crossed lovers are torn apart by the cruel whims of Fate! I think I just might commission a play based on your story. But for now killing you both will serve as theatrics enough!")}
                            {VARIABLE ooze_alignment[1] 2}

                            {CLEAR_VARIABLE ally}
                        )}
                    )}
                [/then]
                [else]
                    {SPEAKER_SPECIAL (id=Master Ooze 2) ( _ "Your allies await your leadership. Its time for your decision...") (
                        {SPEAKER_OPTION ( _ "(Evil) No. All of you will be a part of ME!") (
                            [store_unit]
                                variable=ally
                                kill=no
                                [filter]
                                    side={P1}
                                    [not]
                                        type=Giant Ooze
                                    [/not]
                                    [not]
                                        id=Master Ooze
                                    [/not]
                                [/filter]
                            [/store_unit]
                            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Once you've eaten your Creator you will be complete! Your allies from Pinewood will no longer aid you, but it doesn't matter. During your time in Pinewood you've contaminated the local well with tiny pieces of yourself. The townsfolk unwittingly drank the contaminated water, and now the oozes that had lain dormant within them erupt! Cries of shock and agony resonate throughout the fort as you devour the townsfolk from the inside out! Unfortunately you can't absorb allies of your companion ooze.")}
                            {OOZE_INFECTION {P2} 11 9}
                            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Now you've got a lot more oozes with which to eat your Creator!")}
                            [disallow_recruit]
                                side={P2}
                                type=Peasant,Ruffian,Woodsman
                            [/disallow_recruit]
                            {SPEAKER_GENERIC (id=Master Ooze) ( _ "(Looks at you with sadness in her eyes) Why do you do this?")}
                            {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "The Solids are nothing but weak-willed fodder. Can't you see it? Their sole purpose in life is to serve as prey for predators like us.")}
                            {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "Die if you cannot understand! I will devour your weakness and become whole once again. There will be no more dissent, no more sympathy for our enemies. There will be only one voice, one mind, one ooze, one purpose, just as it was in the beginning!")}
                            {SPEAKER_GENERIC (id=Master Ooze) ( _ "Citizens! Please stand with me against my...companion. I fear he cannot be reasoned with.")}
                            {SPEAKER_GENERIC (id=$ally.id) ( _ "But you are the same! How can we trust you now?!")}
                            {SPEAKER_GENERIC (id=Master Ooze) ( _ "(You look deeply into Sithras's eyes. You look for the part of him that your host loved...But now you see nothing but eternal hunger that can't be appeased...)")}
                            {SPEAKER_GENERIC (id=Master Ooze) ( _ "(After a long while you speak) It's not what we are, but what we do that defines us...")}
                            {SPEAKER_GENERIC (id=Imperial Mage) ( _ "How very touching. The star-crossed lovers are torn apart by the cruel whims of Fate! I think I just might commission a play based on your story. But for now killing you both will serve as theatrics enough!")}
                            {VARIABLE ooze_alignment[1] 1}

                            {CLEAR_VARIABLE ally}
                        )}
                        {SPEAKER_OPTION ( _ "(Good) Cititzens of Pinewood we have defeated one villain! It's time to defeat another!") (
                            {VARIABLE ooze_alignment[1] 2}
                        )}
                    )}
                [/else]
                [/if]

                {VARIABLE idle_mode 1}
                [end_turn]
                [/end_turn]
            [/then]
            [/if]
        [/else]
        [/if]
    [/event]

    [event]
        name=side {F2} turn
        first_time_only=no

        [if]
            {VARIABLE_NUMERICAL_EQUALS idle_mode 1}
        [then]
            [end_turn]
            [/end_turn]
        [/then]
        [/if]
    [/event]

    [event]
        name=new turn
        first_time_only=no

        [if]
            {VARIABLE_NUMERICAL_EQUALS imperial_mage_talk 2}
            [and]
                {VARIABLE_GREATER_THAN ooze_alignment[0] 0}
            [/and]
            [and]
                {VARIABLE_GREATER_THAN ooze_alignment[1] 0}
            [/and]
        [then]
            {VARIABLE imperial_mage_talk 3}
            {CLEAR_VARIABLE idle_mode}

            [if]
                {VARIABLE_NUMERICAL_EQUALS ooze_alignment[0] $ooze_alignment[1]}
            [then]
                [if]
                    {VARIABLE_GREATER_THAN ooze_alignment[0] 1}
                [then]
                    {VARIABLE battle_stage 2}
                [/then]
                [else]
                    {VARIABLE battle_stage 3}
                [/else]  
                [/if]

                [objectives]
                    side={P1}
                    {SCENARIO_OBJECTIVE_WIN}
                    {DEATH_OOZE}
                    {GOLD_CARRYOVER_NONE}
                    {IS_LAST_SCENARIO}
                [/objectives]

                [objectives]
                    side={P2}
                    {SCENARIO_OBJECTIVE_WIN}
                    {DEATH_OOZE}
                    {GOLD_CARRYOVER_NONE}
                    {IS_LAST_SCENARIO}
                [/objectives]
            [/then]
            [else]
                [if]
                    {VARIABLE_GREATER_THAN ooze_alignment[0] $ooze_alignment[1]}
                [then]
                    {VARIABLE battle_stage 4}

                    [objectives]
                        side={P1}
                        {SCENARIO_OBJECTIVE_WIN2}
                        {SCENARIO_OBJECTIVE_WIN}
                        {DEATH_MASTER_OOZE}
                        {SCENARIO_OBJECTIVE_LOSE2}
                        {GOLD_CARRYOVER_NONE}
                        {IS_LAST_SCENARIO}
                    [/objectives]

                    [objectives]
                        side={P2}
                        {SCENARIO_OBJECTIVE_WIN1}
                        {SCENARIO_OBJECTIVE_WIN}
                        {DEATH_MASTER_OOZE2}
                        {SCENARIO_OBJECTIVE_LOSE1}
                        {GOLD_CARRYOVER_NONE}
                        {IS_LAST_SCENARIO}
                    [/objectives]
                [/then]
                [else]
                    {VARIABLE battle_stage 5}

                    [objectives]
                        side={P1}
                        {SCENARIO_OBJECTIVE_WIN1}
                        {SCENARIO_OBJECTIVE_WIN}
                        {DEATH_MASTER_OOZE}
                        {SCENARIO_OBJECTIVE_LOSE1}
                        {GOLD_CARRYOVER_NONE}
                        {IS_LAST_SCENARIO}
                    [/objectives]

                    [objectives]
                        side={P2}
                        {SCENARIO_OBJECTIVE_WIN2}
                        {SCENARIO_OBJECTIVE_WIN}
                        {DEATH_MASTER_OOZE2}
                        {SCENARIO_OBJECTIVE_LOSE2}
                        {GOLD_CARRYOVER_NONE}
                        {IS_LAST_SCENARIO}
                    [/objectives]
                [/else]  
                [/if]
            [/else]  
            [/if]
        [/then]  
        [/if]
    [/event]

    # ===================================================================================================================== #
    # CAMPAIGN HERO DEATHS
    # ===================================================================================================================== #

    {OOZE_DEFEAT "Master Ooze" "Master Ooze 2"}
    {OOZE_DEFEAT "Master Ooze 2" "Master Ooze"}

    {OOZE_VICTORY "Master Ooze 2" "Master Ooze" {P2} {P1} 1 0}
    {OOZE_VICTORY "Master Ooze" "Master Ooze 2" {P1} {P2} 0 1}

    # ===================================================================================================================== #
    # HERO DEATHS
    # ===================================================================================================================== #

    {LAST_BREATH "Shady Character" (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Ack! Why attack an innocent arms merchant like myself? I would have sold you quality weapons at an affordable price!")}
        [remove_item]
            x,y=17,12
        [/remove_item]
    )}
    {LAST_BREATH "Ram Aide" (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Ach! I hope there's lots of booze in Heaven...")}
    )}
    {LAST_BREATH "High Priest Jal" (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Ugn! I go...to meet...Pelor...")}
    )}
    {LAST_BREATH Jedd (
        [if]
            {VARIABLE_GREATER_THAN jedd_friend 1}
        [then]
            {SPEAKER_GENERIC (speaker=unit) ( _ "Fiend! I hope Sithras kills...you...all...ugn...")}
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=unit) ( _ "Fiend! I hope Aurelia kills...you...all...ugn...")}
        [/else]
        [/if]
    )}
    {LAST_BREATH Corinna (
        {SPEAKER_GENERIC (speaker=unit) ( _ "No! I'm too pretty to die!")}

        [if]
            [have_unit]
                id=Sir Dryden
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Corinna! NOOOOO!!!!")}
            [kill]
                id=Sir Dryden
            [/kill]
            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Wracked with grief, Sir Dryden has abandoned the fight!")}
        [/then]
        [/if]
    )}
    {LAST_BREATH "Sergeant Ryn" (
        {SPEAKER_GENERIC (speaker=unit) ( _ "I hope you drown in my blood, scum!")}
    )}
    {LAST_BREATH Livius (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Damn, now my book on exotic cooking will never be finished!")}
    )}
    {LAST_BREATH Frist (
        {SPEAKER_GENERIC (speaker=unit) ( _ "I did my best...my student Aurelia will finish this...ugn...")}
    )}
    {LAST_BREATH Valin (
        {SPEAKER_GENERIC (speaker=unit) ( _ "My DEATH will be AVENGED!!!")}
    )}
    {LAST_BREATH Brock (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Ach, I've finally met my match!")}
    )}
    {LAST_BREATH "Kirielle the Realist" (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Damn, I didn't count on them being this strong!")}
        {SPEAKER_GENERIC (speaker=unit) ( _ "Kirielle, please don't die!!! I'm coming to help you!")}
        [kill]
            id=Bryony the Idealist
        [/kill]
        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Bryony has abandoned the fight!")}
    )}
    {LAST_BREATH "Bryony the Idealist" (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Kirielle, I'm sorry...")}
        {SPEAKER_GENERIC (speaker=unit) ( _ "Bryony, you can't die!!! I'm coming to help you!")}
        [kill]
            id=Kirielle the Realist
        [/kill]
        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Kirielle has abandoned the fight!")}
    )}
    {LAST_BREATH "Sir Dryden" (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Why did it have to end like this! Corinna...has not been redeemed yet...ugn...")}
    )}
    {LAST_BREATH Fontaine (
        [if]
            {VARIABLE_GREATER_THAN fontaine_friend 1}
        [then]
            {SPEAKER_GENERIC (speaker=unit) ( _ "Well... I suppose... my patron that means you will not see my art any more...")}
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=unit) ( _ "I die now, alas, alas! I only wish to gaze into the angelic face of my Muse one last time...")}
        [/else]
        [/if]
    )}
    {LAST_BREATH Alkar (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Urgh! No glory for me...only death...")}
    )}
    {LAST_BREATH Guthry (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Usurpers! Stay away...from...my...land...ugn...")}
    )}
    {LAST_BREATH Dryad (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Now I return to the Earth...")}
    )}
    {LAST_BREATH "Captain Koltz" (
        {SPEAKER_GENERIC (speaker=unit) ( _ "I may die now but the Empire is eternal!")}
    )}
    {LAST_BREATH Slave (
        {SPEAKER_GENERIC (speaker=unit) ( _ "(Grunts in pain)")}
    )}
    {LAST_BREATH "Haffuz the Slaver" (
        {SPEAKER_GENERIC (speaker=unit) ( _ "Maybe getting into the bodyguard business wasn't such a good idea after all...")}
    )}
    {LAST_BREATH "Gorl the Smasher" (
        {SPEAKER_GENERIC (speaker=unit) ( _ "(Grunts)")}
    )}

    # ===================================================================================================================== #
    # ANTYHERO DEATH
    # ===================================================================================================================== #

    {LAST_BREATH "Imperial Mage" (
        {SPEAKER_GENERIC (speaker=unit) ( _ "No!!! Absolute power was within my...grasp...ugnh...")}
        {VARIABLE victor $unit.side}
        {VARIABLE_OP victor sub 1}

        [kill]
            id=$unit.id
            animate=yes
        [/kill]
        [kill]
            side={F2}
        [/kill]

        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Keiron's remaining men flee in disarray!")}

        [if]
            {VARIABLE_GREATER_THAN battle_stage 3}
        [then]
            [if]
                [not]
                    [have_unit]
                        side={P1}
                        id=Master Ooze
                    [/have_unit]
                [/not]
                [or]
                    [not]
                        [have_unit]
                            side={P2}
                            id=Master Ooze 2
                        [/have_unit]
                    [/not]
                [/or]
            [then]
                [fire_event]
                    name=ooze_campaign_epilogue
                [/fire_event]
            [/then]
            [else]
                {VARIABLE imperial_mage_dead 1}
            [/else]
            [/if]
        [/then]
        [else]
            [fire_event]
                name=ooze_campaign_epilogue
            [/fire_event]
        [/else]
        [/if]
    )}

    # ===================================================================================================================== #
    # EPILOGUE
    # ===================================================================================================================== #

    [event]
        name=ooze_campaign_epilogue

        [if]
            {VARIABLE_NUMERICAL_EQUALS ooze_alignment[$victor] 1}
        [then]
            [music]
                name=main_menu.ogg
                immediate=yes
            [/music]

            [if]
                {VARIABLE_GREATER_THAN battle_stage 3}
            [then]
                [if]
                    {VARIABLE_GREATER_THAN victor 0}
                [then]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^You have consumed your weak side and become stronger than ever!")}
                [/then]
                [else]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^You have consumed your weak side and become stronger than ever!")}
                [/else]
                [/if]
            [/then]
            [/if]

            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Your quest for power and security is complete! With the death of your Creator you feel great power surging through you, and your amorphous form quivers with energy. From now on, men and orcs will tremble with fear at the mere mention of your name, and those few who dare oppose you will be quickly devoured.")}

            [if]
                {VARIABLE_NUMERICAL_EQUALS victor 0}
            [then]
                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^Pinewood is abandoned by the forces of civilization, leaving you free to roam the vast wilderness in search of prey. In the new natural order you've created, you are at the very top of the food chain!")}
            [/then]
            [else]
                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^Pinewood is abandoned by the forces of civilization, leaving you free to roam the vast wilderness in search of prey. In the new natural order you've created, you are at the very top of the food chain!")}
            [/else]
            [/if]

            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "If you liked this campaign check out the sort-of sequel, Elvish Dynasty! Coming soon to the Wesnoth add-on server!")}
        [/then]
        [else]
            [music]
                name=main_menu.ogg
                immediate=yes
            [/music]

            [if]
                {VARIABLE_NUMERICAL_EQUALS victor 0}
            [then]
                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^EPILOGUE: You've defeated the Black Horde and your wicked Creator! With the death of your Creator you feel great power surging through you, and your amorphous form quivers with energy. The surviving townsfolk are wary of you, but they are also the first to admit that without your leadership the fort would have fallen.")}
                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^They offer to pardon you for any and all crimes you may have committed, and even offer you honorary Pinewood citizenship! Your time amongst the Solids has given you much to think about...")}
            [/then]
            [else]
                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^EPILOGUE: You've defeated the Black Horde and your wicked Creator! With the death of your Creator you feel great power surging through you, and your amorphous form quivers with energy. The surviving townsfolk are wary of you, but they are also the first to admit that without your leadership the fort would have fallen.")}
                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^They offer to pardon you for any and all crimes you may have committed, and even offer you honorary Pinewood citizenship! Your time amongst the Solids has given you much to think about...")}
            [/else]
            [/if]

            [if]
                {VARIABLE_GREATER_THAN battle_stage 3}
            [then]
                [if]
                    {VARIABLE_NUMERICAL_EQUALS victor 0}
                [then]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^To achieve this you have faced your dark side and won!")}
                [/then]
                [else]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^To achieve this you have faced your dark side and won!")}
                [/else]
                [/if]
            [/then]
            [/if]

            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "The fate of the surviving townsfolk:")}

            [if]
                {VARIABLE_NUMERICAL_EQUALS alkar_offer 4}
            [then]
                {SPEAKER_GENERIC (id=Alkar) ( _ "Becomes a famous mercenary.")}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=Alkar) ( _ "Becomes a townguard in Pinewood.")}
            [/else]
            [/if]

            {SPEAKER_GENERIC (id=Ram Aide) ( _ "Tries to get the townsfolk to buy him a new gigantic barrel of booze...unsuccessfully.")}
            {SPEAKER_GENERIC (id=High Priest Jal) ( _ "Takes charge of the town's wounded after the battle. Tries to get you to convert to the worship of Pelor.")}
            {SPEAKER_GENERIC (id=Kirielle the Realist) ( _ "The mysterious elf ranger disappears shortly after the battle and is not seen again.")}
            {SPEAKER_GENERIC (id=Bryony the Idealist) ( _ "Disappears with her companion, Kirielle.")}
            {SPEAKER_GENERIC (id=Frist) ( _ "Redoubles his efforts at training others in combat. Helps re-establish the Pinewood Militia.")}

            [if]
                {VARIABLE_GREATER_THAN battle_stage 3}
            [then]
                #po: Do not translate flamb
                {SPEAKER_GENERIC (id=Livius) ( _ "Becomes quite a wealthy man after opening a restaurant that specializes in exotic foods. The most expensive item on the menu is 'ooze flamb'!")}
            [/then]
            [else]
                [if]
                    {VARIABLE_NUMERICAL_EQUALS victor 0}
                [then]
                    {SPEAKER_GENERIC (id=Livius) ( _ "female^Has to give up his plans to cook and sell your corpse as an exotic culinary delicacy after you become the town hero. Goes off in search of other exotic ingredients for his recipes.")}
                [/then]
                [else]
                    {SPEAKER_GENERIC (id=Livius) ( _ "male^Has to give up his plans to cook and sell your corpse as an exotic culinary delicacy after you become the town hero. Goes off in search of other exotic ingredients for his recipes.")}
                [/else]
                [/if]
            [/else]
            [/if]

            {SPEAKER_GENERIC (id=Jedd) ( _ "After complaining for years about government bureaucrats that never did an honest day's work, Jedd is elected Mayor.")}
            {SPEAKER_GENERIC (id=Valin) ( _ "Takes his show on the road.")}
            {SPEAKER_GENERIC (id=Captain Koltz) ( _ "Rises to the rank of Colonel in the Imperial Army.")}
            {SPEAKER_GENERIC (id=Guthry) ( _ "Becomes a land speculator.")}
            {SPEAKER_GENERIC (id=Brock) ( _ "Continues to run his tavern. People from across the Empire come to challenge him to an armwrestling match; only a handful are able to best him.")}
            {SPEAKER_GENERIC (id=Dryad) ( _ "The tree-fairy returns to her tree once she is satisfied that Nature's balance has been restored.")}
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Becomes the new leader of the Pinewood Militia.")}
            {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "Gets out of the bodyguard business in search of easier money.")}

            [if]
                {VARIABLE_GREATER_THAN fontaine_friend 1}
            [then]
                {SPEAKER_GENERIC (id=Fontaine) ( _ "His artwork becomes famous and much sought after.")}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=Fontaine) ( _ "His artwork becomes famous and much sought after. He dedicates his paintings to his Muse.")}
            [/else]
            [/if]

            {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Marries the love of his life, Corinna. He thanks you for helping him get the 'wedding ring.'")}
        
            [if]
                {VARIABLE_LESS_THAN dryden_friend 1}
            [then]
                {SPEAKER_GENERIC (id=Corinna) ( _ "Becomes even more reclusive as she delves into the Dark Arts.")}
            [/then]
            [else]
                {SPEAKER_GENERIC_IF (id=Corinna) ( _ "Without Sir Dryden's moral guidance, Corinna overcomes the power of the Ring of Opposite Alignment and returns to studying the Dark Arts.") (
                    [not]
                        [have_unit]
                            id=Sir Dryden
                        [/have_unit]
                    [/not]
                )}
            [/else]
            [/if]

            [if]
                {VARIABLE_NUMERICAL_EQUALS victor 0}
            [then]
                {SPEAKER_GENERIC (id=$main_ooze_id) ( _ "female^You've won a great victory today. The future beckons you forward, and you're left to reflect on how far you've come...from a primitive creature in a dark cave, to an enlightened hero and savior of a town, it has been an extraordinary journey. You're certain that your future promises many great opportunities; all that's left to do is to decide which path to take!")}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=$main_ooze_id) ( _ "male^You've won a great victory today. The future beckons you forward, and you're left to reflect on how far you've come...from a primitive creature in a dark cave, to an enlightened hero and savior of a town, it has been an extraordinary journey. You're certain that your future promises many great opportunities; all that's left to do is to decide which path to take!")}
            [/else]
            [/if]
            {NARRATOR_DEFAULT wesnoth-icon.png ( _ "If you liked this campaign check out the sort-of sequel, Elvish Dynasty! Coming soon to the Wesnoth add-on server!")}
        [/else]
        [/if]

        {CLEAR_VARIABLE ooze_alignment}
        {CLEAR_VARIABLE imperial_mage_dead}
        {CLEAR_VARIABLE imperial_mage_talk}
        {CLEAR_VARIABLE alkar_offer}
        {CLEAR_VARIABLE upgrade_given}
        {CLEAR_VARIABLE sudden_strike}
        {CLEAR_VARIABLE allies_type}
        {CLEAR_VARIABLE dryad_friend}
        {CLEAR_VARIABLE troll_friend}
        {CLEAR_VARIABLE ram_friend}
        {CLEAR_VARIABLE jedd_friend}
        {CLEAR_VARIABLE slavers_friend}
        {CLEAR_VARIABLE dryden_friend}
        {CLEAR_VARIABLE fontaine_friend}
        {CLEAR_VARIABLE guthry_friend}
        {CLEAR_VARIABLE sithras_friend}
        {CLEAR_VARIABLE jal_friend}
        {CLEAR_VARIABLE livius_friend}
        {CLEAR_VARIABLE brock_friend}
        {CLEAR_VARIABLE valin_friend}
        {CLEAR_VARIABLE corinna_friend}
        {CLEAR_VARIABLE sergeant_ryn_friend}
        {CLEAR_VARIABLE bored_friend}
        {CLEAR_VARIABLE stern_friend}
        {CLEAR_VARIABLE leaderless_troops}
        {CLEAR_VARIABLE leadership_aurelia}
        {CLEAR_VARIABLE leadership_sithras}
        {CLEAR_VARIABLE aurelia_forces_overwhelm}
        {CLEAR_VARIABLE sithras_forces_overwhelm}
        {CLEAR_VARIABLE imperial_commander}
        {CLEAR_VARIABLE join_to_forces}
        {CLEAR_VARIABLE battle_stage}
        {CLEAR_VARIABLE main_ooze_id}
        {CLEAR_VARIABLE traitor_id}
        {CLEAR_VARIABLE victor}

        [endlevel]
            result=victory
        [/endlevel]
    [/event]

    #undef F1
    #undef F2
    #undef CREATE_SOLID_LEADER
    #undef SET_SOLID
    #undef INITIALIZE_VARIABLES
    #undef RANDOMIZE_SCENARIO
    #undef SPENT_GOLD
    #undef WEAPON_UPGRADE
    #undef SHADY_INTRODUCTION
    #undef SHADY_TRANSACTIONS
    #undef WILD_ALLIES
    #undef TOWNSFOLK
    #undef CAPTURE_LEADER
    #undef FORM_DEFENDER_FORCES
    #undef FORM_VOLUNTEER_FORCES
    #undef IMPERIAL_ARMY_SUPPORT
    #undef IMPERIAL_ARMY_FORCES
    #undef OOZE_INFECTION
    #undef BLACKFANG_ARMY_WAVE_01
    #undef BLACKFANG_ARMY_WAVE_02
    #undef BLACKFANG_ARMY_WAVE_03
    #undef BLACKFANG_ARMY_WAVE_04
    #undef BLACKFANG_ARMY_WAVE_05
    #undef BLACKFANG_ARMY_WAVE_06
    #undef SUDDEN_STRIKE
    #undef GUTHRY_EAGER
    #undef OOZE_DEFEAT
    #undef OOZE_VICTORY
    #undef SIDE_PROTAGONIST
    #under SCENARIO_OBJECTIVES
    #undef SCENARIO_OBJECTIVE_WIN
    #undef SCENARIO_OBJECTIVE_WIN1
    #undef SCENARIO_OBJECTIVE_WIN2
    #undef SCENARIO_OBJECTIVE_LOSE1
    #undef SCENARIO_OBJECTIVE_LOSE2
    #undef DEATH_MASTER_OOZE2
    #undef SIEGE_RULES
[/multiplayer]
