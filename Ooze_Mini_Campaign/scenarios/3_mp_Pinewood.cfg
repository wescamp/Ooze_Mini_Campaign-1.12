#textdomain wesnoth-Ooze_Mini_Campaign

    # ===================================================================================================================== #
    # 3 - PINEWOOD MULTIPLAYER SCENARIO
    # ===================================================================================================================== #
    # Last revision: 2013-01-27
    # ===================================================================================================================== #

[multiplayer]
    id=3_mp_Pinewood
    name= _ "Pinewood"
    next_scenario=4_mp_Pinewood_Siege
    experience_modifier=100
    shroud=no
    fog=no

    allow_new_game=no
    map_data="{~add-ons/Ooze_Mini_Campaign/maps/Fort_Pinewood.map}"
    {SCENARIO_MUSIC "wanderer.ogg"}
    {EXTRA_SCENARIO_MUSIC "nunc_dimittis.ogg"}
    {EXTRA_SCENARIO_MUSIC "the_king_is_dead.ogg"}
    {EXTRA_SCENARIO_MUSIC "traveling_minstrels.ogg"}

    turns=-1
    victory_when_enemies_defeated=no

    {AFTERNOON}

    # ===================================================================================================================== #
    # SCENARIO UTILS DEFINITIONS
    # ===================================================================================================================== #

    #define F1
        3#enddef

    #define F2
        4#enddef

    #define F3
        5#enddef

    #define TEAM_GOLD_VALUE
        [store_side]
            side={P1}
            variable=side
        [/store_side]
        {VARIABLE team_gold $side.gold}
        {CLEAR_VARIABLE side}
        [store_side]
            side={P2}
            variable=side
        [/store_side]
        {VARIABLE_OP team_gold add $side.gold}
        {CLEAR_VARIABLE side}
    #enddef

    #define TEAM_HAS_GOLD VALUE SIDE
        [store_side]
            side={SIDE}
            variable=side
        [/store_side]
        {VARIABLE gga {VALUE}}
        {VARIABLE ggl {VALUE}}
        {VARIABLE_OP ggl divide 2}
        {VARIABLE_OP ggl multiply 2}

        [if]
            {VARIABLE_NOT_EQUALS ggl $gga}
        [then]
            {VARIABLE_OP ggl divide 2}
            {VARIABLE_OP ggl add 1}
        [/then]
        [else]
            {VARIABLE_OP ggl divide 2}
        [/else]
        [/if]

        [if]
            [variable]
                name=team_gold
                greater_than_equal_to=$gga
            [/variable]
            [and]
                [variable]
                    name=side.gold
                    greater_than_equal_to=$ggl
                [/variable]
            [/and]
        [then]
            {VARIABLE has_gold yes}
        [/then]
        [else]
            {VARIABLE has_gold no}
        [/else]
        [/if]

        {CLEAR_VARIABLE side}
    #enddef

    #define TEAM_GOLD GAIN VALUE SIDE
        {VARIABLE master_ooze {SIDE}}
        {VARIABLE gain_gold {GAIN}}
        {VARIABLE gpa {VALUE}}
        {VARIABLE gpl {VALUE}}

        [sound]
            name=gold.ogg
        [/sound]

        [if]
            {VARIABLE_NOT_EQUALS gain_gold lost}
            [and]
                {VARIABLE_NOT_EQUALS gain_gold spent}
            [/and]
        [then]
            [if]
                {VARIABLE_EQUALS gain_gold win}
            [then]
                [if]
                    {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                [then]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^You are victorious and win $gpa gold pieces!")}
                [/then]
                [else]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^You are victorious and win $gpa gold pieces!")}
                [/else]
                [/if]
            [/then]
            [else]
                [if]
                    {VARIABLE_EQUALS gain_gold gain}
                [then]
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                    [then]
                        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^You gained $gpa gold pieces!")}
                    [/then]
                    [else]
                        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^You gained $gpa gold pieces!")}
                    [/else]
                    [/if]
                [/then]
                [else]
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                    [then]
                        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^You earned $gpa gold pieces!")}
                    [/then]
                    [else]
                        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^You earned $gpa gold pieces!")}
                    [/else]
                    [/if]
                [/else]
                [/if]
            [/else]
            [/if]   
            {VARIABLE_OP gpl divide 2}
            [gold]
                side={P1}
                amount=$gpl
            [/gold]
            [gold]
                side={P2}
                amount=$gpl
            [/gold]
            {VARIABLE_OP gpl multiply 2}
            [if]
                {VARIABLE_NOT_EQUALS gpl $gpa}
            [then]
                [gold]
                    side={SIDE}
                    amount=1
                [/gold]
            [/then]
            [/if]
        [/then]
        [else]
            [if]
                {VARIABLE_EQUALS gain_gold spent}
            [then]
                [if]
                    {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                [then]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^You spent $gpa gold pieces!")}
                [/then]
                [else]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^You spent $gpa gold pieces!")}
                [/else]
                [/if]
            [/then]
            [else]
                [if]
                    {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                [then]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^You lost $gpa gold pieces!")}
                [/then]
                [else]
                    {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^You lost $gpa gold pieces!")}
                [/else]
                [/if]
            [/else]
            [/if]

            {VARIABLE_OP gpl divide 2}
            [gold]
                side={P1}
                amount=-$gpl
            [/gold]
            [gold]
                side={P2}
                amount=-$gpl
            [/gold]
            {VARIABLE_OP gpl multiply 2}

            [if]
                {VARIABLE_NOT_EQUALS gpl $gpa}
            [then]
                [gold]
                    side={SIDE}
                    amount=-1
                [/gold]
            [/then]
            [/if]
        [/else]
        [/if]

        {TEAM_GOLD_VALUE}
    #enddef

    #define HAS_TRAITS
        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE have_strength[0] $have_strength[1]}
            {VARIABLE have_resilient[0] $have_resilient[1]}
            {VARIABLE have_dexterity[0] $have_dexterity[1]}
            {VARIABLE have_quickness[0] $have_quickness[1]}
        [/then]
        [else]
            {VARIABLE have_strength[0] $have_strength[2]}
            {VARIABLE have_resilient[0] $have_resilient[2]}
            {VARIABLE have_dexterity[0] $have_dexterity[2]}
            {VARIABLE have_quickness[0] $have_quickness[2]}
        [/else]     
        [/if]
    #enddef

    #define NO_TIME QUEST
        [if]
            {VARIABLE_LESS_THAN {QUEST} 1}
        [then]
            {SPEAKER_GENERIC (id=$unit.id) ( _ "(You have no time for this.)")}
        [/then]
        [/if]
    #enddef

    #define LEADERSHIP INCREASE SIDE
        {VARIABLE master_ooze {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE_OP leadership_aurelia add {INCREASE}}
        [/then]
        [else]
            {VARIABLE_OP leadership_sithras add {INCREASE}}
        [/else]
        [/if]
    #enddef

    #define SIDE_PROTAGONIST SIDE ID NAME TYPE SAVE_ID
        [side]
            side={SIDE}
            controller=human
            id={ID}
            save_id={SAVE_ID}
            name={NAME}
            unrenamable=yes
            type={TYPE}
            canrecruit=yes
            recruit=
            team_name=oozes
            user_team_name= _ "Oozes"
            gold=15
            income=-2
        [/side]
    #enddef

    #define SCENARIO_OBJECTIVES SIDE
        [objectives]
            side={SIDE}
            [objective]
                description= _ "Infiltrate Fort Pinewood in your new 'Solid' form. Cultivate allies and try to earn gold. Earn experience at the Training Hall."
                condition=win
            [/objective]
            {DEATH_OOZE}
            {GOLD_CARRYOVER_DEFAULT}
        [/objectives]
    #enddef

    #define SET_INITIATIVE ID ATTACKS
        [store_unit]
            [filter]
                id={ID}
            [/filter]
            variable=attacker
        [/store_unit]
        {VARIABLE attacker.attacks_left {ATTACKS}}
        [unstore_unit]
            find_vacant=no
            variable=attacker
        [/unstore_unit]
        {CLEAR_VARIABLE attacker}
    #enddef

    #define MASTER_OOZE_LOCATION SIDE
        {VARIABLE master_ooze {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE master_ooze_id "Master Ooze"}
        [/then]
        [else]
            {VARIABLE master_ooze_id "Master Ooze 2"}
        [/else]
        [/if]

        [store_unit]
            [filter]
                id=$master_ooze_id
            [/filter]
            variable=wandering_ooze
        [/store_unit]
        {CLEAR_VARIABLE master_ooze_id}
    #enddef

    #define MOVE_OOZE X Y STEP_X STEP_Y
        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE master_ooze_id "Master Ooze"}
            {VARIABLE other_ooze_id "Master Ooze 2"}
        [/then]
        [else]
            {VARIABLE master_ooze_id "Master Ooze 2"}
            {VARIABLE other_ooze_id "Master Ooze"}
        [/else]
        [/if]

        [store_unit]
            [filter]
                id=$other_ooze_id
            [/filter]
            variable=other_ooze
        [/store_unit]

        [if]
            {VARIABLE_NUMERICAL_EQUALS other_ooze.x {X}}
            [and]
                {VARIABLE_NUMERICAL_EQUALS other_ooze.y {Y}}
            [/and]
        [then]
            {MOVE_UNIT id=$other_ooze_id {STEP_X} {STEP_Y}}
            {MOVE_UNIT id=$master_ooze_id {X} {Y}}
        [/then]
        [else]
            {MOVE_UNIT id=$master_ooze_id {X} {Y}}
        [/else]
        [/if]

        {CLEAR_VARIABLE master_ooze_id}
        {CLEAR_VARIABLE other_ooze_id}
        {CLEAR_VARIABLE other_ooze}
    #enddef

    # ===================================================================================================================== #
    # STORY EVENTS DEFINITIONS
    # ===================================================================================================================== #

    #define MAYOR_WYATT SIDE
        {VARIABLE master_ooze {SIDE}}

        {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "(The Mayor appears to be a balding middle-aged man with an exuberant temperament. Based on his clothes and bearing, you guess that he must have been a farmer before taking up the aegis of politics)")}
        {SPEAKER_GENERIC_IF (id=Mayor Wyatt) ( _ "female^Greetings citizen! Have you come to aid our fair town in our hour of need?") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
        {SPEAKER_GENERIC_IF (id=Mayor Wyatt) ( _ "male^Greetings citizen! Have you come to aid our fair town in our hour of need?") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
        {SPEAKER_SPECIAL (id=$unit.id) ( _ "(How should you respond?)") (
            {SPEAKER_OPTION_IF ( _ "(Offer to help fight Evil) Yes, my name is Aurelia. I'm an elvish shaman and I'm here to help!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1} (
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "(He rubs his hands together with glee) Wonderful! Splendid! Let me explain the situation...")}
            )}
            {SPEAKER_OPTION_IF ( _ "(Offer to help fight Evil) Yes, my name is Sithras. I'm an elvish fighter and I'm here to help!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2} (
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "(He rubs his hands together with glee) Wonderful! Splendid! Let me explain the situation...")}
            )}
            {SPEAKER_OPTION ( _ "(Offer to help for a reward) I'm a mercenary. I can help, but my services will cost you.") (
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "Of course, of course! There's considerable risk involved in what I'm asking. I wouldn't dream of putting you in harm's way without providing proper...compensation.")}
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "Let me give you a quick briefing about what's been going on...")}
            )}
            {SPEAKER_OPTION_IF ( _ "female^(Decline to help) I'm just a simple traveler looking for a place to spend the night.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1} (
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "In that case madam, I highly recommend Brock's Tavern, which is located near the South Gate. The food is delicious, the rooms are cozy, and the prices are quite affordable. Please enjoy your stay in Fort Pinewood!")}
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "(He suddenly looks dejected) Or...at least, enjoy your stay as much as possible under the circumstances. (Sigh) Our town has had its share of troubles recently. Let me explain what's been going on...")}
            )}
            {SPEAKER_OPTION_IF ( _ "male^(Decline to help) I'm just a simple traveler looking for a place to spend the night.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2} (
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "In that case sir, I highly recommend Brock's Tavern, which is located near the South Gate. The food is delicious, the rooms are cozy, and the prices are quite affordable. Please enjoy your stay in Fort Pinewood!")}
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "(He suddenly looks dejected) Or...at least, enjoy your stay as much as possible under the circumstances. (Sigh) Our town has had its share of troubles recently. Let me explain what's been going on...")}
            )}
            {SPEAKER_OPTION_IF ( _ "female^(Provoke) I'm no hero! I'm the Master Ooze, come to devour you all!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1} (
                {SPEAKER_GENERIC (id=$unit.id) ( _ "female^(On second thought, as you look at the Mayor's four well-armored bodyguards, you decide that it might not be in your best interest to provoke a fight here. You need to become more powerful before you make a move to destroy the humans...)")}
                {SPEAKER_GENERIC (id=$unit.id) ( _ "female^(Decline to help) I'm just a simple traveler looking for a place to spend the night.")}
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "In that case madam, I highly recommend Brock's Tavern, which is located near the South Gate. The food is delicious, the rooms are cozy, and the prices are quite affordable. Please enjoy your stay in Fort Pinewood!")}
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "(He suddenly looks dejected) Or...at least, enjoy your stay as much as possible under the circumstances. (Sigh) Our town has had its share of troubles recently. Let me explain what's been going on...")}
            )}
            {SPEAKER_OPTION_IF ( _ "male^(Provoke) I'm no hero! I'm the Master Ooze, come to devour you all!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2} (
                {SPEAKER_GENERIC (id=$unit.id) ( _ "male^(On second thought, as you look at the Mayor's four well-armored bodyguards, you decide that it might not be in your best interest to provoke a fight here. You need to become more powerful before you make a move to destroy the humans...)")}
                {SPEAKER_GENERIC (id=$unit.id) ( _ "male^(Decline to help) I'm just a simple traveler looking for a place to spend the night.")}
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "In that case sir, I highly recommend Brock's Tavern, which is located near the South Gate. The food is delicious, the rooms are cozy, and the prices are quite affordable. Please enjoy your stay in Fort Pinewood!")}
                {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "(He suddenly looks dejected) Or...at least, enjoy your stay as much as possible under the circumstances. (Sigh) Our town has had its share of troubles recently. Let me explain what's been going on...")}
            )}
        )}
        {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "It all started when our militia leader led a punitive strike against the local goblin tribe. The strike force encountered an incredibly evil, powerful monster that devoured all in its path!")}
        {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "The Pinewood Militia suffered a crushing defeat, and our militia leader was killed. I've had all the outlying farmsteads evacuated as we no longer have the manpower to defend them. The Imperial Army is coming to our aid, but it'll be weeks before they arrive in force.")}
        {SPEAKER_GENERIC (id=Mayor Wyatt) ( _ "In the meantime I've been trying to recruit heroes and mercenaries to bolster the fort's defenses. I'm not just worried about the oozes; there's plenty of opportunistic orc warlords that would love to sack a poorly defended human town. If word of our militia's defeat spreads we may have more to worry about than just mindless oozes!")}
        {SPEAKER_GENERIC_IF (id=Mayor Wyatt) ( _ "female^If you're interested in helping with the town's defense, go speak with Frist at the Training Hall. You may also want to speak with some of the other townsfolk. They might, at the very least, be able to provide you with valuable information.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
        {SPEAKER_GENERIC_IF (id=Mayor Wyatt) ( _ "male^If you're interested in helping with the town's defense, go speak with Frist at the Training Hall. You may also want to speak with some of the other townsfolk. They might, at the very least, be able to provide you with valuable information.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS mayor_wyatt_speach 1}
        [then]
            [remove_item]
                x,y=10,11
            [/remove_item]
            {VARIABLE mayor_wyatt_speach 2}
        [/then]
        [/if]

        [if]
            {VARIABLE_LESS_THAN mayor_wyatt_speach 1}
        [then]
            {VARIABLE mayor_wyatt_speach 1}
        [/then]
        [/if]

        [if]
            {VARIABLE_GREATER_THAN mayor_wyatt_speach 1}
        [then]
            {MASTER_OOZE_LOCATION {SIDE}}
        [/then]
        [else]
            [allow_undo]
            [/allow_undo]
        [/else]
        [/if]
    #enddef

    #define DRYDEN_PROBLEM
        {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Oh, would that I might never see another day such as today, alas, alas!")}
        {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
            {SPEAKER_OPTION ( _ "(Offer to help) Hello sir. Is something wrong?") (
                [remove_item]
                    x,y=8,12
                [/remove_item]
                {VARIABLE quest_sir_dryden $master_ooze}
                {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "Oh fair damsel, I don't want to burden you with my problems. (He suddenly reconsiders) On the other hand, perhaps you're just what I need...") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "Oh good sir, I don't want to burden you with my problems. (He suddenly reconsiders) On the other hand, perhaps you're just what I need...") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "I'll tell you my tale of woe, and then you can decide whether to help me or not.")}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Last year I was traveling with a trade caravan in the icy steppes of Vedra when we were ambushed by orcs. Except for myself, there was only one other survivor, a beautiful and skilled mage by the name of Corinna.")}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "What can I say about Corinna? Her eyes are exquisite emeralds, her face is that of an angel, she is a goddess made flesh! With Corinna's magic and my paladin skills we became the perfect team. Together we defeated orcs, yetis, and other evils too terrible to mention. At night we hugged each other for warmth, warding off the relentless cold. And finally, after months of traveling together, the two of us made it back to civilization.")}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "We're the perfect team! The gods intended for us to be together, I'm sure of it!")}
                {SPEAKER_GENERIC (id=$unit.id) ( _ "You do sound like a good match. So what's the problem?")}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Corinna is evil and she hates me.")}
                {SPEAKER_GENERIC (id=$unit.id) ( _ "Ouch.")}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Tell me about it.")}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Once we got back to Fort Pinewood she wanted nothing to do with me! She said she only stayed with me to survive, that she never loved me! I feel like I've had my heart ripped out and trampled to a pulp!")}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Now she broods in her manor, studying dark tomes of forbidden magic. The last time I tried to visit her she attacked me, and placed what she called an 'Anti-Annoying Paladin Ward' around her estate. Some invisible force stops me from even passing through the front gate of her manor now!")}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "The tenets of my paladin Order clearly state that I must slay Evil wherever I find it, but how can I raise my sword against the woman I love? (Sigh) If only I could convince Corinna to abandon her dark magicks. How can one so beautiful be so ugly inside?")}
                {SPEAKER_GENERIC (id=$unit.id) ( _ "I guess appearances can be deceiving sometimes... (You wonder what Dryden would think of you if he saw your true form...)")}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "If you're willing to help, please take this love letter I wrote to Corinna at her estate. It's just west of the bridge.")}
                {VARIABLE dryden_quest 1}

                [if]
                    {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                [then]
                    {VARIABLE_OP quests_aurelia add 1}
                [/then]
                [else]
                    {VARIABLE_OP quests_sithras add 1}
                [/else]
                [/if]

                {PLACE_IMAGE items/gohere.png 4 10}
            )}
            {SPEAKER_OPTION_IF ( _ "female^(Leave him alone) Sorry to bother you...") {VARIABLE_NUMERICAL_EQUALS master_ooze 1} (
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "(The man is so self-absorbed in his sorrow that he doesn't even notice your arrival or departure.)")}
            )}
            {SPEAKER_OPTION_IF ( _ "male^(Leave him alone) Sorry to bother you...") {VARIABLE_NUMERICAL_EQUALS master_ooze 2} (
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "(The man is so self-absorbed in his sorrow that he doesn't even notice your arrival or departure.)")}
            )}
        )}
    #enddef

    #define DRYDEN_RESPONSE
        {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "female^(Eagerly) Were you able to get my letter to Corinna?") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
        {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "male^(Eagerly) Were you able to get my letter to Corinna?") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
        {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
            {SPEAKER_OPTION ( _ "(Tell the truth) I'm afraid so. She tried to hire me to get rid of you.") (
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "(Grimly) Then things are even worse than I feared. It is only a matter of time before Corinna's experiments in black magic come to the attention of the authorities. When that happens, my duty as a paladin will be clear: I will have to slay her. There is one...last chance...one last thing to try...to save Corinna from herself...if you would be willing to help.")}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "There is a cursed artifact known as a 'Ring of Opposite Alignment.' Supposedly it has the power to change the most pure-hearted hero to evil, or the most wicked villain to good. If we could acquire that ring and trick Corinna into wearing it perhaps she would develop a more...amenable personality.")}
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "I'm going to look into acquiring the ring. I'll be right back. (He leaves for a minute, then returns.)")}
                {VARIABLE dryden_quest 3}
            )}
            {SPEAKER_OPTION ( _ "(Lie) Corinna said that to win her heart you must travel to the far away land of Tyrakia and pick a crystal rose for her.") (
                [remove_item]
                    x,y=8,12
                [/remove_item]
                {SPEAKER_GENERIC (id=Sir Dryden) ( _ "A quest! A heroic quest to win the fair maiden's heart, just as in the stories of old! Oh Corinna, I will prove my worth to you in whatever way you desire! To Tyrakia!")}
                {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "And thank you, elf damsel, for helping me woo Corinna! Please take this gold as a reward!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "And thank you, good sir, for helping me woo Corinna! Please take this gold as a reward!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                {TEAM_GOLD gain 20 $master_ooze}
                [kill]
                    id=Sir Dryden
                [/kill]
                {VARIABLE dryden_quest 4}
                {PLACE_IMAGE items/gohere.png 4 10}
            )}
        )}
    #enddef

    #define PURCHASE_RING
        {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Unfortunately...the merchant is selling the Ring of Opposite Alignment for 50 pieces of gold, and due to my paladin vows of poverty I can't afford it.")}
        {TEAM_HAS_GOLD 50 $master_ooze}            
        [if]
            {VARIABLE_EQUALS has_gold yes}
        [then]
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
                {SPEAKER_OPTION ( _ "(Buy the ring) I'll pay for it.") (
                    [remove_item]
                        x,y=8,12
                    [/remove_item]
                    {TEAM_GOLD lost 50 $master_ooze}
                    {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "Milady, you are a saint! (He rushes off to get the ring and returns in a few minutes.)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                    {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "Sir, you are a saint! (He rushes off to get the ring and returns in a few minutes.)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                    {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Now you must convince Corinna to put on the ring. I'll leave the details up to you.")}
                    {NARRATOR_DEFAULT "items/ring-gold.png" ( _ "You got the Ring of Opposite Alignment!")}
                    {VARIABLE dryden_quest 5}
                    {PLACE_IMAGE items/gohere.png 4 10}
                )}
                {SPEAKER_OPTION ( _ "(Decline to help) Sorry, I can't help you right now.") (
                    {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "Of course, milady. I know it was a lot to ask. Thank you for all your help. I must now contemplate my next course of action.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                    {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "Of course, sir. I know it was a lot to ask. Thank you for all your help. I must now contemplate my next course of action.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                )}
            )}
        [/then]
        [else]
            {SPEAKER_GENERIC (id=$unit.id) ( _ "I'm sorry, I don't have that much money either.")}
            {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "Of course, milady. I know it was a lot to ask. Thank you for all your help. I must now contemplate my next course of action.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
            {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "Of course, sir. I know it was a lot to ask. Thank you for all your help. I must now contemplate my next course of action.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
            {SPEAKER_GENERIC (id=$unit.id) ( _ "(If you still want to help Sir Dryden you can come back later with the money.)")}
        [/else]
        [/if]
    #enddef 

    #define DRYDEN_WINS
        [remove_item]
            x,y=8,12
        [/remove_item]
        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^I gave her the ring and she put it on. I...guess it worked. At least, I'm assuming it did based on the fact she hasn't melted the flesh off your bones yet.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^I gave her the ring and she put it on. I...guess it worked. At least, I'm assuming it did based on the fact she hasn't melted the flesh off your bones yet.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
        {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Well, I guess that's good news. I must admit I was hoping for a more instantaneous transition to Good, but perhaps the ring takes time to work.")}
        {SPEAKER_GENERIC (id=$unit.id) ( _ "Or maybe she's just really, really evil.")}
        {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "Maybe. I'll have to wait and see. As for you milady, you have done more for me than I ever could have hoped for. If you ever need a paladin by your side, I will be there.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
        {SPEAKER_GENERIC_IF (id=Sir Dryden) ( _ "Maybe. I'll have to wait and see. As for you good sir, you have done more for me than I ever could have hoped for. If you ever need a paladin by your side, I will be there.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
        {SPEAKER_GENERIC (id=$unit.id) ( _ "Thank you.")}
        {VARIABLE corinna_friend $master_ooze}
        {VARIABLE dryden_friend $master_ooze}
        {VARIABLE_OP leaderless_troops sub 1}
        {LEADERSHIP 2 $master_ooze}
        {VARIABLE dryden_quest 8}
    #enddef

    #define DRYDEN_LOSES
        [remove_item]
            x,y=8,12
        [/remove_item]
        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^I gave her the ring but she didn't put it on and I don't think she's going to.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^I gave her the ring but she didn't put it on and I don't think she's going to.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
        {SPEAKER_GENERIC (id=Sir Dryden) ( _ "Nooo! All that effort, for nothing! I...I can't live like this...this unrequited love is consuming me from within! I must...flee Fort Pinewood before I go mad with grief.")}
        {VARIABLE dryden_quest 8}
        [kill]
            id=Sir Dryden
        [/kill]
    #enddef

    #define CORRINA_PROBLEM
        [remove_item]
            x,y=4,10
        [/remove_item]
        {SPEAKER_GENERIC (id=Corinna) ( _ "(This pretty young woman scowls at you as you approach.)")}
        {SPEAKER_GENERIC_IF (id=Corinna) ( _ "female^Let me guess. That tin-headed oaf of a paladin is still pining for me outside the gates of my estate, and he sent you to do his dirty work.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
        {SPEAKER_GENERIC_IF (id=Corinna) ( _ "male^Let me guess. That tin-headed oaf of a paladin is still pining for me outside the gates of my estate, and he sent you to do his dirty work.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
        {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
            [option]
                message= _ "(Be indifferent) That's right. I've got a letter for you."
            [/option]
            [option]
                message= _ "(Try to change her mind) But he loves you! He wrote you this love letter!"
            [/option]
            {SPEAKER_GENERIC (id=Corinna) ( _ "Not another one!")}
        )}
        {SPEAKER_GENERIC_IF (id=Corinna) ( _ "Look, I'll pay you 75 pieces of gold if you can get rid of Sir Dryden for me. Kill him, trick him, marry him, whatever, just make him go away!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
        {SPEAKER_GENERIC_IF (id=Corinna) ( _ "Look, I'll pay you 75 pieces of gold if you can get rid of Sir Dryden for me. Kill him, trick him, do whatever is necessary, just make him go away!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
        {SPEAKER_SPECIAL (id=$unit.id) ( _ "(How to respond to her offer?)") (
            {SPEAKER_OPTION ( _ "(Accept the offer) All right, I'll get rid of Sir Dryden for you.") (
                {SPEAKER_GENERIC (id=Corinna) ( _ "Thanks. Come back here when the job is done for your reward.")}
            )}
            {SPEAKER_OPTION ( _ "(Reject the offer) No! Sir Dryden was right about you, you're evil!") (
                {SPEAKER_GENERIC_IF (id=Corinna) ( _ "female^(Menacingly) You've worn out your welcome here. Leave. Now.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                {SPEAKER_GENERIC_IF (id=Corinna) ( _ "male^(Menacingly) You've worn out your welcome here. Leave. Now.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
            )}
        )}
        {PLACE_IMAGE items/gohere.png 8 12}
        {VARIABLE dryden_quest 2}
    #enddef

    #define CORRINA_WINS
        [remove_item]
            x,y=4,10
        [/remove_item]
        {SPEAKER_GENERIC (id=$unit.id) ( _ "Your paladin problem has been taken care of. (You relate the details of what happened.)")}
        {SPEAKER_GENERIC (id=Corinna) ( _ "Ha ha! What a clever way to get rid of that pompous fool! Here's your 75 gold, plus a little extra for your creativity!")}
        {TEAM_GOLD gain 90 $master_ooze}
        {VARIABLE corinna_friend $master_ooze}
        {VARIABLE_OP leaderless_troops sub 1}
        {LEADERSHIP 1 $master_ooze}
        {VARIABLE dryden_quest 8}
    #enddef

    #define CORRINA_CHOICE
        [remove_item]
            x,y=4,10
        [/remove_item]
        {SPEAKER_GENERIC (id=$unit.id) ( _ "I've got another gift for you from your admirer.")}
        {SPEAKER_GENERIC (id=Corinna) ( _ "How dare you waste my time with this!")}
        {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
            {SPEAKER_OPTION ( _ "(Lie) But you'll like this gift. It's a Ring of Magic Power!") (
                {SPEAKER_GENERIC (id=Corinna) ( _ "Well, maybe Dryden isn't as useless as he appeared. (She takes the ring and puts it on).")}
                {SPEAKER_GENERIC (id=Corinna) ( _ "(She gets angry) Wait a minute! This isn't a Ring of Magic Power! (She tries to take it off but can't) It's cursed! Why that lousy, conniving paladin! I'll melt the flesh off his bones! I'll...eh...(She swoons) Actually, my head hurts. I...I need to rest. Yes, rest, and think some things over.")}
                {VARIABLE dryden_quest 6}
            )}
            {SPEAKER_OPTION ( _ "(Tell the truth) Dryden is giving you a chance to turn your life around with this Ring of Opposite Alignment.") (
                {SPEAKER_GENERIC (id=Corinna) ( _ "So he's trying to befuddle me with a cursed ring, eh? I'll take the ring, as I might find some uses for it. Uses which will not, of course, include wearing it. Here's some money for your trouble, and give my regards to that idiot paladin! (She laughs cruelly.)")}
                {VARIABLE dryden_quest 7}
                {TEAM_GOLD gain 100 $master_ooze}
            )}
        )}
        {PLACE_IMAGE items/gohere.png 8 12}
    #enddef

    #define SIR_DRYDEN SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS dryden_quest 0}
        [then]
            {DRYDEN_PROBLEM}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS dryden_quest 2}
        [then]
            {DRYDEN_RESPONSE}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS dryden_quest 3}
        [then]
            {PURCHASE_RING}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS dryden_quest 6}
        [then]
            {DRYDEN_WINS}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS dryden_quest 7}
        [then]
            {DRYDEN_LOSES}
        [/then]
        [/if]
    #enddef

    #define CORRINA SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS dryden_quest 1}
        [then]
            {CORRINA_PROBLEM}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS dryden_quest 4}
        [then]
            {CORRINA_WINS}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS dryden_quest 5}
        [then]
            {CORRINA_CHOICE}
        [/then]
        [/if]
    #enddef

    #define FRIST SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {TEAM_HAS_GOLD 30 $master_ooze}

            [if]
                {VARIABLE_NUMERICAL_EQUALS have_training_aurelia 0}
                [and]
                    [not]
                        {VARIABLE_NUMERICAL_EQUALS quintains_released 1}
                    [/not]
                [/and]
            [then]
                {SPEAKER_GENERIC (id=Frist) ( _ "Welcome to th' Training Hall. If yer lookin' ta sharpen yer combat skills before taking on th' ooze hordes, yer in the right place!")}
                {SPEAKER_GENERIC (id=Frist) ( _ "Thirty gold will get ya four magical quintains ta hone yer skills on. They shouldn't be too difficult ta defeat, but if ye should happen ta get injured, High Priest Jal on the east side of town can fix ya up in a jiffy!")}
                {SPEAKER_GENERIC (id=Frist) ( _ "So what do ye say lass? Ready ta train?")}
                {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
                    {SPEAKER_OPTION ( _ "(Pay 30 gold) I'm ready to train!") (
                        [if]
                            {VARIABLE_EQUALS has_gold no}
                        [then]
                            {SPEAKER_GENERIC (id=Frist) ( _ "It looks like ye don't have that much. Come back when ye have more gold.")}
                        [/then]
                        [else]
                            {TEAM_GOLD lost 30 $master_ooze}
                            {SPEAKER_GENERIC (id=Frist) ( _ "Release the quintains!")}
                            {VARIABLE_OP training_aurelia add 1}
                            {VARIABLE quintains_released 1}
                            {GENERIC_UNIT {F3} Quintain0 7 9}
                            {GENERIC_UNIT {F3} Quintain0 7 10}
                            {GENERIC_UNIT {F3} Quintain0 8 8}
                            {GENERIC_UNIT {F3} Quintain0 8 9}
                        [/else]
                        [/if]
                    )}
                    {SPEAKER_OPTION ( _ "(Beg) I'm poor and I don't have 30 gold! But I'm training to help save Fort Pinewood!") (
                        [if]
                            {VARIABLE_EQUALS has_gold no}
                        [then]
                            {SPEAKER_GENERIC (id=Frist) ( _ "I'll be outta business if I just give away high quality quintain training for free ya know? On the other hand, I'll be outta business if the oozes overrun the town, so ya got yerself a deal lass-- you promise to help defend the fort, and I promise to fund your training!")}
                            {SPEAKER_GENERIC (id=Frist) ( _ "Release the quintains!")}
                            {VARIABLE_OP training_aurelia add 1}
                            {VARIABLE quintains_released 1}
                            {GENERIC_UNIT {F3} Quintain0 7 9}
                            {GENERIC_UNIT {F3} Quintain0 7 10}
                            {GENERIC_UNIT {F3} Quintain0 8 8}
                            {GENERIC_UNIT {F3} Quintain0 8 9}
                        [/then]
                        [else]
                            {SPEAKER_GENERIC (id=Frist) ( _ "I'll be outta business if I just give away high quality quintain training for free ya know? Besides, ye don't look that poor ta me.")}
                        [/else]
                        [/if]
                    )}
                    {SPEAKER_OPTION ( _ "(Leave) I'm not interested in training right now.") (
                        {SPEAKER_GENERIC (id=Frist) ( _ "Come back soon!")}
                    )}
                )}
            [/then]
            [/if]
        [/then]
        [else]
            [if]
                {VARIABLE_NUMERICAL_EQUALS have_training_sithras 0}
            [then]
                {SPEAKER_GENERIC (id=Frist) ( _ "Welcome to th' Training Hall. Yer lookin' ta sharpen yer combat skills before taking on th' ooze hordes, ya?")}
                {SPEAKER_GENERIC (id=Frist) ( _ "Ye look to me like a skilled fighter, so I'm afraid that ya won't learn anything here. Yer gonna have ta go ta the arena. Sergeant Ryn can help ya.")}
                {SPEAKER_GENERIC (id=Frist) ( _ "(He thinks for a little while.) Ya elves have too much faith in yer dexterity. In tha arena there's no place for that... I have something that can help ya. It's a potion of protection. Take it.")}
                {NARRATOR_DEFAULT "items/potion-grey.png" ( _ "You got a potion of protection! It will increase your defense during fights in the arena by 30%. The potion will last for the first few skirmishes.")}
                {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Frist told me that you are a skilled warrior, but here in the Arena it's the real deal. Combat is brutal and to the death. Injury is guaranteed. But if you have what it takes to compete you can earn some good money and get valuable combat experience.")}
                {VARIABLE have_training_sithras 1}

                [if]
                    {VARIABLE_NUMERICAL_EQUALS have_training_aurelia 1}
                [then]
                    [remove_item]
                        x,y=6,9
                    [/remove_item]
                [/then]
                [else]
                    [label]
                        x,y=10,6
                        text= _ "Arena"
                    [/label]    
                    {PLACE_IMAGE items/gohere.png 10 6}
                    {PLACE_IMAGE items/gohere.png 10 15}
                [/else]
                [/if]

                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "When you're finished exploring Fort Pinewood, head back to the front gate!")}
            [/then]
            [/if]
        [/else]
        [/if] 
    #enddef

    #define AURELIA_SKILLS
        {SPEAKER_GENERIC (id=Master Ooze) ( _ "(You're out of breath and slicked with sweat. You've really pushed yourself hard, but it seems your efforts have paid off. You've unlocked some of the magical secrets of your elven host!)")}
    #enddef

    #define AURELIA_TRAINING
        {SPEAKER_GENERIC (id=Frist) ( _ "Yer a quick learner lass, one o' the quickest I've ever seen. But ye won't learn anything more from beat'n up on quintains. If ye want ta continue ta train, yer gonna have ta go ta the arena. Sergeant Ryn can help ya, but the risk will be greater.")}
        {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Frist told me that you were one of his best students at the Training Hall, but here in the Arena it's the real deal. Combat is brutal and to the death. Injury is guaranteed. But if you have what it takes to compete you can earn some good money and get valuable combat experience.")}
        {VARIABLE have_training_aurelia 1}
        {CLEAR_VARIABLE training_aurelia}

        [if]
            {VARIABLE_NUMERICAL_EQUALS have_training_sithras 1}
        [then]
            [remove_item]
                x,y=6,9
            [/remove_item]
        [/then]
        [else]
            [label]
                x,y=10,6
                text= _ "Arena"
            [/label]    
            {PLACE_IMAGE items/gohere.png 10 6}
            {PLACE_IMAGE items/gohere.png 10 15}
        [/else]
        [/if]

        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "When you're finished exploring Fort Pinewood, head back to the front gate!")}
    #enddef

    #define AURELIA_SKILLS_2
        {SPEAKER_GENERIC (id=Master Ooze) ( _ "Your prowess is unmatched! Through hard work and great courage you've forged yourself into a mighty enchantress! You've learned to tap deeply into the magic power of your elven blood!")}
    #enddef

    #define AURELIA_CHALLENGE
        [if]
            {VARIABLE_GREATER_THAN have_training_sithras 2}
        [then]
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "female^Very impressive. I'm afraid you've been so successful in the arena that our stock of monsters has been almost completely depleted! Unfortunately we can't offer any new challenges for you...")}
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "We had a wild gryphon. But Sithras, champion of our arena, has already slain the fearsome beast.")}
            {VARIABLE pinewood_arena_closed yes}
            [remove_item]
                x,y=10,6
            [/remove_item]
        [/then]
        [else]
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "female^Very impressive. I'm afraid you've been so successful in the arena that our stock of monsters has been almost completely depleted! There is one last challenge that we can offer you...")}
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "female^We have a wild gryphon. It is a fearsome beast with sharp talons and a deadly beak. Already the creature has slain four challengers. The reward for defeating the gryphon is 30 gold pieces, but the risk will be greater than any you've faced before.")}
        [/else]
        [/if]

        {VARIABLE have_training_aurelia 2}
    #enddef

    #define SITHRAS_FIGHT
        [if]
            {VARIABLE_NUMERICAL_EQUALS quintains_released 1}
        [then]
            {SET_INITIATIVE "Master Ooze 2" 1}
        [/then]
        [/if]
    #enddef

    #define PINEWOOD_ARENA SIDE
        {VARIABLE master_ooze {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS ongoing_fight 0}
        [then]
            {VARIABLE_RANDOM foe_number 0..6}
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Welcome to the Pinewood Arena, where gladiators fight monsters for glory and profit. Gladiators may not leave the arena before a fight is finished. All fights are to the death. Healing is available from High Priest Jal to the east.")}
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Do you want to compete?")}
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
                {SPEAKER_OPTION_IF ( _ "female^I'm ready to fight!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1} (
                    {VARIABLE ongoing_fight $master_ooze}
                )}
                {SPEAKER_OPTION_IF ( _ "male^I'm ready to fight!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2} (
                    {VARIABLE ongoing_fight $master_ooze}
                )}
                {SPEAKER_OPTION_IF ( _ "female^I'm not interested in fighting right now.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1} (
                    {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "female^Fair enough. Come back when you're ready.")}
                )}
                {SPEAKER_OPTION_IF ( _ "male^I'm not interested in fighting right now.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2} (
                    {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "male^Fair enough. Come back when you're ready.")}
                )}
            )}

            [if]
                {VARIABLE_GREATER_THAN ongoing_fight 0}
            [then]
                {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Let the match begin!")}
                {SITHRAS_FIGHT}
                [terrain]
                    terrain=Ke^Xo
                    x=10
                    y=5
                [/terrain]
                [terrain]
                    terrain=Ce^Xo
                    x=8-9,11-12,8,12,9-11
                    y=6,6,7,7,8
                [/terrain]

                [if]
                    {VARIABLE_NUMERICAL_EQUALS ongoing_fight 2}
                [then]
                    [object]
                        silent=yes
                        [filter]
                            id=Master Ooze 2
                        [/filter]
                        [effect]
                            apply_to=defense 
                            replace=true
                            [defense]
                                flat=30
                            [/defense]
                        [/effect]
                    [/object]
                [/then]
                [/if]            

                [switch]
                    variable=foe_number
                    [case]
                        value="0"
                        {UNIT {F2} "Blood Bat" 10 7 (
                            id=Arena Monster
                            name= _ "Arena Monster"
                        )}
                    [/case]
                    [case]
                        value="1"
                        {UNIT {F2} "Drake Glider" 10 7 (
                            id=Arena Monster
                            name= _ "Arena Monster"
                        )}
                    [/case]
                    [case]
                        value="2"
                        {UNIT {F2} "Giant Scorpion" 10 7 (
                            id=Arena Monster
                            name= _ "Arena Monster"
                        )}
                    [/case]
                    [case]
                        value="3"
                        {UNIT {F2} "Young Ogre" 10 7 (
                            id=Arena Monster
                            name= _ "Arena Monster"
                        )}
                    [/case]
                    [case]
                        value="4"
                        {UNIT {F2} "Saurian Skirmisher" 10 7 (
                            id=Arena Monster
                            name= _ "Arena Monster"
                        )}
                    [/case]
                    [case]
                        value="5"
                        {UNIT {F2} "Goblin Impaler" 10 7 (
                            id=Arena Monster
                            name= _ "Arena Monster"
                        )}
                    [/case]
                    [else]
                        {UNIT {F2} Wolf 10 7 (
                            id=Arena Monster
                            name= _ "Arena Monster"
                        )}
                    [/else]
                [/switch]
            [/then]
            [/if]
        [/then]
        [/if]
    #enddef

    #define MONSTER_DIE SIDE
        {TEAM_GOLD win 10 {SIDE}}  

        [terrain]
            terrain=Ke
            x=10
            y=5
        [/terrain]
        [terrain]
            terrain=Ce
            x=8-9,11-12,8,12,9-11
            y=6,6,7,7,8
        [/terrain]

        [if]
            {VARIABLE_NUMERICAL_EQUALS ongoing_fight 2}
        [then]
            [object]
                silent=yes
                [filter]
                    id=Master Ooze 2
                [/filter]
                [effect]
                    apply_to=defense 
                    replace=true
                    [defense]
                        flat=60
                    [/defense]
                [/effect]
            [/object]
        [/then]
        [/if]

        {VARIABLE fight_end $ongoing_fight}
        {VARIABLE ongoing_fight 0}
    #enddef

    #define SITHRAS_SKILLS TYPE
        {VARIABLE sithras_skill_type {TYPE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS sithras_skill_type 1}
        [then]
            {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "Through countless battles in the arena you have improved your fighting skills! You've managed to develop the combat abilities of your host in a new direction!")}
        [/then]
        [else]
            {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "Through countless battles in the arena you have improved your fighting skills! Now you are truly formidable in combat!")}
        [/else]
        [/if]

        {NARRATOR_DEFAULT "items/potion-grey.png" ( _ "Unfortunately your potion of protection has worn off.")}
        {CLEAR_VARIABLE sithras_skill_type}
    #enddef

    #define SITHRAS_CHALLENGE
        [if]
            {VARIABLE_GREATER_THAN have_training_aurelia 2}
        [then]
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "male^Very impressive. I'm afraid you've been so successful in the arena that our stock of monsters has been almost completely depleted! Unfortunately we can't offer any new challenge for you...")}
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "We had a wild gryphon. But Aurelia, champion of our arena, has already slain the fearsome beast.")}
            {VARIABLE pinewood_arena_closed yes}
            [remove_item]
                x,y=10,6
            [/remove_item]
        [/then]
        [else]
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "male^Very impressive. I'm afraid you've been so successful in the arena that our stock of monsters has been almost completely depleted! There is one last challenge that we can offer you...")}
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "male^We have a wild gryphon. It is a fearsome beast with sharp talons and a deadly beak. Already the creature has slain four challengers. The reward for defeating the gryphon is 30 gold pieces, but the risk will be greater than any you've faced before.")}
        [/else]
        [/if]

        {VARIABLE have_training_sithras 2}
    #enddef

    #define PINEWOOD_ARENA_CHAMPION SIDE
        {VARIABLE master_ooze {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS ongoing_fight 0}
        [then]
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Do you want to fight the gryphon?")}
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
                {SPEAKER_OPTION ( _ "Yes!") (
                    {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Release the gryphon!")}
                    {VARIABLE ongoing_fight $master_ooze}
                    {SITHRAS_FIGHT}
                    [terrain]
                        terrain=Ke^Xo
                        x=10
                        y=5
                    [/terrain]
                    [terrain]
                        terrain=Ce^Xo
                        x=8-9,11-12,8,12,9-11
                        y=6,6,7,7,8
                    [/terrain]
                    {UNIT {F2} Gryphon 10 7 (
                        id=Bloodtalon
                        name= _ "Bloodtalon"
                    )}
                )}
                {SPEAKER_OPTION ( _ "Not right now.") (
                    {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Fair enough. No one will think less of you for walking away from this fight.")}
                )}
            )}
        [/then]
        [/if]
    #enddef

    #define PINEWOOD_ARENA_SPECTATOR SIDE
        [if]
            {VARIABLE_NUMERICAL_EQUALS ongoing_fight 0}
        [then]
            {VARIABLE master_ooze {SIDE}}
            {SPEAKER_GENERIC_IF (id=Sergeant Ryn) ( _ "female^The arena is closed for anyone besides challengers and monsters. You are not currently a challenger, so for your own safety I have to ask you to leave.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
            {SPEAKER_GENERIC_IF (id=Sergeant Ryn) ( _ "male^The arena is closed for anyone besides challengers and monsters. You are not currently a challenger, so for your own safety I have to ask you to leave.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
            {SPEAKER_GENERIC (id=$unit.id) ( _ "I understand.")}
            {MOVE_UNIT id=$unit.id $wandering_ooze.x $wandering_ooze.y}
            {RESTORE_MOVES $unit.id ooze_leader $wandering_ooze.moves}
        [/then]
        [/if]
    #enddef

    #define PINEWOOD_ARENA_CLOSED SIDE
        [if]
            {VARIABLE_NUMERICAL_EQUALS ongoing_fight 0}
        [then]
            {VARIABLE master_ooze {SIDE}}
            [if]
                {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
            [then]
                [if]
                    {VARIABLE_NUMERICAL_EQUALS have_training_aurelia 3}
                [then]
                    {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Welcome back, Champion! Unfortunately the arena is closed until we can restock our monster supply.")}
                [/then]
                [else]
                    {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Welcome back, Challenger! Unfortunately the arena is closed until we can restock our monster supply.")}
                [/else]
                [/if]
            [/then]
            [else]
                [if]
                    {VARIABLE_NUMERICAL_EQUALS have_training_sithras 3}
                [then]
                    {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Welcome back, Champion! Unfortunately the arena is closed until we can restock our monster supply.")}
                [/then]
                [else]
                    {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "Welcome back, Challenger! Unfortunately the arena is closed until we can restock our monster supply.")}
                [/else]
                [/if]
            [/else]
            [/if]
        [/then]
        [/if]
    #enddef

    #define BLOODTALON_DIE SIDE
        {TEAM_GOLD win 30 {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS ongoing_fight 1}
        [then]
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "What a spectacular fight! What a terrific victory! All hail Aurelia, Champion of the Pinewood Arena!")}
            {VARIABLE have_training_aurelia 3}

            [if]
                {VARIABLE_NUMERICAL_EQUALS have_training_sithras 2}
            [then]
                {VARIABLE pinewood_arena_closed yes}
                [remove_item]
                    x,y=10,6
                [/remove_item]
            [/then]
            [/if]
        [/then]
        [else]
            {SPEAKER_GENERIC (id=Sergeant Ryn) ( _ "What a spectacular fight! What a terrific victory! All hail Sithras, Champion of the Pinewood Arena!")}
            {VARIABLE have_training_sithras 3}

            [if]
                {VARIABLE_NUMERICAL_EQUALS have_training_aurelia 2}
            [then]
                {VARIABLE pinewood_arena_closed yes}
                [remove_item]
                    x,y=10,6
                [/remove_item]
            [/then]
            [/if]
        [/else]
        [/if]

        [terrain]
            terrain=Ke
            x=10
            y=5
        [/terrain]
        [terrain]
            terrain=Ce
            x=8-9,11-12,8,12,9-11
            y=6,6,7,7,8
        [/terrain]

        {VARIABLE sergeant_ryn_friend $ongoing_fight}
        {VARIABLE fight_end $ongoing_fight}
        {VARIABLE_OP leaderless_troops sub 1}
        {LEADERSHIP 1 $ongoing_fight}
        {VARIABLE ongoing_fight 0}
    #enddef

    #define FONTAINE SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [remove_item]
            x,y=15,11
        [/remove_item]

        [if]
            {VARIABLE_NUMERICAL_EQUALS quest_fontaine 0}
        [then]
            {VARIABLE quest_fontaine $master_ooze}
            [if]
                {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
            [then]
                {VARIABLE_OP quests_aurelia add 1}
                {SPEAKER_GENERIC (id=Fontaine) ( _ "(A young man in fine clothes approaches you and smiles.)")}
                {SPEAKER_GENERIC (id=Fontaine) ( _ "You have a very fine figure, if I may say so milady. May I have the honor of painting your picture?")}
                {SPEAKER_SPECIAL (id=$unit.id) ( _ "(How to respond?)") (
                    {SPEAKER_OPTION ( _ "(Be suspicious) If you're a painter then what are you doing with those swords?") (
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "Truthfully, I'm a mercenary by trade. But my true passion lies in painting. (Bitterly) Alas, there isn't much appreciation for high-quality artwork in this backwater frontier town. Guarding the Mayor pays my bills, but one day I'll be famous enough to sell my art for a profit!")}
                    )}
                    {SPEAKER_OPTION ( _ "(Be friendly) Of course you can paint my picture!") (
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "(Excited) Thank you milady!")}
                    )}
                )}
                {SPEAKER_GENERIC (id=Fontaine) (_ "I'll pay you 30 gold for a day's worth of modeling services. (Hesitantly) Or...60 gold if I may paint you...in your natural, ahem, state.")}
                {SPEAKER_SPECIAL (id=$unit.id) ( _ "(How to respond?)") (
                    {SPEAKER_OPTION ( _ "(Refuse) I'm not about to take a job from a complete stranger.") (
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "(Disappointed Sigh) I assure you I have no ulterior motives, milady, but...if that is your answer I suppose I must accept it. Good day to you.")}
                    )}
                    {SPEAKER_OPTION ( _ "(Accept) You can paint me for 30 gold.") (
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "Thank you milady! I've never painted a specimen as exotic as an elf before! I wonder how much shading I should put on your ears...")}
                        {SPEAKER_GENERIC (id=$unit.id) ( _ "(You spend a day modeling for Fontaine!)")}
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "(Fontaine's painting of you is actually quite good.)")}
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "(Proud) One of my better works, to be sure. And here is your payment milady, you earned every copper.")}
                        {TEAM_GOLD earn 30 $master_ooze} 
                    )}
                    {SPEAKER_OPTION ( _ "(Accept) You can paint me nude for 60 gold.") (
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "Thank you milady! I've never painted a specimen as exotic as an elf before! I wonder how much shading I should put on your ears...")}
                        {SPEAKER_GENERIC (id=$unit.id) ( _ "(You spend a day modeling nude for Fontaine!)")}
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "(Fontaine's painting of you is actually quite good.)")}
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "(Proud) One of my better works, to be sure. And here is your payment milady, you earned every copper!")}
                        {TEAM_GOLD earn 60 $master_ooze}
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "If I may be so bold milady, you are a goddess, a diva! I think I will make you my Muse...")}
                        {SPEAKER_GENERIC (id=$unit.id) ( _ "?!")}
                        {VARIABLE fontaine_friend $master_ooze}
                        {LEADERSHIP 1 $master_ooze}
                    )}
                )}
            [/then]
            [else]
                {VARIABLE_OP quests_sithras add 1}
                {TEAM_HAS_GOLD 40 $master_ooze}
                {SPEAKER_GENERIC (id=Fontaine) ( _ "(You see a young man in fine clothes carefully looking at a painting.)")}
                {SPEAKER_GENERIC (id=Fontaine) ( _ "(He speaks to himself) It's just all wrong...the colors, the shading...")}
                {SPEAKER_SPECIAL (id=$unit.id) ( _ "(How to respond?)") (
                    {SPEAKER_OPTION ( _ "(Small talk) Did you paint this picture?") (
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "(He notices you for the first time) I painted it, yes. I'm a mercenary by trade but my true passion lies in painting. (Bitterly) Alas, there isn't much appreciation for high-quality artwork in this backwater frontier town. Guarding the Mayor pays my bills, but one day I'll be famous enough to sell my art for a profit!")}
                    )}
                    {SPEAKER_OPTION ( _ "(Offer help) If you want this picture to look better I could help.") (
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "Sorry sir, but you look more like a warrior than a fellow artist.")}
                    )}
                )}
                {SPEAKER_GENERIC (id=$unit.id) ( _ "If you would use some different colors here and here it would gain depth.")}
                {SPEAKER_GENERIC (id=Fontaine) ( _ "(He thinks for a little while then speaks excitedly) You know, you're absolutely right! I can't believe I didn't see it before! Thank you, friend!")}
                {SPEAKER_GENERIC (id=Fontaine) ( _ "(Hesitantly) Maybe you could tell me how to become a better artist. I'll pay you 30 gold pieces for just one day of your time!")}
                {SPEAKER_SPECIAL (id=$unit.id) ( _ "(How to respond?)") (
                    {SPEAKER_OPTION ( _ "(Refuse) I'm not about to teach just anyone I meet.") (
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "(Disappointed) I'm sorry if my offer offended you sir... Good day to you.")}
                    )}
                    {SPEAKER_OPTION ( _ "(Accept) Fine I will tell you what I know for 30 gold pieces.") (
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "Thank you sir!")}
                        {SPEAKER_GENERIC (id=$unit.id) ( _ "(You spend a day teaching Fontaine about art)")}
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "(When you're done you notice that, if nothing else, Fontaine is a lot more confident now.)")}
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "Thank you sir, our collaboration was my pleasure. And here is your payment as promised.")}
                        {TEAM_GOLD earn 30 $master_ooze} 
                    )}
                    {SPEAKER_OPTION_IF ( _ "(Patronize) I'll not only teach you about art but also pay you 40 gold pieces to support your efforts.") {VARIABLE_EQUALS has_gold yes} (
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "That's a most generous offer my lord!")}
                        {SPEAKER_GENERIC (id=$unit.id) ( _ "(You spend a day teaching Fontaine about art)")}
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "(When you're done you notice that, if nothing else, Fontaine is a lot more confident now.)")}
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "Thank you sir. I think this is the start of a glorious collaboration!")}
                        {TEAM_GOLD spent 40 $master_ooze}
                        {SPEAKER_GENERIC (id=Fontaine) ( _ "Your patronage is much appreciated!")}
                        {VARIABLE fontaine_friend $master_ooze}
                        {LEADERSHIP 1 $master_ooze}
                    )}
                )}
            [/else]
            [/if]
        [/then]
        [/if]   
    #enddef 

    #define LIVIUS SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS book_hunt 0}
            [and]
                {VARIABLE_NUMERICAL_EQUALS livius_friend 0}
            [/and]
        [then]
            [if]
                {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
            [then]
                {VARIABLE_OP quests_aurelia add 1}
            [/then]
            [else]
                {VARIABLE_OP quests_sithras add 1}  
            [/else]
            [/if]

            [remove_item]
                x,y=15,7
            [/remove_item]
            {SPEAKER_GENERIC_IF (id=Livius) ( _ "female^Fie and fiddle, where has my blasted book gone?! You! Elf! If you happen to see a thick silver tome, bring it to me immediately for a reward!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
            {SPEAKER_GENERIC_IF (id=Livius) ( _ "male^Fie and fiddle, where has my blasted book gone?! You! Elf! If you happen to see a thick silver tome, bring it to me immediately for a reward!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
            {VARIABLE book_hunt $master_ooze}
        [/then]
        [/if]
    #enddef

    #define LIVIUS_BOOK SIDE
        {VARIABLE master_ooze {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS book_hunt $master_ooze}
        [then]
            {SPEAKER_GENERIC (id=$unit.id) ( _ "(This looks like the book that Livius is looking for. You can bring it back to him for a reward.)")}
            {VARIABLE have_book $master_ooze}
            [remove_item]
                x,y=3,14
            [/remove_item]
            {PLACE_IMAGE items/gohere.png 15 7}
        [/then]
        [/if]
    #enddef

    #define LIVIUS_REWARD SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS have_book $master_ooze}
        [then]
            {SPEAKER_GENERIC_IF (id=Livius) ( _ "female^You found my book, 'Exotic Culinary Delights -- How to Serve Magical Oozes, Slimes, and Puddings'!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
            {SPEAKER_GENERIC_IF (id=Livius) ( _ "male^You found my book, 'Exotic Culinary Delights -- How to Serve Magical Oozes, Slimes, and Puddings'!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
            {VARIABLE have_book 0}
            {VARIABLE livius_friend $master_ooze}
            {LEADERSHIP 1 $master_ooze}
            {SPEAKER_GENERIC (id=Livius) ( _ "Here's 30 gold pieces for your help (he tosses a pouch of coins at your feet).")}
            {TEAM_GOLD earn 30 $master_ooze}
            {SPEAKER_GENERIC (id=Livius) ( _ "After the Imperial Army crushes the ooze hordes, I'll make a fortune harvesting the corpses of the slimy creatures. They're quite a delicacy, you know!")}
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(You had no idea you were tasty, much less a valuable food commodity).") (
                {SPEAKER_OPTION ( _ "(Angry) You horrible man, get away from me!") (
                    {SPEAKER_GENERIC_IF (id=Livius) ( _ "I hope you don't have some misguided sense of sympathy for those monsters. They'd devour a helpless elf lass like yourself in moments! Bah! I don't have any more time to waste on you, I've got cooking preparations to make.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                    {SPEAKER_GENERIC_IF (id=Livius) ( _ "I hope you don't have some misguided sense of sympathy for those monsters. They'd devour someone like you in moments! Bah! I don't have any more time to waste on you, I've got cooking preparations to make.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                )}
                {SPEAKER_OPTION ( _ "(Wish him luck) Good luck, you're going to need it.") (
                    {SPEAKER_GENERIC (id=Livius) ( _ "No I won't but thanks all the same. Now if you'll excuse me, I've got cooking preparations to make.")}
                )}
            )}
            [remove_item]
                x,y=15,7
            [/remove_item]
        [/then]
        [/if]
    #enddef

    #define JEDD_FARM_WORK WORK SIDE X Y
        {VARIABLE master_ooze {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS hay_hunt $master_ooze}
        [then]
            {MASTER_OOZE_LOCATION {SIDE}}

            [if]
                {VARIABLE_NUMERICAL_EQUALS hay_haul[{WORK}] 0}
            [then]
                {SPEAKER_GENERIC (id=$unit.id) ( _ "(You help Jedd with some of his farm work.)")}
                {VARIABLE hay_haul[{WORK}] 1}
                [remove_item]
                    x,y={X},{Y}
                [/remove_item]
            [/then]
            [/if]
        [/then]
        [else]
            [allow_undo]
            [/allow_undo]
        [/else]
        [/if]
    #enddef

    #define JEDD SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE_OP quests_aurelia add 1}   
        [/then]
        [else]
            {VARIABLE_OP quests_sithras add 1}
        [/else]
        [/if]

        [if]
            {VARIABLE_LESS_THAN hay_hunt 1}
        [then]
            {SPEAKER_GENERIC (id=$unit.id) ( _ "(You see a sun-tanned farmer by the roadside leaning heavily on his pitchfork.)")}
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
                {SPEAKER_OPTION ( _ "(Friendly) Hello sir! How are you this fine day?") (
                    {SPEAKER_GENERIC (id=Jedd) ( _ "(He spits some tobacco) Lousy. Threw my back out bringing in the harvest. Can't bring the rest of my hay to market with a bad back, so I'm about to go broke. Have to sell the farm. So yeah, I've had better days.")}
                    {SPEAKER_GENERIC (id=Jedd) ( _ "Maybe you can help me? I need to hire a farmhand to bring in the rest of my hay before it rots. What do you say to 30 gold and a day's worth of honest labor?")}
                )}
                {SPEAKER_OPTION ( _ "(Small talk) So what's your opinion on the ooze crisis?") (
                    {SPEAKER_GENERIC (id=Jedd) ( _ "(He spits some tobacco) The what crisis?")}
                    {SPEAKER_GENERIC (id=$unit.id) ( _ "Surely you've heard that there's a horde of ravenous amorphous creatures rampaging across the countryside.")}
                    {SPEAKER_GENERIC (id=Jedd) ( _ "(He stares at you blankly.)")}
                    {SPEAKER_GENERIC (id=$unit.id) ( _ "They beat the Pinewood Militia!")}
                    {SPEAKER_GENERIC (id=Jedd) ( _ "Sorry, I don't get out much.")}
                    {SPEAKER_GENERIC_IF (id=Jedd) ( _ "I'm just a simple farmer. I don't got time for monsters, militias, or that idiot mayor of ours. Not a one of 'em ever did a hard days' work! But you lass, you look like you might be able to help me...") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                    {SPEAKER_GENERIC_IF (id=Jedd) ( _ "I'm just a simple farmer. I don't got time for monsters, militias, or that idiot mayor of ours. Not a one of 'em ever did a hard days' work! But you sir, you look like you might be able to help me...") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                    {SPEAKER_GENERIC (id=Jedd) ( _ "I threw out my back bringing in the summer harvest. I need to hire a farmhand to bring in those bushels o' hay oe'er yonder before they rot. What do you say to 30 gold and a day's worth of honest labor?")}
                )}
            )}
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
                {SPEAKER_OPTION ( _ "(Agree to Help) I'll help you!") (
                    {SPEAKER_GENERIC (id=Jedd) ( _ "(He spits some more tobacco) Great. The hay is right next to my farm. Return here when you're done.")}
                    {VARIABLE hay_hunt $master_ooze}
                    {VARIABLE hay_haul[0] 0}
                    {VARIABLE hay_haul[1] 0}
                    {VARIABLE hay_haul[2] 0}
                )}
                {SPEAKER_OPTION ( _ "(Refuse) I don't have time for this.") (
                    {SPEAKER_GENERIC (id=Jedd) ( _ "(He spits some more tobacco) Suit yourself.")}
                    [remove_item]
                        x,y=14,5
                    [/remove_item]
                    {VARIABLE hay_hunt 3}
                )}
            )}
        [/then]
        [/if]
    #enddef

    #define JEDD_WORK_DONE SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS hay_hunt $master_ooze}
            [and]
                {VARIABLE_NUMERICAL_EQUALS hay_haul[0] 1}
            [/and]
            [and]
                {VARIABLE_NUMERICAL_EQUALS hay_haul[1] 1}
            [/and]
            [and]
                {VARIABLE_NUMERICAL_EQUALS hay_haul[2] 1}
            [/and]
        [then]
            {SPEAKER_GENERIC_IF (id=Jedd) ( _ "You've been a great help, lass! The world needs more people like you! Here's your thirty gold, plus a little extra!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
            {SPEAKER_GENERIC_IF (id=Jedd) ( _ "You've been a great help, sir! The world needs more people like you! Here's your thirty gold, plus a little extra!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
            {VARIABLE jedd_friend $master_ooze}
            {LEADERSHIP 1 $master_ooze}
            {TEAM_GOLD earn 40 $master_ooze}
            {VARIABLE hay_hunt 3}
            [remove_item]
                x,y=14,5
            [/remove_item]
        [/then]
        [/if]
    #enddef

    #define BROCK_CHALLENGE_LOST
        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(Brock effortlessly pins your arm to the table. You lost!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(Brock effortlessly pins your arm to the table. You lost!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
        {SPEAKER_GENERIC_IF (id=Brock) ( _ "Don't be sad lass, many men far stronger than you have challenged me and lost.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
        {SPEAKER_GENERIC_IF (id=Brock) ( _ "Don't be sad my boy, many men far stronger than you have challenged me and lost.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
    #enddef

    #define BROCK_CHALLENGE_WIN
        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            [if]
                {VARIABLE_GREATER_THAN brock_friend 2}
                [and]
                    [not]
                        {VARIABLE_GREATER_THAN quests_aurelia $quests_limit}
                    [/not]
                [/and]
            [then]
                {VARIABLE brock_friend $master_ooze}
                {VARIABLE_OP leaderless_troops sub 1}
                {LEADERSHIP 1 $master_ooze}     
                {VARIABLE_OP quests_aurelia add 1}
            [/then]
            [/if]
        [/then]
        [else]
            [if]
                {VARIABLE_GREATER_THAN brock_friend 2}
                [and]
                    [not]
                        {VARIABLE_GREATER_THAN quests_sithras $quests_limit}
                    [/not]
                [/and]
            [then]
                {VARIABLE brock_friend $master_ooze}
                {VARIABLE_OP leaderless_troops sub 1}
                {LEADERSHIP 1 $master_ooze}
                {VARIABLE_OP quests_sithras add 1}
            [/then]
            [/if]
        [/else]
        [/if]

        {TEAM_GOLD gain 30 $master_ooze}
    #enddef

    #define BROCK SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}
        {HAS_TRAITS}

        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE brock_challenge $brock_challenge_aurelia}   
        [/then]
        [else]
            {VARIABLE brock_challenge $brock_challenge_sithras}    
        [/else]
        [/if]

        {TEAM_HAS_GOLD 5 $master_ooze}
        # In multiplayer all costs need to be even numbers, in single player the cost is 5 gold
        {SPEAKER_GENERIC (id=Brock) ( _ "Welcome to Brock's Tavern. Five gold pieces for full room and board!")}

        [if]
            {VARIABLE_NUMERICAL_EQUALS brock_challenge 0}
        [then]
            {SPEAKER_GENERIC_IF (id=Brock) ( _ "female^Or perhaps you've come to challenge me, the Fort Pinewood Armwrestling Champion, to a contest of strength?") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
            {SPEAKER_GENERIC_IF (id=Brock) ( _ "male^Or perhaps you've come to challenge me, the Fort Pinewood Armwrestling Champion, to a contest of strength?") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
        [/then]
        [/if]

        {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
            {SPEAKER_OPTION ( _ "(Stay at the Tavern) I want a room.") (
                [if]
                    {VARIABLE_EQUALS has_gold no}
                [then]
                    {SPEAKER_GENERIC_IF (id=Brock) ( _ "female^It looks like you don't have five gold. Come back when you have more gold.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                    {SPEAKER_GENERIC_IF (id=Brock) ( _ "male^It looks like you don't have five gold. Come back when you have more gold.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                [/then]
                [else]
                    {SPEAKER_GENERIC (id=Brock) ( _ "Splendid!")}
                    {TEAM_GOLD lost 5 $master_ooze}
                    {HEAL_FULL $unit.id}

                    [if]
                        {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                    [then]
                        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "female^You wake up the next day feeling refreshed!")}
                    [/then]
                    [else]
                        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "male^You wake up the next day feeling refreshed!")}
                    [/else]
                    [/if]
                [/else]
                [/if]
            )}
            {SPEAKER_OPTION ( _ "(Challenge him) I want to challenge you.") (
                [if]
                    {VARIABLE_NUMERICAL_EQUALS brock_challenge 2}
                [then]
                    {SPEAKER_GENERIC_IF (id=Brock) ( _ "Sorry lass, you've already challenged me, remember?") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                    {SPEAKER_GENERIC_IF (id=Brock) ( _ "Sorry boy, you've already challenged me, remember?") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                [/then]
                [else]
                    {SPEAKER_GENERIC (id=Brock) ( _ "Splendid!")}
                    {VARIABLE brock_challenge 1}
                [/else]
                [/if]
            )}
            {SPEAKER_OPTION ( _ "(Leave) Goodbye.") (
                {SPEAKER_GENERIC (id=Brock) ( _ "Come again!")}
            )}
        )}

        [if]
            {VARIABLE_NUMERICAL_EQUALS brock_challenge 1}
        [then]
            {SPEAKER_GENERIC_IF (id=Brock) ( _ "Many strong men have tried to defeat me and failed. I doubt a little elf lass like you will put up much of a fight, but I never turn away a challenger, ha ha!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
            {SPEAKER_GENERIC_IF (id=Brock) ( _ "Many strong men have tried to defeat me and failed. I doubt a little boy like you will put up much of a fight, but I never turn away a challenger, ha ha!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
            {VARIABLE brock_challenge 2}

            [if]
                {VARIABLE_NUMERICAL_EQUALS master_ooze 1} 
            [then]
                {VARIABLE brock_challenge_aurelia $brock_challenge}   
            [/then]
            [else]
               {VARIABLE brock_challenge_sithras $brock_challenge}    
            [/else]
            [/if]

            {SPEAKER_GENERIC_IF (id=$unit.id) (_ "female^(You both get into position. Looking at the size of the huge muscles on Brock's arm, you realize that he will not be easy to defeat.)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
            {SPEAKER_GENERIC_IF (id=$unit.id) (_ "male^(You both get into position. Looking at the size of the huge muscles on Brock's arm, you realize that he will not be easy to defeat.)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to do?)") (
                {SPEAKER_OPTION ( _ "(Force Brock's arm down with sheer brute strength)") (
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS have_strength[0] 1}
                    [then]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(Both you and Brock grunt with exertion and your arm muscles bulge. At first you seem to be evenly matched, but gradually you prove yourself to be the stronger competitor and force his arm down. You won!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(Both you and Brock grunt with exertion and your arm muscles bulge. At first you seem to be evenly matched, but gradually you prove yourself to be the stronger competitor and force his arm down. You won!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {SPEAKER_GENERIC_IF (id=Brock) ( _ "(He seems surprised at first but then laughs heartily) You're the strongest elf lass I've ever met! Good show! The reward for beating me is thirty pieces of gold, and you earned every bit of it!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=Brock) ( _ "(He seems surprised at first but then laughs heartily) You're the strongest elf I've ever met! Good show! The reward for beating me is thirty pieces of gold, and you earned every bit of it!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {BROCK_CHALLENGE_WIN}
                    [/then]
                    [else]
                        {BROCK_CHALLENGE_LOST}
                    [/else]
                    [/if]
                )}
                {SPEAKER_OPTION ( _ "(Move quickly as soon as the match starts to take him by surprise)") (
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS have_quickness[0] 1}
                    [then]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(You move with blinding speed the instant the match starts. With a loud THUMP you slam Brock's arm down. He gapes at you in surprise. You won!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(You move with blinding speed the instant the match starts. With a loud THUMP you slam Brock's arm down. He gapes at you in surprise. You won!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {SPEAKER_GENERIC_IF (id=Brock) ( _ "female^I...I can't believe I lost. By the Gods you're quick. You knew you couldn't overpower me so you counted on me underestimating you. Good show! The reward for beating me is thirty pieces of gold, and you earned every bit of it!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=Brock) ( _ "male^I...I can't believe I lost. By the Gods you're quick. You knew you couldn't overpower me so you counted on me underestimating you. Good show! The reward for beating me is thirty pieces of gold, and you earned every bit of it!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {BROCK_CHALLENGE_WIN}
                    [/then]
                    [else]
                        {BROCK_CHALLENGE_LOST}
                    [/else]
                    [/if]
                )}
                {SPEAKER_OPTION ( _ "(Simply try and hold your ground to wear him out)") (
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS have_resilient[0] 1}
                    [then]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(Brock pushes hard against you but you're able to hold your own...barely. More than a minute passes and beads of sweat break out on both your foreheads. But soon Brock has spent his strength and you're able to claim victory. You won!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(Brock pushes hard against you but you're able to hold your own...barely. More than a minute passes and beads of sweat break out on both your foreheads. But soon Brock has spent his strength and you're able to claim victory. You won!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {SPEAKER_GENERIC_IF (id=Brock) ( _ "female^I...I can't believe I lost. By the Gods you're hardy. You knew you couldn't outright overpower me so you counted on me wearing myself out. Good show! The reward for beating me is thirty pieces of gold, and you earned every bit of it!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=Brock) ( _ "male^I...I can't believe I lost. By the Gods you're hardy. You knew you couldn't outright overpower me so you counted on me wearing myself out. Good show! The reward for beating me is thirty pieces of gold, and you earned every bit of it!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {BROCK_CHALLENGE_WIN}
                    [/then]
                    [else]
                        {BROCK_CHALLENGE_LOST}
                    [/else]
                    [/if]
                )}
                {SPEAKER_OPTION ( _ "(Try to get your arm into a superior position)") (
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS have_dexterity[0] 1}
                    [then]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(Brock presses against you hard and you realize you won't have much time before he pins you. You jockey for a better position and finally get it! With your superior position you're able to gradually force his arm down. You won!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(Brock presses against you hard and you realize you won't have much time before he pins you. You jockey for a better position and finally get it! With your superior position you're able to gradually force his arm down. You won!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {SPEAKER_GENERIC_IF (id=Brock) ( _ "female^I...I can't believe I lost. By the Gods that was an odd strategy. I've never seen anyone armwrestle like that before. Good show! The reward for beating me is thirty pieces of gold, and you earned every bit of it!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=Brock) ( _ "male^I...I can't believe I lost. By the Gods that was an odd strategy. I've never seen anyone armwrestle like that before. Good show! The reward for beating me is thirty pieces of gold, and you earned every bit of it!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {BROCK_CHALLENGE_WIN}
                    [/then]
                    [else]
                        {BROCK_CHALLENGE_LOST}
                    [/else]
                    [/if]
                )}
            )}
        [/then]
        [/if]
    #enddef

    #define VALIN_CHALLENGE_WIN
        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            [if]
                {VARIABLE_GREATER_THAN valin_friend 2}
                [and]
                    [not]
                        {VARIABLE_GREATER_THAN quests_aurelia $quests_limit}
                    [/not]
                [/and]
            [then]
                {VARIABLE valin_friend $master_ooze}
                {VARIABLE_OP leaderless_troops sub 1}
                {LEADERSHIP 1 $master_ooze}
                {VARIABLE_OP quests_aurelia add 1}
            [/then]
            [/if] 
        [/then]
        [else]
            [if]
                {VARIABLE_GREATER_THAN valin_friend 2}
                [and]
                    [not]
                        {VARIABLE_GREATER_THAN quests_sithras $quests_limit}
                    [/not]
                [/and]
            [then]
                {VARIABLE valin_friend $master_ooze}
                {VARIABLE_OP leaderless_troops sub 1}
                {LEADERSHIP 1 $master_ooze}
                {VARIABLE_OP quests_sithras add 1}
            [/then]
            [/if]
        [/else]
        [/if]

        {TEAM_GOLD gain 30 $master_ooze}
    #enddef

    #define VALIN SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}
        {HAS_TRAITS}

        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE valin_challenge $valin_challenge_aurelia}   
        [/then]
        [else]
            {VARIABLE valin_challenge $valin_challenge_sithras}    
        [/else]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS valin_challenge 2}
        [then]
            {SPEAKER_GENERIC (id=Valin) ( _ "Back again? You only get one shot at my game, no pun intended.")}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS valin_challenge 0}
        [then]
            {SPEAKER_GENERIC (id=Valin) ( _ "Come one come all! Test your SKILL at archery and win PRIZE MONEY! Hit the bulls eye in ONE shot from THIRTY paces! Easy you say? Not really! BEHOLD the bows that you may use!")}
            {SPEAKER_GENERIC (id=Valin) ( _ "(With a flourish he produces three bizarre longbows. One is so large that it seems to have been made for a giant. Another is an exotic curved bow of uncertain origin. The third bow has a bowstring drawn so taut it looks like you might hurt yourself trying to use it!)")}
            {SPEAKER_GENERIC (id=Valin) ( _ "Do you have the strength to wield the OGRE'S LONGBOW? Or are you skilled enough to decipher the mysteries of the TYRAKIAN HORSEBOW? Or perhaps you're brave enough to try the BACKBREAKER BOW? Step right up to find out!")}
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(Compete?)") (
                {SPEAKER_OPTION ( _ "I want to try.") (
                    {SPEAKER_GENERIC (id=Valin) ( _ "Now you have to choose what bow you're going to use...")}
                    {VARIABLE valin_challenge 1}
                )}
                {SPEAKER_OPTION ( _ "(Leave)") (
                    {SPEAKER_GENERIC (id=Valin) ( _ "Another time perhaps.")}
                )}
            )}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS valin_challenge 1}
        [then]
            {VARIABLE valin_challenge 2}

            [if]
                {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
            [then]
                {VARIABLE valin_challenge_aurelia $valin_challenge}

                [if]
                    {VARIABLE_NUMERICAL_EQUALS valin_challenge_sithras 2}
                [then]
                    [remove_item]
                        x,y=17,8
                    [/remove_item]
                [/then]
                [/if]
            [/then]
            [else]   
                {VARIABLE valin_challenge_sithras $valin_challenge}

                [if]
                    {VARIABLE_NUMERICAL_EQUALS valin_challenge_aurelia 2}
                [then]
                    [remove_item]
                        x,y=17,8
                    [/remove_item]
                [/then]
                [/if]  
            [/else]
            [/if]

            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What bow should you choose?)") (
                {SPEAKER_OPTION ( _ "(Choose the huge bow)") (
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS have_strength[0] 1}
                    [then]
                        [sound]
                            name=bow.ogg
                        [/sound]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(It takes all your strength to bend this bow. When you loose your arrow it thuds into the target with tremendous force. You did it!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(It takes all your strength to bend this bow. When you loose your arrow it thuds into the target with tremendous force. You did it!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {SPEAKER_GENERIC (id=Valin) ( _ "Congratulations! Archery isn't JUST about marksmanship! Sometimes you've got to be pretty STRONG to make a bow WORK how you want it to. Here is your PRIZE MONEY!")}
                        {VALIN_CHALLENGE_WIN}
                    [/then]
                    [else]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(Your efforts to bend the huge bow are completely futile. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(Your efforts to bend the huge bow are completely futile. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {SPEAKER_GENERIC_IF (id=Valin) ( _ "female^And it seems the OGRE'S LONGBOW has triumphed over yet ANOTHER contestant!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=Valin) ( _ "male^And it seems the OGRE'S LONGBOW has triumphed over yet ANOTHER contestant!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                    [/else]
                    [/if]
                )}
                {SPEAKER_OPTION ( _ "(Choose the complicated foreign bow)") (
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS have_dexterity[0] 1}
                    [then]
                        [sound]
                            name=bow.ogg
                        [/sound]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(You run your slender fingers along the bow, trying to get a feel for it. It is oddly balanced, but you feel confident you can make it work. Your confidence pays off as your arrow thunks into the target. You did it!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(You run your slender fingers along the bow, trying to get a feel for it. It is oddly balanced, but you feel confident you can make it work. Your confidence pays off as your arrow thunks into the target. You did it!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {SPEAKER_GENERIC (id=Valin) ( _ "Congratulations! Archery isn't JUST about marksmanship! Sometimes you've got to be pretty DEXTROUS to make a bow WORK how you want it to. Here is your PRIZE MONEY!")}
                        {VALIN_CHALLENGE_WIN}
                    [/then]
                    [else]
                        [sound]
                            name=bow-miss.ogg
                        [/sound]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(Your efforts to make the exotic bow work are completely futile. Your arrow flies off target and into the grass. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(Your efforts to make the exotic bow work are completely futile. Your arrow flies off target and into the grass. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {SPEAKER_GENERIC_IF (id=Valin) ( _ "female^And it seems the TYRAKIAN HORSEBOW has triumphed over yet ANOTHER contestant!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=Valin) ( _ "male^And it seems the TYRAKIAN HORSEBOW has triumphed over yet ANOTHER contestant!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                    [/else]
                    [/if]
                )}
                {SPEAKER_OPTION ( _ "(Choose the ultra-taut backbreaker bow)") (
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS have_resilient[0] 1}
                    [then]
                        [sound]
                            name=bow.ogg
                        [/sound]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(The bow is aptly named. You nearly break your back trying to draw it! But your persistence pays off as your arrow thunks into the target. You did it!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(The bow is aptly named. You nearly break your back trying to draw it! But your persistence pays off as your arrow thunks into the target. You did it!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {SPEAKER_GENERIC (id=Valin) ( _ "Congratulations! Archery isn't JUST about marksmanship! Sometimes you've got to be pretty RESILIENT to make a bow WORK how you want it to. Here is your PRIZE MONEY!")}
                        {VALIN_CHALLENGE_WIN}
                    [/then]
                    [else]
                        [sound]
                            name=bow-miss.ogg
                        [/sound]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(The bow is aptly named. You nearly break your back trying to draw it! Your arrow flies a pitiful distance into the grass. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(The bow is aptly named. You nearly break your back trying to draw it! Your arrow flies a pitiful distance into the grass. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {SPEAKER_GENERIC_IF (id=Valin) ( _ "female^And it seems the BACKBREAKER has triumphed over yet ANOTHER contestant!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=Valin) ( _ "male^And it seems the BACKBREAKER has triumphed over yet ANOTHER contestant!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                    [/else]
                    [/if]
                )}
            )}
        [/then]
        [/if]
    #enddef

    #define RAM SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}
        {HAS_TRAITS}

        [if]
            {VARIABLE_NUMERICAL_EQUALS ram_challenge 2}
        [then]
            {SPEAKER_GENERIC (id=Ram Aide) ( _ "All that drink'in shure wash fun. I think I'm gonna regret it in tha morning though.")}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS ram_challenge 0}
        [then]
            {SPEAKER_GENERIC (id=$unit.id) ( _ "(You see a surly looking dwarf leaning up against a gigantic barrel.)")}
            {SPEAKER_GENERIC (id=$unit.id) ( _ "That's a BIG barrel you've got there...")}
            {SPEAKER_GENERIC (id=Ram Aide) ( _ "(His speech is slurred and you realize he's drunk) Yessh, yessh it is my pretty. And itsh mine, ALL mine!!! All tha booze in tha worldsh! Hic!")}
            {SPEAKER_GENERIC (id=$unit.id) ( _ "So that barrel is full of liquor? Why do you need so much?")}
            {SPEAKER_GENERIC (id=Ram Aide) ( _ "Ta blowsh the bridge of coursh! Tha bridge inta town. Tha oozes gonna BURN when they get to Pinewood, ha ha hic! Or ats least thatsh what tha Mayor says.")}
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(How to react?)") (
                {SPEAKER_OPTION ( _ "I don't think you're responsible enough to be the custodian of that barrel.") (
                    {SPEAKER_GENERIC_IF (id=Ram Aide) ( _ "female^Hic! I am TOO vigilant! You notish how none o' thosh oozes haf come ta town yet? They KNOWSH I could spots 'em a mile away! Hic!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                    {SPEAKER_GENERIC_IF (id=Ram Aide) ( _ "male^Hic! I am TOO vigilant! You notish how none o' thosh oozes haf come ta town yet? They KNOWSH I could spots 'em a mile away! Hic!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                    {SPEAKER_GENERIC (id=Ram Aide) ( _ "If yoush wants tha barrel, you gotta PROVE you deserve it!")}
                    {SPEAKER_GENERIC (id=$unit.id) ( _ "How?")}
                    {SPEAKER_GENERIC (id=Ram Aide) ( _ "Why, the only wayth you can prove anything! A drink'in contesht!")}
                    {VARIABLE ram_challenge 1}
                    [remove_item]
                        x,y=4,7
                    [/remove_item]
                )}
                {SPEAKER_OPTION ( _ "(Leave) I don't care about this.") (
                    {SPEAKER_GENERIC (id=Ram Aide) ( _ "Goodb-hic!")}
                )}
            )}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS ram_challenge 1}
        [then]
            {VARIABLE ram_challenge 2}

            [if]
                {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
            [then]
                {VARIABLE_OP quests_aurelia add 1}   
            [/then]
            [else]
                {VARIABLE_OP quests_sithras add 1}    
            [/else]
            [/if]

            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to do?)") (
                {SPEAKER_OPTION ( _ "(Try and out-drink Ram Aide)") (
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS have_resilient[0] 1}
                    [then]
                        [if]
                            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                        [then]
                            {SPEAKER_GENERIC (id=$unit.id) ( _ "female^(You drink cup after cup of hard liquor. Your vision blurs and the world becomes hazy. After an hour you can barely stand, but Ram Aide has collapsed in a drunken stupor. You've won!)")}
                            {NARRATOR_DEFAULT "items/oldbarrel.png" ( _ "female^You've gained possession of a gigantic barrel of booze. Perhaps you'll be able to find some use for it later.")}
                        [/then]
                        [else]
                            {SPEAKER_GENERIC (id=$unit.id) ( _ "male^(You drink cup after cup of hard liquor. Your vision blurs and the world becomes hazy. After an hour you can barely stand, but Ram Aide has collapsed in a drunken stupor. You've won!)")}
                            {NARRATOR_DEFAULT "items/oldbarrel.png" ( _ "male^You've gained possession of a gigantic barrel of booze. Perhaps you'll be able to find some use for it later.")}
                        [/else]
                        [/if]

                        {VARIABLE ram_friend $master_ooze}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {LEADERSHIP 1 $master_ooze}
                    [/then]
                    [else]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(You drink cup after cup of hard liquor. Your vision blurs and the world becomes hazy. After an hour you collapse in a drunken stupor, Ram Aide's slurred and mocking laughter the last thing you hear before you slip into unconsciousness. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(You drink cup after cup of hard liquor. Your vision blurs and the world becomes hazy. After an hour you collapse in a drunken stupor, Ram Aide's slurred and mocking laughter the last thing you hear before you slip into unconsciousness. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                    [/else]
                    [/if]
                )}
                {SPEAKER_OPTION ( _ "(Cheat in the drinking contest by quickly tossing the liquor in the grass when Ram Aide isn't looking)") (
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS have_quickness[0] 1}
                    [then]
                        [if]
                            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                        [then]
                            {SPEAKER_GENERIC (id=$unit.id) ( _ "female^(Your cheating has paid off! Ram Aide collapses in a drunken stupor after an hour of hard drinking. You've won!)")}
                            {NARRATOR_DEFAULT "items/oldbarrel.png" ( _ "female^You've gained possession of a gigantic barrel of booze. Perhaps you'll be able to find some use for it later.")}
                        [/then]
                        [else]
                            {SPEAKER_GENERIC (id=$unit.id) ( _ "male^(Your cheating has paid off! Ram Aide collapses in a drunken stupor after an hour of hard drinking. You've won!)")}
                            {NARRATOR_DEFAULT "items/oldbarrel.png" ( _ "male^You've gained possession of a gigantic barrel of booze. Perhaps you'll be able to find some use for it later.")}
                        [/else]
                        [/if]

                        {VARIABLE ram_friend $master_ooze}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {LEADERSHIP 1 $master_ooze}
                    [/then]
                    [else]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(You aren't quick enough. Ram Aide notices your cheating and chases you away from his barrel at gunpoint. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(You aren't quick enough. Ram Aide notices your cheating and chases you away from his barrel at gunpoint. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                    [/else]
                    [/if]
                )}
                {SPEAKER_OPTION ( _ "(Deftly place some noxious herbs in Ram Aide's tankard when he isn't looking)") (
                    [if]
                        {VARIABLE_NUMERICAL_EQUALS have_dexterity[0] 1}
                    [then]
                        [if]
                            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                        [then]
                            {SPEAKER_GENERIC (id=$unit.id) ( _ "female^(Your cheating has paid off! Ram Aide is forced to forfeit after getting sick. You've won!)")}
                            {NARRATOR_DEFAULT "items/oldbarrel.png" ( _ "female^You've gained possession of a gigantic barrel of booze. Perhaps you'll be able to find some use for it later.")}
                        [/then]
                        [else]
                            {SPEAKER_GENERIC (id=$unit.id) ( _ "male^(Your cheating has paid off! Ram Aide is forced to forfeit after getting sick. You've won!)")}
                            {NARRATOR_DEFAULT "items/oldbarrel.png" ( _ "male^You've gained possession of a gigantic barrel of booze. Perhaps you'll be able to find some use for it later.")}
                        [/else]
                        [/if]

                        {VARIABLE ram_friend $master_ooze}
                        {VARIABLE_OP leaderless_troops sub 1}
                        {LEADERSHIP 1 $master_ooze}
                    [/then]
                    [else]
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^(You aren't dexterous enough. Ram Aide notices your attempt and chases you away from his barrel at gunpoint. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^(You aren't dexterous enough. Ram Aide notices your attempt and chases you away from his barrel at gunpoint. You failed!)") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                    [/else]
                    [/if]
                )}
                {SPEAKER_OPTION ( _ "This is ridiculous, goodbye!") (
                    {SPEAKER_GENERIC (id=Ram Aide) ( _ "Goodby-hic!")}
                )}
            )}
        [/then]
        [/if]
    #enddef

    #define DONATION TRUE
        [if]
            {VARIABLE_EQUALS has_gold yes}
        [then]
            {TRUE}
        [/then]
        [else]
            {SPEAKER_GENERIC (id=$unit.id) ( _ "(Actually you don't have that much)")}
        [/else]
        [/if]
    #enddef

    #define HIGH_PRIEST_JAL SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS donation 0}
        [then]
            {SPEAKER_GENERIC_IF (id=High Priest Jal) ( _ "female^Would you be interested in making a donation to Pelor, god of healing?") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
            {SPEAKER_GENERIC_IF (id=High Priest Jal) ( _ "male^Would you be interested in making a donation to Pelor, god of healing?") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
                {SPEAKER_OPTION ( _ "(Make a small donation) Here's five gold pieces.") (
                    {TEAM_HAS_GOLD 5 $master_ooze}
                    {DONATION (
                        {SPEAKER_GENERIC (id=High Priest Jal) ( _ "Thank you. May Pelor's light always shine upon you!")}
                        {TEAM_GOLD lost 5 $master_ooze}
                    )}
                )}
                {SPEAKER_OPTION ( _ "(Make a large donation) Here's fifty gold pieces.") (
                    {TEAM_HAS_GOLD 50 $master_ooze}
                    {DONATION (
                        [if]
                            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
                        [then]
                            {VARIABLE_OP quests_aurelia add 1} 
                        [/then]
                        [else]
                            {VARIABLE_OP quests_sithras add 1}
                        [/else]
                        [/if]

                        {VARIABLE donation 1}
                        [remove_item]
                            x,y=15,9
                        [/remove_item]

                        {SPEAKER_GENERIC_IF (id=High Priest Jal) ( _ "My lady is MOST generous! You have gained a great ally in Pelor today!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                        {SPEAKER_GENERIC_IF (id=High Priest Jal) ( _ "My lord is MOST generous! You have gained a great ally in Pelor today!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                        {VARIABLE jal_friend $master_ooze}
                        {LEADERSHIP 1 $master_ooze}
                        {TEAM_GOLD lost 50 $master_ooze}
                    )}
                )}
                {SPEAKER_OPTION ( _ "(Decline to donate) Sorry, not today.") (
                    {SPEAKER_GENERIC (id=High Priest Jal) ( _ "Peace be with you.")}
                )}
            )}
        [/then]
        [else]
            {SPEAKER_GENERIC (id=High Priest Jal) ( _ "May the blessings of Pelor be upon thee, child.")}
        [/else]
        [/if]
    #enddef

    #define ALKAR SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS alkar_offer 0}
        [then]
            [if]
                {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
            [then]
                {SPEAKER_GENERIC (id=$unit.id) ( _ "(You see a young man training with his pitchfork, though he doesn't seem to be very good at it. He looks like part of the village militia. He is so absorbed in his task that he doesn't even notice you. Perhaps your warrior companion ooze could give him some advice.)")}
            [/then]
            [else]
                {TEAM_HAS_GOLD 30 $master_ooze}
                {SPEAKER_GENERIC (id=$unit.id) ( _ "(You see a young man training with his pitchfork. He looks like part of the village militia.)")}
                {SPEAKER_GENERIC (speaker=Alkar) ( _ "You look like an experienced warrior sir. Would you like to train me in combat? Not for free of course... I could pay you 40 gold pieces for your expertise.")}
                {SPEAKER_SPECIAL (id=$unit.id) ( _ "(How to respond?)") (
                    {SPEAKER_OPTION ( _ "(Accept) Before I can train you I need to see what you can do.") (
                        {VARIABLE alkar_offer 1}
                    )}
                    {SPEAKER_OPTION ( _ "Why do you want to learn from an elven fighter? Aren't there plenty of human warriors here that you could learn from?") (
                        {VARIABLE alkar_offer 2}
                    )}
                    {SPEAKER_OPTION ( _ "(Reject) I have no time for this.") (
                        {VARIABLE alkar_offer 3}
                        [remove_item]
                            x,y=6,5
                        [/remove_item]
                    )}
                )}
            [/else]
            [/if]

            [if]
                {VARIABLE_NUMERICAL_EQUALS alkar_offer 2}
            [then]
                {SPEAKER_GENERIC (speaker=Alkar) ( _ "There's hardly anyone in this fort with real combat experience. I feel like I'm just not making any progress in the Pinewood militia. But you...well it's a well known fact that elves live for centuries. Elves who have dedicated themselves to the art of war must surely be masters of its craft with so many years of experience!")}
                {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to respond?)") (
                    {SPEAKER_OPTION ( _ "(Accept) Before I can train you I need to see what you can do.") (
                        {VARIABLE alkar_offer 1}
                    )}
                    {SPEAKER_OPTION ( _ "(Reject) I have no time for this.") (
                        {VARIABLE alkar_offer 3}
                        [remove_item]
                            x,y=6,5
                        [/remove_item]
                    )}
                )}
            [/then]
            [/if]

            [if]
                {VARIABLE_NUMERICAL_EQUALS alkar_offer 1}
            [then]
                {SPEAKER_GENERIC (speaker=Alkar) ( _ "Of course sir. (You start a test fight with Alkar)")}
                {SPEAKER_SPECIAL (id=$unit.id) (_ "(During this short test you've noticed that he is brave and fast, but unfortunately he lacks real combat skill. He keeps trying to defeat you with one powerful strike that you easily parry... If he could do this from horseback as some human warriors do it might work out. But this is just awful!)") (
                    {SPEAKER_OPTION ( _ "If we got you better equipment you might make a decent spearman.") (
                        {VARIABLE alkar_offer 1}
                    )}
                    {SPEAKER_OPTION ( _ "I think that you'll fight better on horseback.") (
                        {VARIABLE alkar_offer 2}
                    )}
                )}
            [/then]
            [/if]

            [if]
                {VARIABLE_NUMERICAL_EQUALS alkar_offer 2}
            [then]
                {SPEAKER_GENERIC (speaker=Alkar) ( _ "I'm afraid that I don't have enough gold for equipment. I'd need 30 gold pieces more than I have.")}
                {SPEAKER_SPECIAL (id=$unit.id) ( _ "(How to respond?)") (
                    {SPEAKER_OPTION ( _ "In that case I'll teach you how to be a spearman.") (
                        {VARIABLE alkar_offer 1}
                    )}
                    {SPEAKER_OPTION_IF ( _ "I'll give you 30 gold pieces so you can buy a good horse.") {VARIABLE_EQUALS has_gold yes} (
                        {VARIABLE alkar_offer 2}
                    )}
                )}
            [/then]
            [/if]

            [if]
                {VARIABLE_NUMERICAL_EQUALS alkar_offer 1}
            [then]
                {SPEAKER_GENERIC (id=$unit.id) ( _ "(You spend a day training Alkar)")}
                [kill]
                    id=Alkar
                [/kill]
                {UNIT {F1} Spearman 6 4 (
                    id=Alkar
                    name= _ "Alkar"
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_QUICK}
                    [/modifications]
                    {IS_LOYAL}
                )}
                {SPEAKER_GENERIC (speaker=Alkar) ( _ "Thank you sir. I think I really learned something today! Here is your 40 gold!")}
                {VARIABLE alkar_friend $master_ooze}
                {TEAM_GOLD earn 40 $master_ooze}
                {VARIABLE alkar_offer 3}
                {LEADERSHIP 1 $master_ooze}
                [remove_item]
                    x,y=6,5
                [/remove_item]
            [/then]
            [/if]

            [if]
                {VARIABLE_NUMERICAL_EQUALS alkar_offer 2}
            [then]
                {SPEAKER_GENERIC (speaker=Alkar) ( _ "Thank you sir. I owe you a debt and I won't forget it!")}
                {SPEAKER_GENERIC (speaker=Alkar) ( _ "I'll do my best not to disappoint you!")}
                {VARIABLE alkar_friend $master_ooze}
                {TEAM_GOLD lost 30 $master_ooze}
                {VARIABLE alkar_offer 4}
                {LEADERSHIP 1 $master_ooze}
                [remove_item]
                    x,y=6,5
                [/remove_item]
            [/then]
            [/if]
        [/then]
        [/if]
    #enddef

    #define SHADY_CHARACTER
        [remove_item]
            x,y=17,12
        [/remove_item]
        {SPEAKER_GENERIC (id=Shady Character) ( _ "Move along! Nothing to see here! Really! Go away!")}
    #enddef

    #define GUTHRY SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE_OP quests_aurelia add 1}
            {SPEAKER_GENERIC (id=Guthry) ( _ "female^Hello stranger. It's not often you see an elf in Fort Pinewood. It's said your kind knows about...sylvan problems...so maybe you'd be able to help me.")}
        [/then]
        [else]
            {VARIABLE_OP quests_sithras add 1}
            {SPEAKER_GENERIC (id=Guthry) ( _ "male^Hello stranger. It's not often you see an elf in Fort Pinewood. It's said your kind knows about...sylvan problems...so maybe you'd be able to help me.")}
        [/else]
        [/if]

        {SPEAKER_GENERIC (id=Guthry) ( _ "My brother used to own this cottage, but he was in the militia and...")}
        {SPEAKER_GENERIC (id=$unit.id) ( _ "Got eaten?")}
        {SPEAKER_GENERIC (id=Guthry) ( _ "Yeah. No worries though, I hated the guy. And now I've inherited his cottage. Only problem is, there's this crazed fairy that keeps attacking me! Then she runs to hide in the forest when I call for the town guards!")}
        {UNIT {F1} "Elvish Druid" 5 3 (
            id=Dryad
            name= _ "Dryad"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
            facing=sw
        )}

        [redraw]
        [/redraw]

        {SPEAKER_GENERIC (id=Dryad) ( _ "Lies! This land is mine! The human who used to live in the cottage was nice. But this new human tried to cut down my tree.")}
        {SPEAKER_GENERIC (id=Guthry) ( _ "It's my tree, not yours! I own this land now! Its been in my family for five generations.")}
        {SPEAKER_GENERIC (id=Dryad) ( _ "I do not know what these 'generations' are that you speak of. But I have lived here since my tree was but a tiny sprout in the ground. The human town is something new. I do not like it. The humans need to leave this place forever.")}
        {SPEAKER_GENERIC (id=Guthry) ( _ "Help me claim my inheritance and I'll reward you well.")}
        [remove_item]
            x,y=4,4
        [/remove_item]
        {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
            {SPEAKER_OPTION_IF ( _ "(Side with Guthry) I'll use my sylvan magic to banish this crazy dryad.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1} (
                {SPEAKER_GENERIC (id=Dryad) ( _ "female^No! You're an elf! How could you side with--")}
                {SPEAKER_GENERIC (id=$unit.id) ( _ "Niste Siara Belkan! (You banish the dryad back into her tree. It will be many years before she will be able to emerge again.)")}
                [kill]
                    id=Dryad
                    animate=yes
                [/kill]
                {SPEAKER_GENERIC (id=Guthry) ( _ "Thanks for the help! Here's fifty gold for your trouble.")}
                {VARIABLE guthry_friend $master_ooze}
                {LEADERSHIP 1 $master_ooze}
                {TEAM_GOLD gain 50 $master_ooze}
            )}
            {SPEAKER_OPTION_IF ( _ "(Side with Guthry) This man is just protecting his property. Leave him alone or else!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2} (
                {SPEAKER_GENERIC (id=Guthry) ( _ "That's it?! You won't do anything more?!")}
                {SPEAKER_GENERIC (id=Dryad) ( _ "male^You're an elf! How could you side with--")}
                {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "(You pull out your sword with astonishing speed. For one long moment a sunbeam beautifully plays on the blade's surface. The next moment the dryad lies dead under her tree...)") {VARIABLE_NUMERICAL_EQUALS have_dexterity[2] 1}}
                {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "(Steel lightning strikes... Before anyone can react the dryad lies dead under her tree, cut in twain by your sword...)") {VARIABLE_NUMERICAL_EQUALS have_quickness[2] 1}}
                [kill]
                    id=Dryad
                    animate=yes
                [/kill]

                [if]
                    {VARIABLE_NUMERICAL_EQUALS have_dexterity[2] 1}
                [then]
                    {SPEAKER_GENERIC (id=Guthry) ( _ "You just... You actually... Killed her... That was amazing! I've never seen anything like it! You make killing look like an art!")}
                    {SPEAKER_GENERIC (id=$unit.id) ( _ "(You raise an eyebrow and speak very calmly.) So, you really liked it? Should I make another performance especially for you?")}
                [/then]
                [else]
                    {SPEAKER_GENERIC (id=Guthry) ( _ "You... You just... Killed her... That was amazing! It was so quick I didn't even realize what had happened until it was all over! You are truly a great warrior!")}
                    {SPEAKER_GENERIC (id=$unit.id) ( _ "(You smile a smile as warm as ice.) You want to see it again in slow motion?")}
                [/else]
                [/if]

                {SPEAKER_GENERIC (id=Guthry) ( _ "(He speaks very fast and his voice quavers) No, that's absolutely unnecessary! I have a lot on my mind right now so thanks for the help! Here's seventy gold for your trouble.")}
                {VARIABLE guthry_friend $master_ooze}
                {LEADERSHIP 1 $master_ooze}
                {TEAM_GOLD gain 70 $master_ooze}
            )}
            {SPEAKER_OPTION ( _ "(Side with the Dryad) The Dryad was here first, she is in the right.") (
                {SPEAKER_GENERIC (id=Guthry) ( _ "Damn dryad and her damn tree-hugging sympathizers! (Menacingly) I know I can't take this land by force, but mark my words, one day someone strong will come along who'll see my side of things!")}
                {SPEAKER_GENERIC_IF (id=Dryad) ( _ "female^Thank you for helping keep the rabid human at bay, though I fear it is just for a little while longer. If you ever need a friend of the Forest, I am here.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                {SPEAKER_GENERIC_IF (id=Dryad) ( _ "male^Thank you for helping keep the rabid human at bay, though I fear it is just for a little while longer. If you ever need a friend of the Forest, I am here.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                {VARIABLE dryad_friend $master_ooze}
                {LEADERSHIP 1 $master_ooze}
            )}
        )}

        {VARIABLE guthry_quest 1}
    #enddef

    #define SLAVER_DEBATE_STAGE VALUE
        {VARIABLE slaver_debate {VALUE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE slaver_debate_aurelia $slaver_debate}
        [/then]
        [else]
            {VARIABLE slaver_debate_sithras $slaver_debate}
        [/else]
        [/if]
    #enddef

    #define SLAVER_DEBATE SIDE
        {VARIABLE master_ooze {SIDE}}
        {MASTER_OOZE_LOCATION {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE slaver_debate $slaver_debate_aurelia}
        [/then]
        [else]
            {VARIABLE slaver_debate $slaver_debate_sithras}
        [/else]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS slaver_debate 0}
        [then]
            [if]
                {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
            [then]
                {VARIABLE_OP quests_aurelia add 1}
                {VARIABLE slaver_debate_sithras 4}
            [/then]
            [else]
                {VARIABLE_OP quests_sithras add 1}
                {VARIABLE slaver_debate_aurelia 4}
            [/else]
            [/if]

            {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "Thirty gold pieces gets you your very own troll whelp slave. Use the creature for manual labor, bet on him in the gladiator pits, sic him on your enemies, just think of the possibilities! And all for the low, low price of thirty gold!")}
            {SPEAKER_GENERIC (id=Bryony the Idealist) ( _ "Enslaving other creatures is wrong! How can you be so cold-hearted?!")}
            {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "What do you care? You're not the one being sold on the auction block!")}
            {SPEAKER_GENERIC (id=Bryony the Idealist) ( _ "I'll have the town guards arrest you!")}
            {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "For what? Slavery is legal in this province. So take your self-righteous attitude, turn yourself around, and walk the other way! Or maybe I'll have Gorl teach you a lesson.")}
            {SPEAKER_GENERIC (id=Gorl the Smasher) ( _ "(Grunts)")}
            {SPEAKER_GENERIC (id=Kirielle the Realist) ( _ "Come on Bryony, there's nothing to be gained from agitating the locals. We must stay focused on our mission!")}
            {SPEAKER_GENERIC (id=Bryony the Idealist) ( _ "We can't just walk away from something like this!")}
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
                {SPEAKER_OPTION ( _ "I'll buy the troll whelp for 30 gold.") (
                    {SPEAKER_GENERIC (id=Bryony the Idealist) ( _ "I hope you realize that by patronizing this man's business you're only encouraging him!")}
                    {SLAVER_DEBATE_STAGE 1}
                )}
                {SPEAKER_OPTION ( _ "(Side with Bryony) Slaving is an evil business! I think you should stop.") (
                    {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "I used to be a beggar on the streets of Tarakin City, but since I got into slaving I've always had three meals a day and a soft bed to sleep in at night. What the hell do you elves know about poverty or evil?")}
                    {SPEAKER_GENERIC (id=Bryony the Idealist) ( _ "Just because you had a rough life doesn't mean you're entitled to make other people suffer!")}
                    {SLAVER_DEBATE_STAGE 2}
                )}
                {SPEAKER_OPTION ( _ "(Don't get involved).") (
                    {SPEAKER_GENERIC (id=$unit.id) ( _ "(The elf and the human are still arguing as you leave)")}
                    {SLAVER_DEBATE_STAGE 4}
                    [remove_item]
                        x,y=10,2
                    [/remove_item]
                )}
            )}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS slaver_debate 1}
        [then]
            {TEAM_HAS_GOLD 30 $master_ooze}

            [if]
                {VARIABLE_EQUALS has_gold yes}
            [then]
                {SPEAKER_GENERIC_IF (id=Haffuz the Slaver) ( _ "female^A pleasure doing business with you! Would you like to take your slave with you now?") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                {SPEAKER_GENERIC_IF (id=Haffuz the Slaver) ( _ "male^A pleasure doing business with you! Would you like to take your slave with you now?") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                {SPEAKER_GENERIC (id=$unit.id) ( _ "I'll pick him up shortly.")}
                {VARIABLE troll_friend $master_ooze}
                {LEADERSHIP 1 $master_ooze}
                {TEAM_GOLD spent 30 $master_ooze}
                {SLAVER_DEBATE_STAGE 4}
                [remove_item]
                    x,y=10,2
                [/remove_item]
            [/then]
            [else]
                {SPEAKER_GENERIC_IF (id=Haffuz the Slaver) ( _ "female^You don't have that much money right now. Come back when you can pay me.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                {SPEAKER_GENERIC_IF (id=Haffuz the Slaver) ( _ "male^You don't have that much money right now. Come back when you can pay me.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
            [/else]
            [/if]
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS slaver_debate 2}
        [then]
            {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "Everyone has to look out for themselves, because no one else is gonna do it for you. That's what ten years of living on the streets of Tarakin City taught me. Why should I give up slaving? What's in it for me?")}
            {SPEAKER_SPECIAL (id=$unit.id) ( _ "(What to say?)") (
                {SPEAKER_OPTION ( _ "You'll have a clear conscience.") (
                    {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "I'd rather be rich than have a clear conscience! Now leave, before I have Gorl here give you a pounding!")}
                    {SLAVER_DEBATE_STAGE 4}
                    [remove_item]
                        x,y=10,2
                    [/remove_item]
                )}
                {SPEAKER_OPTION ( _ "I'll pay you money to work for me as a bodyguard. 50 gold pieces for the two of you!") (
                    {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "What do you think, Gorl?")}
                    {SPEAKER_GENERIC (id=Gorl the Smasher) ( _ "(Grunts)")}
                    {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "Gorl likes it.")}
                    {SLAVER_DEBATE_STAGE 3}
                )}
            )}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS slaver_debate 3}
        [then]
            {TEAM_HAS_GOLD 50 $master_ooze}

            [if]
                {VARIABLE_EQUALS has_gold yes}
            [then]
                {SPEAKER_GENERIC (id=Haffuz the Slaver) ( _ "Goodbye slavery, hello lucrative bodyguard contract!")}
                {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "female^Wait for me here until I need you.") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                {SPEAKER_GENERIC_IF (id=$unit.id) ( _ "male^Wait for me here until I need you.") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                {SPEAKER_GENERIC_IF (id=Haffuz the Slaver) ( _ "Yes ma'am!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                {SPEAKER_GENERIC_IF (id=Haffuz the Slaver) ( _ "Yes sir!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
                {VARIABLE slavers_friend $master_ooze}
                {LEADERSHIP 3 $master_ooze}
                {TEAM_GOLD spent 50 $master_ooze}
                {SLAVER_DEBATE_STAGE 3}
                [remove_item]
                    x,y=10,2
                [/remove_item]
            [/then]
            [else]
                {SPEAKER_GENERIC_IF (id=Haffuz the Slaver) ( _ "female^Come back when you have the money!") {VARIABLE_NUMERICAL_EQUALS master_ooze 1}}
                {SPEAKER_GENERIC_IF (id=Haffuz the Slaver) ( _ "male^Come back when you have the money!") {VARIABLE_NUMERICAL_EQUALS master_ooze 2}}
            [/else]
            [/if]
        [/then]
        [/if]
    #enddef

    #define HOST_TRAIT1 HOST
        {SPEAKER_OPTION ( _ "I will focus on strength. I want to be able to overpower the opposition.") (
            {VARIABLE have_strength[{HOST}] 1}
        )}
        {SPEAKER_OPTION ( _ "I will focus on endurance. I want to be able to outlast my opponents.") (
            {VARIABLE have_resilient[{HOST}] 1}
        )}
    #enddef

    #define HOST_TRAIT2 HOST
        {SPEAKER_OPTION ( _ "I will focus on manual dexterity. It will help bolster my ranged attacks.") (
            {VARIABLE have_dexterity[{HOST}] 1}
        )}
        {SPEAKER_OPTION ( _ "I will focus on fleetness of foot. I want to be able to outrun my enemies.") (
            {VARIABLE have_quickness[{HOST}] 1}
        )}
    #enddef

    #define OOZE_HOST ID HOST NAME TYPE X Y
        [kill]
            id={ID}
        [/kill]

        [redraw]
        [/redraw]

        [if]
            {VARIABLE_NUMERICAL_EQUALS have_strength[{HOST}] 1}
            [and]
                {VARIABLE_NUMERICAL_EQUALS have_dexterity[{HOST}] 1}
            [/and]
        [then]
            {UNIT {HOST} {TYPE} {X} {Y} (
                id={ID}
                name={NAME}
                [modifications]
                    {TRAIT_STRONG}
                    {TRAIT_DEXTROUS}
                [/modifications]
                canrecruit=yes
            )}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS have_strength[{HOST}] 1}
            [and]
                {VARIABLE_NUMERICAL_EQUALS have_quickness[{HOST}] 1}
            [/and]
        [then]
            {UNIT {HOST} {TYPE} {X} {Y} (
                id={ID}
                name={NAME}
                [modifications]
                    {TRAIT_STRONG}
                    {TRAIT_QUICK}
                [/modifications]
                canrecruit=yes
            )}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS have_resilient[{HOST}] 1}
            [and]
                {VARIABLE_NUMERICAL_EQUALS have_dexterity[{HOST}] 1}
            [/and]
        [then]
            {UNIT {HOST} {TYPE} {X} {Y} (
                id={ID}
                name={NAME}
                [modifications]
                    {TRAIT_RESILIENT}
                    {TRAIT_DEXTROUS}
                [/modifications]
                canrecruit=yes
            )}
        [/then]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS have_resilient[{HOST}] 1}
            [and]
                {VARIABLE_NUMERICAL_EQUALS have_quickness[{HOST}] 1}
            [/and]
        [then]
            {UNIT {HOST} {TYPE} {X} {Y} (
                id={ID}
                name={NAME}
                [modifications]
                    {TRAIT_RESILIENT}
                    {TRAIT_QUICK}
                [/modifications]
                canrecruit=yes
            )}
        [/then]
        [/if]
    #enddef

    #define PINEWOOD_RULES
        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "In this scenario time is unlimited, but there is a limited number of quests you can accept. Your character will warn you when this event happens.")}
    #enddef

    #define PINEWOOD_TRANSACTIONS_OVER SIDE
        {VARIABLE master_ooze {SIDE}}

        [if]
            {VARIABLE_NUMERICAL_EQUALS master_ooze 1}
        [then]
            {VARIABLE have_training $have_training_aurelia}
        [/then]
        [else]
            {VARIABLE have_training $have_training_sithras}
        [/else]
        [/if]

        [if]
            {VARIABLE_GREATER_THAN have_training 0}
        [then]
            [if]
                {VARIABLE_NUMERICAL_EQUALS pinewood_transactions_done 0}
            [then]
                {SPEAKER_SPECIAL (id=$unit.id) ( _ "(Have you finished exploring Fort Pinewood)?") (
                    {SPEAKER_OPTION ( _ "Yes (Your turn will be omitted to the end of scenario).") (
                        {VARIABLE pinewood_transactions_done $master_ooze}
                        {MOVE_OOZE 10 13 10 12}
                        [end_turn]
                        [/end_turn]
                    )}
                    [option]
                        message= _ "Not yet."
                    [/option]
                )}
            [/then]
            [else]
                {SPEAKER_SPECIAL (id=$unit.id) ( _ "(Have you finished exploring Fort Pinewood)?") (
                    {SPEAKER_OPTION ( _ "Yes (End level).") (
                        [store_unit]
                            [filter]
                                id=Master Ooze
                            [/filter]
                            variable=ooze_store[0]
                        [/store_unit]
                        [store_unit]
                            [filter]
                                id=Master Ooze 2
                            [/filter]
                            variable=ooze_store[1]
                        [/store_unit]

                        {CLEAR_VARIABLE wandering_ooze}
                        {CLEAR_VARIABLE pinewood_transactions_done}
                        {CLEAR_VARIABLE have_strength}
                        {CLEAR_VARIABLE have_dexterity}
                        {CLEAR_VARIABLE have_quickness}
                        {CLEAR_VARIABLE have_resilient}
                        {CLEAR_VARIABLE have_training}
                        {CLEAR_VARIABLE have_training_aurelia}
                        {CLEAR_VARIABLE have_training_sithras}
                        {CLEAR_VARIABLE book_hunt}
                        {CLEAR_VARIABLE slaver_debate}
                        {CLEAR_VARIABLE slaver_debate_aurelia}
                        {CLEAR_VARIABLE slaver_debate_sithras}
                        {CLEAR_VARIABLE foe_number}
                        {CLEAR_VARIABLE have_book}
                        {CLEAR_VARIABLE hay_hunt}
                        {CLEAR_VARIABLE hay_haul}
                        {CLEAR_VARIABLE brock_challenge}
                        {CLEAR_VARIABLE brock_challenge_aurelia}
                        {CLEAR_VARIABLE brock_challenge_sithras}
                        {CLEAR_VARIABLE valin_challenge}
                        {CLEAR_VARIABLE valin_challenge_aurelia}
                        {CLEAR_VARIABLE valin_challenge_sithras}
                        {CLEAR_VARIABLE ram_challenge}
                        {CLEAR_VARIABLE donation}
                        {CLEAR_VARIABLE ongoing_fight}
                        {CLEAR_VARIABLE fight_end}
                        {CLEAR_VARIABLE dryden_quest}
                        {CLEAR_VARIABLE quest_sir_dryden}
                        {CLEAR_VARIABLE mayor_wyatt_speach}
                        {CLEAR_VARIABLE side_turn_to_end}
                        {CLEAR_VARIABLE book_hunt}
                        {CLEAR_VARIABLE guthry_quest}

                        {ENDLEVEL_VICTORY_DEFAULT}
                    )}
                    [option]
                        message= _ "Not yet."
                    [/option]
                )}
            [/else]
            [/if]
        [/then]
        [/if]
    #enddef

    # ===================================================================================================================== #
    # SCENARIO DEFINITION
    # ===================================================================================================================== #

    [label]
        x,y=10,10
        text= _ "Wyatt Manor"
    [/label]
    [label]
        x,y=6,8
        text= _ "Training Hall"
    [/label]

    {PLACE_IMAGE scenery/leanto.png 3 7}
    {PLACE_IMAGE scenery/signpost.png 11 18}
    {PLACE_IMAGE scenery/temple1.png 14 6}
    {PLACE_IMAGE scenery/tent-fancy-red.png 18 7}
    {PLACE_IMAGE scenery/well.png 6 6}
    {PLACE_IMAGE items/archery-target-right.png 17 9}
    {PLACE_IMAGE items/archery-target-right.png 18 9}
    {PLACE_IMAGE items/grain-sheaf.png 13 3}
    {PLACE_IMAGE units/trolls/whelp.png 9 2}
    {PLACE_IMAGE items/cage.png 9 2}
    {PLACE_IMAGE items/book1.png 3 14}
    {PLACE_IMAGE items/scarecrow.png 16 3}
    {PLACE_IMAGE items/straw-bale1.png 15 5}
    {PLACE_IMAGE items/straw-bale2.png 13 4}
    #{PLACE_IMAGE items/barrel.png 3 6}
    {PLACE_IMAGE items/oldbarrel.png 3 6}
    {PLACE_IMAGE items/gohere.png 10 11}

    {PLACE_IMAGE items/gohere.png 8 12}
    {PLACE_IMAGE items/gohere.png 13 12}
    {PLACE_IMAGE items/gohere.png 15 11}
    {PLACE_IMAGE items/gohere.png 17 12}
    {PLACE_IMAGE items/gohere.png 15 9}
    {PLACE_IMAGE items/gohere.png 17 8}
    {PLACE_IMAGE items/gohere.png 15 7}
    {PLACE_IMAGE items/gohere.png 14 5}
    {PLACE_IMAGE items/gohere.png 10 2}
    {PLACE_IMAGE items/gohere.png 6 9}
    {PLACE_IMAGE items/gohere.png 4 7}
    {PLACE_IMAGE items/gohere.png 6 5}
    {PLACE_IMAGE items/gohere.png 4 4}

    {SIDE_PROTAGONIST {P1} "Master Ooze" ( _ "Master Ooze") "Elvish Shaman Ooze" Ooze}
    {SIDE_PROTAGONIST {P2} "Master Ooze 2" ( _ "Master Ooze 2") "Elvish Fighter" Ooze2}
    
    [side]
        side={F1}
        controller=ai
        allow_player=no
        type=Mayor
        [modifications]
            {TRAIT_LOYAL}
            {TRAIT_QUICK}
        [/modifications]
        id=Mayor Wyatt
        name= _ "Mayor Wyatt"
        canrecruit=yes
        recruit=Peasant,Woodsman
        gold=0
        team_name=oozes
        user_team_name= _ "Townsfolk"
        [ai]
            ai_algorithm=idle_ai
        [/ai]
    [/side]
    
    [side]
        side={F2}
        controller=ai
        allow_player=no
        no_leader=yes
        gold=0
        income=-2
        team_name=enemies
        hidden=yes
        [ai]
            aggression=1.0
            [aspect]
                id=attacks
                [facet]
                    invalidate_on_gamestate_change=yes
                    [filter_own]
                        side={F2}
                    [/filter_own]
                    [filter_enemy]
                        side={P1},{P2}
                    [/filter_enemy]
                [/facet]
            [/aspect]
        [/ai]    
    [/side]

    [side]
        side={F3}
        controller=ai
        allow_player=no
        no_leader=yes
        gold=0
        income=-2
        team_name=enemies
        hidden=yes
        [ai]
            aggression=0.8
            [avoid]
                x=1-20,2-4,5,8-20,9-20,1-20
                y=1-5,6-10,10,6-7,8-10,11-20
            [/avoid]
            [aspect]
                id=attacks
                [facet]
                    invalidate_on_gamestate_change=yes
                    [filter_own]
                        side={F3}
                    [/filter_own]
                    [filter_enemy]
                        side={P1}
                    [/filter_enemy]
                [/facet]
            [/aspect]
        [/ai]
    [/side]

    # ===================================================================================================================== #
    # SCENARIO SETUP EVENTS
    # ===================================================================================================================== #

    [event]
        name=prestart

        {SCENARIO_OBJECTIVES {P1}}
        {SCENARIO_OBJECTIVES {P2}}

        {UNIT {F1} Spearman 9 15 (
            id=Stern Guard
            name= _ "Stern Guard"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            facing=se
            {IS_LOYAL}
        )}
        {UNIT {F1} Bowman 11 15 (
            id=Bored Guard
            name= _ "Bored Guard"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            facing=sw
            {IS_LOYAL}
        )}
        {UNIT {F1} "Heavy Infantryman" 9 10 (
            id=Big Bodyguard
            name= _ "Big Bodyguard"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} "Heavy Infantryman" 9 11 (
            id=Mean Bodyguard
            name= _ "Mean Bodyguard"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} "Heavy Infantryman" 11 10 (
            id=Ugly Bodyguard
            name= _ "Ugly Bodyguard"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            facing=sw
            {IS_LOYAL}
        )}
        {UNIT {F1} "Heavy Infantryman" 11 11 (
            id=Lazy Bodyguard
            name= _ "Lazy Bodyguard"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            facing=sw
            {IS_LOYAL}
        )}
        {UNIT {F1} "Dwarvish Thunderer" 3 7 (
            id=Ram Aide
            name= _ "Ram Aide"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} Rogue 17 13 (
            id=Shady Character
            name= _ "Shady Character"
            canrecruit=yes
            facing=sw
        )}
        {UNIT {F1} Fencer 16 10 (
            id=Fontaine
            name= _ "Fontaine"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            facing=sw
            {IS_LOYAL}
        )}
        {UNIT {F1} "White Mage" 14 8 (
            id=High Priest Jal
            name= _ "High Priest Jal"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} Peasant 14 4 (
            id=Jedd
            name= _ "Jedd"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} Woodsman 4 3 (
            id=Guthry
            name= _ "Guthry"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} Footpad 9 3 (
            id=Haffuz the Slaver
            name= _ "Haffuz the Slaver"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} Thug 8 2 (
            id=Gorl the Smasher
            name= _ "Gorl the Smasher"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} "Dark Sorceress" 3 11 (
            id=Corinna
            name= _ "Corinna"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            facing=se
            {IS_LOYAL}
        )}
        {UNIT {F1} Paladin 7 13 (
            id=Sir Dryden
            name= _ "Sir Dryden"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            facing=sw
            {IS_LOYAL}
        )}
        {UNIT {F1} Sergeant 10 5 (
            id=Sergeant Ryn
            name= _ "Sergeant Ryn"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} Mage 16 6 (
            id=Livius
            name= _ "Livius"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            facing=sw
            {IS_LOYAL}
        )}
        {UNIT {F1} Peasant 6 4 (
            id=Alkar
            name= _ "Alkar"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT {F1} "Dwarvish Fighter" 6 8 (
            id=Frist
            name= _ "Frist"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            side={F1}
            {IS_LOYAL}
        )}
        {UNIT {F1} Longbowman 18 8 (
            id=Valin
            name= _ "Valin"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            facing=sw
            {IS_LOYAL}
        )}
        {UNIT {F1} "Dwarvish Guardsman" 14 12 (
            id=Brock
            name= _ "Brock"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            profile=portraits/transparent/olddwarf-guard.png
            facing=sw
            {IS_LOYAL}
        )}
        {UNIT {F1} "Elvish Ranger" 10 1 (
            id=Kirielle the Realist
            name= _ "Kirielle the Realist"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            facing=sw
            gender=female
            {IS_LOYAL}
        )}
        {UNIT {F1} "Elvish Marksman" 11 2 (
            id=Bryony the Idealist
            name= _ "Bryony the Idealist"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            facing=sw
            gender=female
            {IS_LOYAL}
        )}

        [capture_village]
            side={F1}
            x=14,17,16,14,16,14,6,4,6,3
            y=12,13,10,8,6,4,4,3,8,11
        [/capture_village]
        [terrain]
            x=10
            y=19
            terrain=Re
        [/terrain]
        [terrain]
            x=12
            y=18
            terrain=Gg
        [/terrain]

        {VARIABLE quests_aurelia 0}
        {VARIABLE quests_sithras 0}
        {VARIABLE quests_limit 4}
        {VARIABLE training_aurelia 0}
        {VARIABLE brock_challenge_aurelia 0}
        {VARIABLE brock_challenge_sithras 0}
        {VARIABLE valin_challenge_aurelia 0}
        {VARIABLE valin_challenge_sithras 0}
        {VARIABLE slaver_debate_aurelia 0}
        {VARIABLE slaver_debate_sithras 0}
        {VARIABLE brock_friend 3}
        {VARIABLE valin_friend 3}
        {VARIABLE ram_friend 3}
        {VARIABLE corinna_friend 3}
        {VARIABLE sergeant_ryn_friend 3}
        {VARIABLE leaderless_troops 5}
        {VARIABLE leadership_aurelia 3}
        {VARIABLE leadership_sithras 0}
        {VARIABLE fight_end 0}

        {VARIABLE book_hunt 0}
        {VARIABLE slaver_debate 0}
        {VARIABLE dryden_quest 0}
    [/event]
    
    [event]
        name=side {P1} turn 1

        {NAME_LEADER {F1} ( _ "Mayor Wyatt")}

        {SPEAKER_GENERIC (id=Master Ooze) ( _ "The past few days you have gathered up all the slimy blobs of yourself and tightly compacted them into one small ooze, which now resides in the innards of the elvish Solid. Because you devoured the elf's spirit, her abilities are now at your command, although she lost much of her power with the destruction of the Forest Heart.")}
        {SPEAKER_GENERIC (id=Master Ooze) ( _ "female^It has taken you some time to get used to your new solid form. Your senses of taste, touch, hearing and sight are completely different. The elf's memories have given you new insight into the world.")}
        {SPEAKER_GENERIC (id=Master Ooze) ( _ "female^Being a Solid does have drawbacks though. You are more vulnerable to damage, and you're not able to squeeze yourself through small cracks or crevices. You grow tired more easily, and cannot simply dissolve your food in moments.")}
        {SPEAKER_SPECIAL (id=Master Ooze) ( _ "female^You need to determine where you should focus your new talents. Should you focus on developing your physical strength or work on building up your endurance?") (
            {HOST_TRAIT1 {P1}}
        )}
        {SPEAKER_SPECIAL (id=Master Ooze) ( _ "female^Elves are well known for their natural grace of movement. Should you focus on manual dexterity or fleetness of foot?") (
            {HOST_TRAIT2 {P1}}
        )}
        {SPEAKER_GENERIC (id=Master Ooze) ( _ "female^You've arrived at the gates of Fort Pinewood, the main Solid settlement in the region. You're going to have to decide whether to assimilate peacefully into the Solids' civilization, or attempt to destroy it from within...")}

        {MOVE_UNIT id="Master Ooze" (10,10,10,10) (18,17,16,15)}
        {OOZE_HOST "Master Ooze" {P1} ( _ "Master Ooze") "Elvish Shaman Ooze" 10 15}
        # Master Ooze 2
        {MOVE_UNIT id="Master Ooze 2" (10,10,10) (18,17,16)}

        {SPEAKER_GENERIC (id=Stern Guard) ( _ "Halt! Who the hell are you?")}
        {SPEAKER_GENERIC (id=Bored Guard) ( _ "Aw come on Carmen! Do ya have ta give everyone who passes through here a hard time? Let the elf lady pass! We're only standin' guard ta keep out th' oozes!")}
        {SPEAKER_GENERIC (id=Stern Guard) ( _ "Like hell we are! The Mayor says the Fort is under complete lockdown until the ooze crisis is resolved. Besides, we don't need her kind of riff-raff in Pinewood. So sod off, little elf lass, there's nothin' for you here!")}
        {SPEAKER_SPECIAL (id=Master Ooze) ( _ "(How should you get past the gate guards?)") (
            {SPEAKER_OPTION ( _ "(Beg) Please, please, please let me in! You can't leave me out here! The oozes will eat me!") (
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "Hmph! Pathetic!")}
                {SPEAKER_GENERIC (id=Bored Guard) ( _ "Aww, Carmen, do ya have to be so heartless? (He pats you on the shoulder as he ushers you through the gate) There, there, little lady, you'll be safe in this here fort. And here's a few coins so you can stay at th' inn.")}
                [sound]
                    name=gold.ogg
                [/sound]
                [gold]
                    side={P1}
                    amount=5
                [/gold]
                {NARRATOR_DEFAULT wesnoth-icon.png ( _ "You gained five gold pieces!")}
                {SPEAKER_GENERIC (id=Master Ooze) ( _ "(You feel strange about this gift from the guard... Like it would be only for you. You don't feel a need to share it with your companion ooze. Fascinated with this new experience you decide to keep it only for yourself.)")}
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "What the hell?! All it takes is some teary-eyed little wench and you get all sentimental! You're a pathetic excuse for a guard! And as for you, elf witch, you better behave yourself or you'll end up in the town gaol! The other mercenaries in the Mayor's service aren't nearly as forgiving as my idiot companion here!")}
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "And this other elf behind you?")}
                {SPEAKER_GENERIC (id=Master Ooze) ( _ "He's with me.")}
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "Bloody hell! Now we have an elvish refugee invasion!")}
                {VARIABLE bored_friend {P1}}
                {VARIABLE stern_friend {P2}}
                {TEAM_GOLD_VALUE}
                {LEADERSHIP 1 {P1}}
                {LEADERSHIP 1 {P2}}
            )}
            {SPEAKER_OPTION ( _ "(Bribe) I'll pay you thirty pieces of gold if you let me in!") (
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "That works for me! Have a nice day, ma'am! And welcome to Fort Pinewood!")}
                {TEAM_GOLD lost 30 {P1}}
                {SPEAKER_GENERIC (id=Bored Guard) ( _ "Hey wait a moment. What about the man behind you?")}
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "Who cares? We've got our bonus pay, it's not our problem anymore.")}
                {VARIABLE bored_friend {P2}}
                {VARIABLE stern_friend {P1}}
                {LEADERSHIP 1 {P1}}
                {LEADERSHIP 1 {P2}} 
            )}
            {SPEAKER_OPTION ( _ "(Offer to help) The oozes threaten everyone. I'm a healer and I came to offer my services in these dark times.") (
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "Hmmm...I suppose we need all the help we can get...")}
                {SPEAKER_GENERIC (id=Bored Guard) ( _ "Head to th' Mayor's manor just up the street. He's lookin' ta hire healers like yourself.")}
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "And this armed fellow behind you is...")}
                {SPEAKER_GENERIC (id=Master Ooze) ( _ "My personal bodyguard.")}
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "Oh. Welcome to Fort Pinewood then.")}
                {VARIABLE bored_friend {P1}}
                {VARIABLE stern_friend {P1}}
                {TEAM_GOLD_VALUE}
                {LEADERSHIP 2 {P1}}
            )}
            {SPEAKER_OPTION ( _ "(Seduce) Surely strong, handsome men like yourselves could do a woman like me a little favor? I could make it worth your while!") (
                {SPEAKER_GENERIC (id=Bored Guard) ( _ "(Gulp!) Well I guess we could--")}
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "Could what? You're not actually considering letting that inhuman freak have her way with you, are you? Elves are just one step above monsters! If the Imperial Army wiped their decadent race off the face of the planet, the world would be a better place! I'll say it one last time -- sod off missy! There's nothing for you in Fort Pinewood!")}
                {SPEAKER_GENERIC (id=Master Ooze) ( _ "(He's really angry; it looks like bribery is the only option you have left)")}
                {SPEAKER_GENERIC (id=Master Ooze) ( _ "(Bribe) I'll pay you thirty pieces of gold if you let me in!")}
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "You've finally got my attention, lass! I'll take those coins and... Hey who is that fellow behind you?")}
                {SPEAKER_GENERIC (id=Master Ooze) ( _ "He's with me.")}
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "Really? Never mind then. Welcome to Fort Pinewood! May the rest of your day be as nice, ha ha!")}
                {TEAM_GOLD lost 30 {P1}}
                {SPEAKER_GENERIC (id=Bored Guard) ( _ "Yer really evil, ya know that?")}
                {SPEAKER_GENERIC (id=Stern Guard) ( _ "(Shrugs) I try.")}
                {VARIABLE bored_friend {P2}}
                {VARIABLE stern_friend {P2}}
                {LEADERSHIP 2 {P2}}
            )}
        )}
        {NARRATOR_DEFAULT "items/gohere.png" ( _ "Whenever you see an icon that looks like this, you should move the Master Ooze onto the hex that contains it to trigger an event.")}
        {PINEWOOD_RULES}
    [/event]

    # Setup Master Ooze 2 - it has to be during turn of a player
    [event]
        name=side {P2} turn 1

        # Master Ooze 2
        {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "The past few days you have gathered up all the slimy blobs of yourself and tightly compacted them into one small ooze, which now resides in the innards of the elvish Solid. Because you devoured the elf's spirit, his abilities are now at your command, although he lost much of his power with the destruction of the Forest Heart.")}
        {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "male^It has taken you some time to get used to your new solid form. Your senses of taste, touch, hearing and sight are completely different. The elf's memories have given you new insight into the world.")}
        {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "male^Being a Solid does have drawbacks though. You are more vulnerable to damage, and you're not able to squeeze yourself through small cracks or crevices. You grow tired more easily, and cannot simply dissolve your food in moments.")}
        {SPEAKER_SPECIAL (id=Master Ooze 2) ( _ "male^You need to determine where you should focus your new talents. Should you focus on developing your physical strength or work on building up your endurance?") (
            {HOST_TRAIT1 {P2}}
        )}
        {SPEAKER_SPECIAL (id=Master Ooze 2) ( _ "male^Elves are well known for their natural grace of movement. Should you focus on manual dexterity or fleetness of foot?") (
            {HOST_TRAIT2 {P2}}
        )}
        {SPEAKER_GENERIC (id=Master Ooze 2) ( _ "male^You've arrived at the gates of Fort Pinewood, the main Solid settlement in the region. You're going to have to decide whether to assimilate peacefully into the Solids' civilization, or attempt to destroy it from within...")}

        {OOZE_HOST "Master Ooze 2" {P2} ( _ "Master Ooze 2") "Elvish Fighter" 10 16}

        {NARRATOR_DEFAULT "items/gohere.png" ( _ "Whenever you see an icon that looks like this, you should move the Master Ooze 2 onto the hex that contains it to trigger an event.")}
        {PINEWOOD_RULES}
    [/event]

    # ===================================================================================================================== #
    # SCENARIO EVENTS
    # ===================================================================================================================== #

    [event]
        name=moveto

        [filter]
            side={P1},{P2}
            x=11
            y=18
        [/filter]

        {NARRATOR_DEFAULT wesnoth-icon.png ( _ "Welcome to Fort Pinewood. North to Tarakin City. South to Shinseki Forest.")}
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P1}
            x=10
            y=11
        [/filter]

        {MAYOR_WYATT {P1}}       
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P2}
            x=10
            y=11
        [/filter]

        {MAYOR_WYATT {P2}}       
    [/event]

    # dryden_quest variable value key:
    # 0: Quest not given
    # 1: Player is to bring letter to Corinna
    # 2: Player returns to Dryden after letter mission
    # 3: Player is honest with Dryden
    # 4: Player tricks Dryden
    # 5: Player brings the ring to Corinna
    # 6: Tell Dryden he won
    # 7: Tell Dryden he lost
    # 8: Quest finished
    
    # Speaking with Dryden events
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=8
            y=12
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_aurelia $quests_limit}
        [then]
            [if]
                {VARIABLE_NUMERICAL_EQUALS quest_sir_dryden 1}
            [then]
                {SIR_DRYDEN {P1}}
            [/then]
            [else]
                {NO_TIME dryden_quest}
            [/else]
            [/if]
        [/then]
        [else]
            [if]
                [not]
                    {VARIABLE_NUMERICAL_EQUALS quest_sir_dryden 2}
                [/not]
            [then]
                {SIR_DRYDEN {P1}}
            [/then]
            [/if]
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=8
            y=12
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_sithras $quests_limit}
        [then]
            [if]
                {VARIABLE_NUMERICAL_EQUALS quest_sir_dryden 2}
            [then]
                {SIR_DRYDEN {P2}}
            [/then]
            [else]
                {NO_TIME dryden_quest}
            [/else]
            [/if]
        [/then]
        [else]
            [if]
                [not]
                    {VARIABLE_NUMERICAL_EQUALS quest_sir_dryden 1}
                [/not]
            [then]
                {SIR_DRYDEN {P2}}
            [/then]
            [/if]
        [/else]
        [/if]    
    [/event]
    
    #Speaking with Corinna events
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=4
            y=10
        [/filter]

        [if]
            [not]
                {VARIABLE_NUMERICAL_EQUALS quest_sir_dryden 2}
            [/not]
        [then]
            {CORRINA {P1}}
        [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=4
            y=10
        [/filter]

        [if]
            [not]
                {VARIABLE_NUMERICAL_EQUALS quest_sir_dryden 1}
            [/not]
        [then]
            {CORRINA {P2}}
        [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=6
            y=9
        [/filter]

        {FRIST {P1}}                
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=6
            y=9
        [/filter]

        {FRIST {P2}}                
    [/event]

    [event]
        name=post_advance

        [filter]
            id=Master Ooze
        [/filter]

        {AURELIA_SKILLS}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=10
            y=6
        [/filter]

        [if]
            {VARIABLE_NUMERICAL_EQUALS have_training_aurelia 1}
            [and]
                {VARIABLE_NOT_EQUALS pinewood_arena_closed yes}
            [/and]
        [then]
            {PINEWOOD_ARENA {P1}}
        [/then]
        [else]
            [if]
                {VARIABLE_NUMERICAL_EQUALS have_training_aurelia 2}
                [and]
                    {VARIABLE_LESS_THAN have_training_sithras 3}
                [/and]
            [then]
                {PINEWOOD_ARENA_CHAMPION {P1}}
            [/then]
            [else]
                [if]
                    {VARIABLE_EQUALS pinewood_arena_closed yes}
                [then]             
                    {PINEWOOD_ARENA_CLOSED {P1}}
                [/then]
                [/if]           
            [/else]
            [/if]
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=10
            y=6
        [/filter]

        [if]
            {VARIABLE_NUMERICAL_EQUALS have_training_sithras 1}
            [and]
                {VARIABLE_NOT_EQUALS pinewood_arena_closed yes}
            [/and]
        [then]
            {PINEWOOD_ARENA {P2}}
        [/then]
        [else]
            [if]
                {VARIABLE_NUMERICAL_EQUALS have_training_sithras 2}
                [and]
                    {VARIABLE_LESS_THAN have_training_aurelia 3}
                [/and]
            [then]
                {PINEWOOD_ARENA_CHAMPION {P2}}
            [/then]
            [else]
                [if]
                    {VARIABLE_EQUALS pinewood_arena_closed yes}
                [then]
                    {PINEWOOD_ARENA_CLOSED {P2}}
                [/then]
                [/if] 
            [/else]
            [/if]
        [/else]
        [/if]
    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]
            id=Arena Monster
        [/filter]

        {MONSTER_DIE $ongoing_fight}
    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]
            type=Quintain0
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN training_aurelia 1}
            [and]
                [not]
                    [have_unit]
                        side={F3}
                        type=Quintain0
                    [/have_unit]
                [/not]
            [/and]
        [then]
            {CLEAR_VARIABLE quintains_released}
            {AURELIA_TRAINING}
        [/then]
        [else]
            [if]
                [not]
                    [have_unit]
                        side={F3}
                        type=Quintain0
                    [/have_unit]
                [/not]
            [then]
                {CLEAR_VARIABLE quintains_released}
            [/then]
            [/if]
        [/else]
        [/if]
    [/event]

    [event]
        name=post_advance

        [filter]
            id=Master Ooze 2
            type=Elvish Captain
        [/filter]

        {SITHRAS_SKILLS 1}
        {SITHRAS_CHALLENGE}
    [/event]

    [event]
        name=post_advance

        [filter]
            id=Master Ooze 2
            type=Elvish Hero
        [/filter]

        {SITHRAS_SKILLS 2}
        {SITHRAS_CHALLENGE}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=8,9,10,11,12
            y=6-7,6-8,7-8,6-8,6-7
        [/filter]

        [if]
            {VARIABLE_NOT_EQUALS pinewood_arena_closed yes}
            [and]
                {VARIABLE_LESS_THAN pinewood_transactions_done 1}
            [/and]
        [then]
            {PINEWOOD_ARENA_SPECTATOR {P1}}
        [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=8,9,10,11,12
            y=6-7,6-8,7-8,6-8,6-7
        [/filter]

        [if]
            {VARIABLE_NOT_EQUALS pinewood_arena_closed yes}
            [and]
                {VARIABLE_LESS_THAN pinewood_transactions_done 1}
            [/and]
        [then]
           {PINEWOOD_ARENA_SPECTATOR {P2}}
        [/then]
        [/if]
    [/event]

    [event]
        name=post_advance

        [filter]
            type=Elvish Enchantress Ooze
        [/filter]

        {AURELIA_SKILLS_2}
        {AURELIA_CHALLENGE}
    [/event]

    [event]
        name=die

        [filter]
            id=Bloodtalon
        [/filter]

        {BLOODTALON_DIE $ongoing_fight}
    [/event]
        
    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P1}
            x=15
            y=11
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_aurelia $quests_limit}
        [then]
            {NO_TIME quest_fontaine}
        [/then]
        [else]
            {FONTAINE {P1}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P2}
            x=15
            y=11
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_sithras $quests_limit}
        [then]
            {NO_TIME quest_fontaine}
        [/then]
        [else]
            {FONTAINE {P2}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P1}
            x=15
            y=7
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_aurelia $quests_limit}
        [then]
            {NO_TIME book_hunt}
        [/then]
        [else]
            {LIVIUS {P1}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P2}
            x=15
            y=7
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_sithras $quests_limit}
        [then]
            {NO_TIME book_hunt}
        [/then]
        [else]
            {LIVIUS {P2}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=3
            y=14
        [/filter]

        {LIVIUS_BOOK {P1}}    
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=3
            y=14
        [/filter]

        {LIVIUS_BOOK {P2}}    
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=15
            y=7
        [/filter]

        {LIVIUS_REWARD {P1}}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=15
            y=7
        [/filter]

        {LIVIUS_REWARD {P2}}
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P1}
            x=14
            y=5
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_aurelia $quests_limit}
        [then]
            {NO_TIME hay_hunt}
        [/then]
        [else]
            {JEDD {P1}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P2}
            x=14
            y=5
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_sithras $quests_limit}
        [then]
            {NO_TIME hay_hunt}
        [/then]
        [else]
            {JEDD {P2}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=13
            y=4
        [/filter]

        {JEDD_FARM_WORK 0 {P1} 13 4}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=13
            y=4
        [/filter]

        {JEDD_FARM_WORK 0 {P2} 13 4}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=13
            y=3
        [/filter]

        {JEDD_FARM_WORK 1 {P1} 13 3}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=13
            y=3
        [/filter]

        {JEDD_FARM_WORK 1 {P2} 13 3}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=15
            y=5
        [/filter]

        {JEDD_FARM_WORK 2 {P1} 15 5}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=15
            y=5
        [/filter]

        {JEDD_FARM_WORK 2 {P2} 15 5}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=14
            y=5
        [/filter]

        {JEDD_WORK_DONE {P1}}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=14
            y=5
        [/filter]

        {JEDD_WORK_DONE {P2}}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=13
            y=12
        [/filter]

        {BROCK {P1}}        
    [/event]

    [event]
         name=moveto
         first_time_only=no

         [filter]
             side={P2}
             x=13
             y=12
         [/filter]

         {BROCK {P2}}        
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=17
            y=8
        [/filter]

        {VALIN {P1}}    
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=17
            y=8
        [/filter]

        {VALIN {P2}}    
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=4
            y=7
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_aurelia $quests_limit}
        [then]
            {NO_TIME ram_challenge}
        [/then]
        [else]
            {RAM {P1}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=4
            y=7
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_sithras $quests_limit}
        [then]
            {NO_TIME ram_challenge}
        [/then]
        [else]
            {RAM {P2}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=15
            y=9
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_aurelia $quests_limit}
        [then]
            {NO_TIME donation}
        [/then]
        [else]
            {HIGH_PRIEST_JAL {P1}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=15
            y=9
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_sithras $quests_limit}
        [then]
            {NO_TIME donation}
        [/then]
        [else]
            {HIGH_PRIEST_JAL {P2}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P1},{P2}
            x=17
            y=12
        [/filter]

        {SHADY_CHARACTER}
    [/event]

    [event]
        name=moveto

        [filter]
             side={P1}
             x=6
             y=5
        [/filter]

        {ALKAR {P1}}
    [/event]

    [event]
        name=moveto

        [filter]
             side={P2}
             x=6
             y=5
        [/filter]

        {ALKAR {P2}}
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            side={P1}
            x=4
            y=4
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_aurelia $quests_limit}
        [then]
            {NO_TIME guthry_quest}
        [/then]
        [else]
            {GUTHRY {P1}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
           side={P2}
           x=4
           y=4
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_sithras $quests_limit}
        [then]
            {NO_TIME guthry_quest}
        [/then]
        [else]    
            {GUTHRY {P2}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=10
            y=2
        [/filter]

        [if]
            {VARIABLE_GREATER_THAN quests_aurelia $quests_limit}
        [then]
            {NO_TIME slaver_debate}
        [/then]
        [else]
            {SLAVER_DEBATE {P1}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side={P2}
            x=10
            y=2
        [/filter]
        [if]
            {VARIABLE_GREATER_THAN quests_sithras $quests_limit}
        [then]
            {NO_TIME slaver_debate}
        [/then]
        [else]
            {SLAVER_DEBATE {P2}}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
            x=10
            y=15
        [/filter]

        {PINEWOOD_TRANSACTIONS_OVER {P1}}    
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
            x=10
            y=15
        [/filter]

        {PINEWOOD_TRANSACTIONS_OVER {P2}}    
    [/event]

    [event]
        name=side {P1} turn
        first_time_only=no

        [if]
            {VARIABLE_NOT_EQUALS fight_end 0}
        [then]
            {VARIABLE master_ooze $fight_end}
            {MOVE_OOZE 14 7 13 8}
            {VARIABLE fight_end 0}
        [/then]
        [else]
            {MASTER_OOZE_LOCATION {P1}}
            {VARIABLE wandering_ooze.moves $wandering_ooze.max_moves}
        [/else]
        [/if]

        [if]
            {VARIABLE_NUMERICAL_EQUALS pinewood_transactions_done {P1}}
        [then]
            [end_turn]
            [/end_turn]
        [/then]
        [/if]
    [/event]        

    [event]
        name=side {P2} turn
        first_time_only=no

        [if]
            {VARIABLE_NOT_EQUALS fight_end 0}
        [then]
            {VARIABLE master_ooze $fight_end}
            {MOVE_OOZE 14 7 13 8}
            {VARIABLE fight_end 0}
        [/then]
        [else]
            {MASTER_OOZE_LOCATION {P2}}
            {VARIABLE wandering_ooze.moves $wandering_ooze.max_moves}
        [/else]
        [/if]
    
        [if]
            {VARIABLE_NUMERICAL_EQUALS pinewood_transactions_done {P2}}
        [then]
            [end_turn]
            [/end_turn]
        [/then]
        [/if]
    [/event]

    [event]
        name=side {P2} turn refresh
        first_time_only=no

        [if]
            {VARIABLE_NUMERICAL_EQUALS quintains_released 1}
            [and]
                {VARIABLE_NOT_EQUALS ongoing_fight {P2}}
            [/and]
        [then]
            {SET_INITIATIVE "Master Ooze 2" 0}
        [/then]
        [/if]
    [/event]

    {OOZE_DEATH "Master Ooze" "Master Ooze 2" ()}
    {OOZE_DEATH "Master Ooze 2" "Master Ooze" ()}

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P1}
        [/filter]

        [if]
            {VARIABLE_NUMERICAL_EQUALS pinewood_transactions_done {P2}}
        [then]
            [if]
                {VARIABLE_NOT_EQUALS ongoing_fight {P1}}
            [then]
                {RESTORE_MOVES "Master Ooze" ooze_leader $ooze_leader.max_moves}
            [/then]
            [/if]
        [/then]
        [else]
            [allow_undo]
            [/allow_undo]
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side={P2}
        [/filter]
        [if]
            {VARIABLE_NUMERICAL_EQUALS pinewood_transactions_done {P1}}
        [then]
            [if]
                {VARIABLE_NOT_EQUALS ongoing_fight {P2}}
            [then]
                {RESTORE_MOVES "Master Ooze 2" ooze_leader $ooze_leader.max_moves}
            [/then]
            [/if]
        [/then]
        [else]
            [allow_undo]
            [/allow_undo]
        [/else]
        [/if]
    [/event]

    #undef F1
    #undef F2
    #undef F3
    #undef TEAM_GOLD_VALUE
    #undef TEAM_HAS_GOLD
    #undef TEAM_GOLD
    #undef HAS_TRAITS
    #undef NO_TIME
    #undef LEADERSHIP
    #undef SIDE_PROTAGONIST
    #undef SCENARIO_OBJECTIVES
    #undef SET_INITIATIVE
    #undef MASTER_OOZE_LOCATION
    #undef MOVE_OOZE

    #undef MAYOR_WYATT
    #undef DRYDEN_PROBLEM
    #undef DRYDEN_RESPONSE
    #undef DRYDEN_WINS
    #undef DRYDEN_LOSES
    #undef CORRINA_PROBLEM
    #undef CORRINA_WINS
    #undef CORRINA_CHOICE
    #undef SIR_DRYDEN
    #undef CORRINA
    #undef FRIST
    #undef AURELIA_TRAINING
    #undef AURELIA_SKILLS
    #undef AURELIA_SKILLS_2
    #undef SITHRAS_FIGHT
    #undef PINEWOOD_ARENA
    #undef MONSTER_DIE
    #undef SITHRAS_SKILLS
    #undef SITHRAS_CHALLENGE
    #undef PINEWOOD_ARENA_CHAMPION
    #undef PINEWOOD_ARENA_SPECTATOR
    #undef PINEWOOD_ARENA_CLOSED
    #undef BLOODTALON_DIE
    #undef FONTAINE
    #undef LIVIUS
    #undef LIVIUS_BOOK
    #undef LIVIUS_REWARD
    #undef JEDD_FARM_WORK
    #undef JEDD
    #undef JEDD_WORK_DONE
    #undef BROCK_CHALLENGE_LOST
    #undef BROCK_CHALLENGE_WIN
    #undef BROCK
    #undef VALIN_CHALLENGE_WIN
    #undef VALIN
    #undef RAM
    #undef DONATION
    #undef HIGH_PRIEST_JAL
    #undef ALKAR
    #undef SHADY_CHARACTER
    #undef GUTHRY
    #undef SLAVER_DEBATE_STAGE
    #undef SLAVER_DEBATE
    #undef HOST_TRAIT1
    #undef HOST_TRAIT2
    #undef OOZE_HOST
    #undef PINEWOOD_RULES
    #undef PINEWOOD_TRANSACTIONS_OVER
[/multiplayer]
